

















# Best-in-class UX
## WHY?[​](https://docs.healthsafepay.com/docs/business/BestInClassUI/#why "Direct link to WHY?")
![Snag_634fdbb0](https://user-images.githubusercontent.com/100694515/211059042-009850fd-618c-43e1-9544-512122f8f117.png)
![Snag_634f49c1](https://user-images.githubusercontent.com/100694515/211058934-0c12251b-f7fd-4ee7-9aa8-4814a008cb0d.png)
![Snag_6352741e](https://user-images.githubusercontent.com/100694515/211059557-2a914be4-b7b3-4691-8043-d9bd28798142.png)
![Snag_63544ed9](https://user-images.githubusercontent.com/100694515/211059914-e694995b-074d-448c-bdbc-95289467000d.png)





# Merchant Administrative Tools
## Merchant Stripe Dashboard[​](https://docs.healthsafepay.com/docs/developers/Admin/#merchant-stripe-dashboard "Direct link to Merchant Stripe Dashboard")
When a Merchant is setup at Stripe as part of the configuration step, a Merchant specific url will be provided. Merchant can perform administrative tasks in Dashboard such as View transactions, get reports and generate refunds
## Convenient Checkout Admin Tool[​](https://docs.healthsafepay.com/docs/developers/Admin/#convenient-checkout-admin-tool "Direct link to Convenient Checkout Admin Tool")
As part of a future enhancement, we are building an easy to use, service focused Admin tool where Merchant can perform all the administrative tasks they can perform on the dashboard and more


# Webhook
## What is Webhooks?[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/#what-is-webhooks "Direct link to What is Webhooks?")
A webhook is a way for an app or service to provide other apps or services with real-time information. It allows one application to notify another application or service about specific events or updates by sending a HTTP POST request to a specified URL when a certain event occurs. Webhooks are commonly used in various scenarios such as triggering actions in response to specific events, integrating different systems, and automating processes. They are commonly used in APIs and web services to facilitate communication and data exchange between different applications.
## Why Webhooks?[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/#why-webhooks "Direct link to Why Webhooks?")
A webhook allows CCG to notify your system about events related to transactions. When a specific event occurs, such as a successful payment or a refund. This allows your system to receive real-time updates and take appropriate actions based on the event, such as updating the order status or sending a confirmation email to the customer. Webhooks are commonly used to automate processes and keep systems in sync with the payment gateway.
## Handling Failures and Retry Mechanism[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/#handling-failures-and-retry-mechanism "Direct link to Handling Failures and Retry Mechanism")
In the event of a failure from the webhook endpoint, retry attempts will be initiated. The table provided below outlines the error codes that are considered non-retriable.
Endpoint | Not Retriable Errorcodes  
---|---  
Webhook |  `400 Bad Request`, `413 Request Entity Too Large`, `403 Forbidden`, `404 Not Found`, `401 Unauthorized`  
If the error received from the webhook does not match the codes listed above, a retry will be triggered. Following the initial delivery attempt, we will wait for a response for 30 seconds. If no response is received within this timeframe, the message will be queued for a retry. Our retry mechanism follows an exponential backoff policy, allowing for up to 5 attempts within a 50-minute window.


# Core Capabilities
The core capabilities of a CCG typically include the following features:
  * **Payment Processing** : The primary function of a CCG is to securely process online payments made by customers using various payment methods such as credit cards, debit cards, digital wallets, and bank transfers.
  * **Transaction Security** : CCG employ advanced security measures like encryption, tokenization, and fraud detection to ensure the secure transmission of sensitive payment information and protect against unauthorized access.
  * **Payment Method Support** : CCG supports a wide range of payment methods to cater to diverse customer preferences and enable seamless transactions across different channels.
  * **Integration** : CCG offer APIs and plugins for easy integration with e-commerce platforms, websites, and mobile applications, allowing businesses to accept payments online without complex development work.
  * **Reporting and Analytics** : CCG provide reporting and analytics tools that enable merchants to track transaction data, monitor payment trends, and generate insights to optimize their payment processes.
  * **Fraud Prevention** : CCG offer fraud prevention tools and risk management features to help merchants detect and prevent fraudulent transactions, reducing the risk of financial losses.
  * **PCI Compliance** : CCG adhere to Payment Card Industry Data Security Standard (PCI DSS) compliance to ensure the secure handling of payment card data and maintain data security standards.
  * **Customer Support** : 24/7 customer support services provided by CCG help merchants resolve payment-related issues, technical queries, and ensure smooth payment processing operations.


## CCG Capabilities[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/#ccg-capabilities "Direct link to CCG Capabilities")
  * [Payments](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/)
  * [PaymentMethods](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/)




# Overview
## What is Convenient Checkout?[​](https://docs.healthsafepay.com/docs/business/intro/#what-is-convenient-checkout "Direct link to What is Convenient Checkout?")
![Snag_636bd82e](https://user-images.githubusercontent.com/100694515/211064432-975b76af-5d5e-4291-b60a-c0efe508ddf5.png)
## View Demo of Convenient Checkout[​](https://docs.healthsafepay.com/docs/business/intro/#view-demo-of-convenient-checkout "Direct link to View Demo of Convenient Checkout")
<https://user-images.githubusercontent.com/100694515/206768937-2c49a962-7f26-4ae7-b2f4-8d3b0dfb0572.mp4>
![Snag_637c7f9b](https://user-images.githubusercontent.com/100694515/211068074-15fee44f-bd6b-4de7-b86a-072ef77d2f35.png)
## Why Convenient Checkout[​](https://docs.healthsafepay.com/docs/business/intro/#why-convenient-checkout "Direct link to Why Convenient Checkout")
![Snag_637a647c](https://user-images.githubusercontent.com/100694515/211067472-0851686b-330a-4304-917c-113cc04e32de.png)
![Snag_cf5797](https://user-images.githubusercontent.com/100694515/204377610-2f087741-7b4e-4549-81d7-94e62d99a84e.png) ![Snag_637c7f9b](https://user-images.githubusercontent.com/100694515/211068074-15fee44f-bd6b-4de7-b86a-072ef77d2f35.png)
![Snag_6396a2e4](https://user-images.githubusercontent.com/100694515/211072538-0682753c-6503-427f-b2bd-96dc5f4a44ed.png)
![Snag_639c444c](https://user-images.githubusercontent.com/100694515/211073444-816609e2-e979-44d2-9eac-bbfd65e0bb06.png)
![Snag_639d2824](https://user-images.githubusercontent.com/100694515/211073580-819ea164-8dff-4754-b0e1-eff20f3bb056.png)
## Current Convenient Checkout Features[​](https://docs.healthsafepay.com/docs/business/intro/#current-convenient-checkout-features "Direct link to Current Convenient Checkout Features")
![Snag_63a1671e](https://user-images.githubusercontent.com/100694515/211074285-90cacf0a-edf6-4ed2-9db2-8f3d14d0a581.png)
## Future state of Convenient Checkout[​](https://docs.healthsafepay.com/docs/business/intro/#future-state-of-convenient-checkout "Direct link to Future state of Convenient Checkout")
![Snag_63a2e0dd](https://user-images.githubusercontent.com/100694515/211074511-6e458c7a-c4bf-4c06-8802-6bb9c1539e93.png)


# Glossary
Keyword | Definition  
---|---  
ACH Payments | ACH stands for Automated Clearing House, a U.S. financial network used for electronic payments and money transfers. Also known as “direct payments,” ACH payments are a way to transfer money from one bank account to another without using paper checks, credit card networks, wire transfers, or cash.  
Admin Utility | A web-based virtual terminal and reporting tool used for processing one-time, recurring, or installment payments for credit, debit, and ACH/electronic check transactions with search and reporting functionality.  
Application Programming Interface (API) | In the context of APIs, the word Application refers to any software with a distinct function. Interface can be thought of as a contract of service between two applications. This contract defines how the two communicate with each other using requests and responses.  
Authenticated | A security process that allows user to verify their identities in order to gain access to their personal accounts on a website or through a portal.  
Authenticated Payments | The ability to make a purchases from a website or mobile application after logging into an account with saved payment information.  
Back Office | An office or center in which the administrative work of a business is carried out, as opposed to its dealings with customers.  
Batch Processing | A method of running software programs called jobs in batches automatically. While users are required to submit the jobs, no other interaction by the user is required to process the batch. Batches may automatically be run at scheduled times as well as being run contingent on the availability of computer resources.  
Common Components | Components that can be used by or sold to multiple customers (i.e., off the shelf, non-custom).  
Customer Service Representative (CSR) | An individual that that interacts with customers to handle complaints, process orders, and provide information about an organization's products and services.  
Digital Wallet | An electronic device, website, software system, or database that facilitates commercial transactions by storing a customer's credit card, shipping address, and other payment data.  
Electronic Communications Gateway (ECG) | UHGs Electronic Communication Gateway (ECG) is a Managed File Transfer (MFT) platform providing internal and external file transfer services all of UnitedHealth Group, including acquired entities (AEs). The ECG platform includes automated server-to-server transfers, but also provides tools to support person-to-server, server-to-person, and person-to-person transfers.  
Embedded Experience | Integrated external content into a website or page.  
Guest Checkout | The ability to make a purchases from a website or mobile application without logging in to an account or saving any information within the merchants database.  
Guest Payments | Same as Guest Checkout.  
Hosted Experience | A webpage hosted by a third-party provider that allows customers to make secure online payments.  
Installment Plan | Sum of money paid in smaller parts over a fixed period of time (always an end date).  
Interactive Voice Response (IVR) | An automated phone system technology that allows incoming callers to access information via a voice response system of pre-recorded messages without having to speak to an agent as well as to utilize menu options via touch tone keypad selection or speech recognition to have their call routed to specific departments or specialists.  
Merchant | Business or Trade.  
One-Time Payment | The ability to enter card or banking details within a checkout page and click purchase without account details or saving payment method.  
Payment Gateway | The technology (terminals or "checkout" portals) used by merchants to accept debit or credit card purchases from consumers.  
Payment Plan | Paying off any outstanding debt, or sometimes more than one debt by means of consolidation into an organized payment schedule.  
Payment Terminal | A device which interfaces with payment cards to make electronic funds transfers.  
Payment Token | When a merchant processes the credit card of a customer, the primary account number (PAN) is substituted with a token.  
PAN | Primary Account Number. Also called payment card numbers as they are found on payment cards like credit and debit cards.  
Shared Wallet | A Digital Wallet that is accessible to a customer across businesses or business entities.  
Smart Wallet | A smart wallet is a Digital Wallet (see above) that can assist or help guide customer payments based on business rules.  
Split Tender | A multi-method payment for one single transaction. It involves more than one form of payment, such as the combination of debit/credit cards, gift cards, cash, etc.  
Stripe | A suite of APIS powering online payment processing and commerce solutions for internet businesses of all sizes.  
Stripe Dashboard | A user interface that is used to operate and configure a Stripe account. It can be used to manage payments and refunds, respond to disputes, monitor your integration, and more.  
Stripe Payment Element | An embeddable component for securely collecting payment details.  
Subscription Plan (recurring) | Paying a recurring price at regular intervals for access to a product or service on an ongoing basis (may not have an end date).  
Sycurio (formerly Semafone) | Semafone (now Sycurio) is a third party supplier of technology providing secure voice transactions for contact centres and retailers taking cardholder information when not present at payments. Semafone’s patented data capture method collects sensitive information such as payment card or bank details and social security numbers directly from the customer’s telephone keypad for processing. This prevents personal data from entering the contact centre, which protects against the risk of fraud and the associated reputational damage, ensuring compliance with industry regulations such as PCI DSS.  
Vendor | A person or business entity that sells something.  
Webhook | A Webhook serves a similar purpose as an API, but does so differently, as webhooks have different uses. Unlike an API, a Webhook is an automated message that one web or mobile app sends to another web service or mobile app when it's triggered by a specific user action.  
Widget | An application, or a component of an interface, that enables a user to perform a function or access a service.


# Merchant Customer Migration
### Introduction[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Migration/#introduction "Direct link to Introduction")
Merchants can make use of CCG capabilities to facilitate Customer and Payment Method migrations. To initiate the migration process, the merchant will provide migration files, utilizing the CCG Migration templates. Once the files are shared, CCG will take charge of creating customers and linking payment methods, which will subsequently be available in CCG upon completion of the process.
Additionally, CCG will generate error and success extracts. The error extract will enable the merchant to identify any potential issues in the original file, while the success extract will provide the CCG Payment Method Ids that resulted from the migration process.
There are two types of migrations, depending on the Payment Method: Bank Account or Card.
### Migration File[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Migration/#migration-file "Direct link to Migration File")
The migration files contain essential information required for successful customer migration. Depending on the Payment Method type, the files contain optional and compulsory fields. Below, we will provide a description of each field.
  * Card file: **Customer Information** + **Card Information**
  * Bank Account file: **Customer Information** + **Bank Account Information**


#### Customer Information:[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Migration/#customer-information "Direct link to Customer Information:")
field | type | Compulsory | description  
---|---|---|---  
customer[merchant_customer_key] | Map<String, String> | Yes | Merchant Customer Identifier. Multiple merchant customer identifiers can be provided.  
firstName | String |  | first name  
lastName | String |  | last name  
email | String |  | email address  
ssnLastFour | Digits (4) |  | SSN last four digits, e.g 1234  
phoneCountryCode | Digits (3) |  | Phone country code, e.g. 001  
phoneNumber | Digits (20) |  | Phone number, e.g. 0123456789  
dateOfBirth | Date (YYYY-MM-DD) |  | Date of Birth, e.g. 1975-11-14  
zip5 | Digits (5) |  | ZIP Code, e.g. 10001  
hsid | UUID |  | HealthSafe Identifier of the customer  
enterpriseId | String |  | Enterprise Identifier of the customer  
#### Card Information:[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Migration/#card-information "Direct link to Card Information:")
field | type | Compulsory | description  
---|---|---|---  
vaultCardId | String | Yes | Merchant Payment Method Identifier  
nameOnCard | String | Yes | Name on card  
zipOnCard | Digits (5) |  | ZIP Code on card, e.g. 10001  
cardLast4 | Digits (4) |  | Card number last four digits, e.g. 1234  
expirationYear | Date (YYYY) |  | Expiration Year, e.g. 2032  
expirationMonth | Date (MM) |  | Expiration Month, e.g. 12  
cardNickName | String |  | Card nickname  
isDefault | Boolean |  | Default card flag  
isManufacturer | Boolean |  | Manufacturer card flag  
Sample Card Migration template:
[card_test_migration_file_20240625-153549.csv](https://github.com/user-attachments/files/16064303/card_test_migration_file_20240625-153549.csv)
#### Bank Account Information:[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Migration/#bank-account-information "Direct link to Bank Account Information:")
field | type | Compulsory | description  
---|---|---|---  
accountHolderType | individual/business | Yes | Type of account holder  
accountType | checking/savings | Yes | Type of account  
bankName | String |  | Name of the bank  
accountLast4 | Digits (4) |  | Last four digits of the bank account  
accountNumber | String | Yes | Account number  
routingNumber | String | Yes | Routing number  
nameOnAccount | String | Yes | Name on bank account  
accountNickName | String |  | Bank account nickname  
isDefault | Boolean |  | Default bank account flag  
Sample Bank Account Migration template:
[bank_account_test_migration_file_20240701-095200.csv](https://github.com/user-attachments/files/16064302/bank_account_test_migration_file_20240701-095200.csv)
### Migration Extracts[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Migration/#migration-extracts "Direct link to Migration Extracts")
Refer [Merchant Extract](https://docs.healthsafepay.com/docs/developers/Customer-migration/Extract/)
### File Delivery[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Migration/#file-delivery "Direct link to File Delivery")
ECG QuickConnect will be used for transferring migration files between Merchant and CCG.
### Migration Performance[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Migration/#migration-performance "Direct link to Migration Performance")
The Merchant Customer Migration process involves creating customer records followed by the creation of payment methods. The performance of this process can vary depending on the environment in which it is executed. Below, we provide rough estimates of the maximum number of records processed per second in a production environment:
  * Customer Creation: up to 65 records per second
  * Payment Method Creation: up to 30 records per second


As CCG handles the above processes asynchronously, it may take some time to receive event responses via webhooks for these requests.
Based on previous migrations, we have been able to process approximately 1 million records over a 24-hour period.


# Consumer Pre-requisite
Below is the list of prerequisites to consume CCG services
Pre-requiste | Required | Owner  
---|---|---  
[HCP Configuration](https://docs.healthsafepay.com/docs/developers/onboarding/register-with-hcp/) | Yes | HCP  
[Stripe Configuration](https://docs.healthsafepay.com/docs/developers/onboarding/stripe-configuration/) | Yes | Stripe  
[Merchant Onboarding](https://docs.healthsafepay.com/docs/onboarding/Merchant-Onboarding/) | Yes | CCG  
[Report Configuration](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/introduction/) | Optional | CCG  
[Webhooks Configuration](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/) | Optional | CCG  
[Wallet Payment Set Up](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/) | Optional | CCG


# Release Notes
Convenient Checkout Gateway (CCG) release notes provide details on both [Production](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/) and [Non-Production (Stage)](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/) environments.


# Troubleshooting


# Duplicate Payment Method
Payment method is considered as a duplicate payment method if newly added payment method details match with the existing payment method.
## Duplicate Card[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Add-Duplicate-Payment-Method/#duplicate-card "Direct link to Duplicate Card")
### What is Duplicate Card?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Add-Duplicate-Payment-Method/#what-is-duplicate-card "Direct link to What is Duplicate Card?")
If customer adds payment method with following details then, payment method is considered as a duplicate card.
  * Type as `CARD` with same card number and same `fingerprint` as existing card in the wallet.
  * Same or updated information like `expiry date`, `name on card`, `nickname` and `zip code`.


### How CCG handles duplicate card scenario?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Add-Duplicate-Payment-Method/#how-ccg-handles-duplicate-card-scenario "Direct link to How CCG handles duplicate card scenario?")
If customer adds duplicate card as per above definition in the wallet, then:
  * CCG updates existing card with updated information like new expiry date, name on card, nickname and zip code from newly added card.
  * `PAYMENT_METHOD_CREATED` webhook is sent to the merchant to indicate creation of new payment method.
  * `PAYMENT_METHOD_UPDATED` webhook is also sent to the merchant to indicate existing card details are updated as newly added payment method was duplicate.
  * In duplicate card scenario, if warning details mentioned below are present in the setup payment method details response or list payment methods response, then it indicates that duplicate card has been added by the customer, but CCG has updated existing card with new details and newly added card has been discarded.


> ⚠️ **Warning Message Details:**
  * **Title:** Payment method already exists
  * **Description:** Any new details provided have been updated accordingly.


### How to access warning details?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Add-Duplicate-Payment-Method/#how-to-access-warning-details "Direct link to How to access warning details?")
1. GET Setup Payment Method API Response: 
```
{  
  "data": {  
    "id": "xxx-xxx-xxx-xxx-xxx",  
    "platformVendorMerchantId": "platformVendorMerchantId",  
    "vendorSetupPaymentMethodSecret": "vendorSetupPaymentMethodSecret",  
    "status": "COMPLETED",  
    "paymentMethodId": "paymentMethodId",  
    "paymentMethodType": "CARD",  
    "error": null,  
    "warning": {  
      "code": "DUPLICATE_ENTRY",  
      "title": "Payment method already exists",  
      "description": "Any new details provided have been updated accordingly."  
    }  
  },  
  "url": "/customers/<customerId>/setup-payment-methods/<setupPaymentMethodId>"  
}  

```

2. GET Payment Methods API Response: 
```
[  
  {  
    "id": "xxx-xxx-xxx-xxx-xxx",  
    "paymentMethodType": "CARD",  
    "vendorPaymentMethodId": "pm_xxx",  
    "vendorMerchantId": null,  
    "customerId": "xxx-xxx-xxx-xxx-xxx",  
    "vendor": "STRIPE",  
    "status": "COMPLETED",  
    "zipCode": "xxxxx",  
    "error": null,  
    "nickname": "nickname",  
    "lastModifiedBySource": null,  
    "lastModifiedByMerchantId": "xxx-xxx-xxx-xxx-xxx",  
    "lastModifiedByAgent": {  
      "firstName": null,  
      "lastName": null,  
      "isAccessVerified": null,  
      "userId": "string"  
    },  
    "paymentMethodDetails": {  
      "vendorPaymentMethodFingerprint": "fingerprint",  
      "type": "CARD",  
      "nameOnCard": "nameOnCard",  
      "cardBrand": "cardBrand",  
      "expiryMonth": "expiryMonth",  
      "expiryYear": "expiryYear",  
      "last4": "last4",  
      "manufacturerCard": true,  
      "zipCode": null,  
      "status": "ACTIVE"  
    },  
    "warning": {  
      "code": "DUPLICATE_ENTRY",  
      "title": "Payment method already exists",  
      "description": "Any new details provided have been updated accordingly."  
    },  
    "accountNumber": null,  
    "card": {  
      "vendorPaymentMethodFingerprint": "fingerprint",  
      "type": "CARD",  
      "nameOnCard": "nameOnCard",  
      "cardBrand": "cardBrand",  
      "expiryMonth": "expiryMonth",  
      "expiryYear": "expiryYear",  
      "last4": "last4",  
      "manufacturerCard": true,  
      "zipCode": null,  
      "status": "ACTIVE"  
    },  
    "usbankAccountDetails": null,  
    "usbankAccount": false,  
    "default": false  
  }  
]  

```



# Performance Testing Baseline
## Performance testing goal for Release 1[​](https://docs.healthsafepay.com/docs/developers/Testing/Performance-Testing-Baseline/#performance-testing-goal-for-release-1 "Direct link to Performance testing goal for Release 1")
**Run critical API calls and make sure the TPS > 10**
Approach We tested the guest payment and user payment flows. These ensures that the critical API flows are tested.
Test results As stripe test mode supports only 20 TPS, so we used K6 tool run 20 guest payment call simultaneously.
Guest Payment Confirm payment happens at stripe end so we wont be covering that. Guest payment call involves three steps.
  1. Create Checkout Session
  2. Create Payment
  3. Poll for payment status to change to 200


> All three calls put together we are able to hit 19.5 TPS.  
>  95th Percentile time for the call : 1.48 seconds. To get the individual API response time, we used azure app insights. During the testing window all the API calls response time were below 50ms mark.
![GuestAPIresponsetime](https://user-images.githubusercontent.com/100694515/193690988-b805a14c-70f7-4952-9dac-ef19af8da1cc.png) ![GuestAPIresponsetime2](https://user-images.githubusercontent.com/100694515/193691031-1e5af4a3-3636-4f52-a8ae-28fcb736b7d2.png)
Important user facing APIs here:
API | 99th Percentile response time | Call Count  
---|---|---  
POST:/payments | 35.8ms | 1.19k  
GET:/payments | 8.64ms | 16.24k  
POST:/checkout-sessions | 36.3ms | 1.19k  
User (Authenticated) Payment
> Within 1 min, we were able to complete 56 payments due to Stripe response times.  
>  There are no performance bottleneck with convenient checkout APIs observed during the test window.
![PaymentAPIresponsetime](https://user-images.githubusercontent.com/100694515/193691055-51e335e4-c867-474e-8a94-692a87b53867.png)
Important user facing APIs here:
API | 99th Percentile response time | Call Count  
---|---|---  
POST:/payments | 22.1ms | 678k  
GET:/payments | 8.64ms | 37.75k


# Convenient checkout API
Convenient Checkout API service provides a means of executing Restful requests without the use of the Convenient Checkout UI. In order to use any APIs related to Payments, it will require an existing PaymentMethodId in lieu of the card number due to PCI Compliance. Some use cases for APIs are:
  * Recurring payments
  * Wallet Management
  * PCI Payments
  * Capturing an authorized payment


## API SCOPES[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/#api-scopes "Direct link to API SCOPES")
  * `merchant`
  * `merchant-wallet-management`
  * `pci`


## API Architecture[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/#api-architecture "Direct link to API Architecture")
![Snag_7d9c3aa1](https://user-images.githubusercontent.com/100694515/193640369-3aea9d35-1f7b-431c-8881-26cc0586ac88.png)
• Azure Cloud, multi region.
• AKS Azure Kubernetes.
• Multi Cloud API Gateway.
• ISTIO - Ingress Controller.
• Splunk.
• Azure Postgres DB.
## APIs[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/#apis "Direct link to APIs")
In addition to the [HCP API Catalog](https://console.hcp.uhg.com/api-catalog/facets?subdomain=commerce&domain=financial) for the Financial Package: Commerce subpackage, the following APIs are offered as described by the process flows:
## Merchant[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/#merchant "Direct link to Merchant")
![Snag_31def0ea](https://user-images.githubusercontent.com/100694515/202773094-a6e03fc0-a590-4d14-b4b9-5ee8b96a69e8.png)


# Theming and Styling
info
Theming and Styling configuration will be provided as part of request payload in [`/POST sessions`](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post)
Button Theming
  * Widget allows to customize the style for primary and secondary buttons.
  * refer to <https://mui.com/material-ui/customization/palette/> for details


Typography/Font
  * Include _open source font families_ like google fonts or _custom fonts_ from your domain


Merchant Logo
  * Merchants have the option to include their logo by utilizing this designated field. The provided logo should reference a valid URL, as exemplified in the preceding POST example.
  * The merchant logo serves the exclusive purpose of email templates and will undergo automatic resizing to achieve a height of 32px. The width will be dynamically adjusted for optimal presentation.


```
/*  
 * Appearance type for font and theming  
 */  
export type Appearance = {  
  font: {  
    fontSources: (CssFontSource | CustomFontSource)[];  
    fontFamily: string;  
  };  
  palette?: {  
    primary?: PaletteColors;  
    secondary?: PaletteColors;  
  };  
  visibility?: {  
    headerLogo?: boolean; // defaults to true  
  };  
  border?: {  
    alertBoxBorderRadius?: string,  
  
  /**  
   * Apply border radius for 'apple pay' and 'google pay' buttons  
   * defaults to 8px  
   */  
    buttonBorderRadius?: string;  
  };  
  height?: {  
      
  /**  
   * Apply button height for 'apple pay' and 'google pay' buttons  
   * defaults to 48px  
   * valid range: 40-55  
   */  
    button?: number;  
};  
  merchantLogo: string;  
};  
  
export type CssFontSource = {  
  /**  
   * A relative or absolute URL pointing to a CSS file with [@font-face](https://developer.mozilla.org/en/docs/Web/CSS/@font-face) definitions, for example:  
   *  
   *     https://fonts.googleapis.com/css?family=Open+Sans  
   *  
   */  
  CssSrc: string;  
};  
  
export type CustomFontSource = {  
  /**  
   * The name to give the font  
   */  
  family: string;  
  
  /**  
   * A valid [src](https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/src) value pointing to your custom font file.  
   * This is usually (though not always) a link to a file with a `.woff` , `.otf`, or `.svg` suffix.  
   */  
  src: string;  
  
  /**  
   * Defaults to `normal`.  
   */  
  style?: "normal" | "italic" | "oblique";  
  
  /**  
   * A valid [font-weight](https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight), as a string.  
   */  
  weight?: string;  
};  
  
/*  
 * @docs https://mui.com/material-ui/customization/palette/#customization  
 */  
export type PaletteColors = {  
  light?: string;  
  main: string;  
  dark?: string;  
  contrastText?: string;  
};  

```

Example: customize button style
```
const appearance = {  
  palette: {  
    primary: {  
      dark: "#3e561a",  
      main: "#5a7c26",  
      light: "#7b9651",  
      contrastText: "#ffffff",  
    },  
    secondary: {  
      dark: "#b26e59",  
      main: "#ff9e80",  
      light: "#ffb199",  
      contrastText: "#ffffff",  
    },  
  },  
};  

```

Example include open source font (Dosis)
```
const appearance = {  
  font: {  
    fontFamily: "Dosis, Arial, sans-serif",  
    fontSources: [  
      {  
        cssSrc: "https://fonts.googleapis.com/css?family=Dosis",  
      },  
    ],  
  },  
};  

```

Example: include custom font ("Optum Sans")
```
const appearance = {  
  font: {  
    fontFamily: "'Optum Sans', Arial, sans-serif",  
    fontSources: [  
      {  
        family: "Optum Sans",  
        src: "url('https://wallet.healthsafepay.com/optum-sans.woff2')",  
        style: "normal",  
        weight: "700",  
      },  
      {  
        family: "Optum Sans",  
        src: "url('https://wallet.healthsafepay.com/optum-sans.woff2')",  
        style: "normal",  
        weight: "400",  
      },  
    ],  
  },  
};  

```



# Convenient Checkout UI
Convenient Checkout Gateway (CCG) offers two Digital Payment experiences. ![Snag_65855633](https://user-images.githubusercontent.com/100694515/192915847-3883d7f1-f2b5-49e2-8a31-0d10639f9d14.png)
_Embedded Experience_
* * *
  * Fully embedded into the merchant portal
  * Wallet Experience
  * Guest Checkout


_Hosted Experience_
* * *
  * Hosted by CCG
  * Wallet Experience with HealthSafe Pay
  * Guest Checkout


## Embedded Experience[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/#embedded-experience "Direct link to Embedded Experience")
### Fully Embedded Experience[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/#fully-embedded-experience "Direct link to Fully Embedded Experience")
• Member will be authenticated in the Merchant’s Portal.
• Display a member’s digital wallet including their unique payment methods.
• Member can store a new payment method(s) with or without a transaction.
• Member can make a one-time payment without having to store their card details.
• Member can manage their digital wallet (edit, update, delete, etc.)
• Member can select and change a default payment method.
![Snag_65a43557](https://user-images.githubusercontent.com/100694515/192919386-794902f3-1e50-4903-90fd-fe93a78b6e18.png)
### Guest Embedded Experience[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/#guest-embedded-experience "Direct link to Guest Embedded Experience")
• Member can use the Guest Checkout functionality and bypass storing payments in their digital wallet.
• One time payment.
![Snag_65b3304d](https://user-images.githubusercontent.com/100694515/192921353-cfa2734d-1cdd-4c66-bb99-6f1337ad3a56.png)
## Hosted Experience[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/#hosted-experience "Direct link to Hosted Experience")
### Hosted Guest Experience[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/#hosted-guest-experience "Direct link to Hosted Guest Experience")
• Member can use the Guest Checkout functionality and bypass storing payments in their digital wallet.
• One time payment.
![Snag_65c07c79](https://user-images.githubusercontent.com/100694515/192923195-78266a45-87e9-440b-94c2-35e642ccb3bc.png)
## How to add Convenient Checkout Page[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/#how-to-add-convenient-checkout-page "Direct link to How to add Convenient Checkout Page")
Learn about about the different [integration approaches](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#integration-approaches) avaialble to set up digital payment experience to your website and collect payments.


# Embedded Experience
## Setup[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#setup "Direct link to Setup")
### Generate a Session[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#generate-a-session "Direct link to Generate a Session")
  * From the Merchant's backend, make a call to [`/POST sessions`](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post) to generate `session` and pass it to the web app.
  * Widget's capabilities can be customized using `config` property in `session` request object
  * Refer [Generate a Session](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/create-session-request-response/) for details

/POST session (request/response)
```
## /POST sessions request  
curl --location --request POST 'https://api.uhg.com/api/financial/commerce/nonprodcheckout/v1/sessions' \  
--header 'X-Merchant-Id: <x-merchant-id>' \  
--header 'X-Upstream-Env: <x-upstream-env>' \  
--header 'Content-Type: application/json' \  
--header 'Authorization: Bearer <authorization-token>' \  
--data-raw '{  
    "customer": {  
        "firstName": "foo",  
        "lastName": "bar",  
        "email": "foo.bar@email.com",  
        "ssnLastFour": "1234",  
        "dateOfBirth": "1970-31-12",  
        "phoneNumber": {  
            "number": "9876543210",  
            "countryCode": "1"  
        },  
        "zip5": "54321",  
        "hsid": "120c5730-e796-4448-8da9-081fde4e3e79",  
        "metadata": {}  
    },  
    "payment": {  
        "merchantTransactionId": "f32736c8-266a-4da1-af16-293fa02a351a",  
        "amount": 1200,  
        "authorizeCard": false,  
    },  
    "config": {  
        "modes": [  
            "PAYMENT_METHOD_ENTRY"  
        ]  
    }  
}'  

```

```
// /POST sessions reponse  
{  
  "url": "/sessions/<CHECKOUT_SESSION_ID>",  
  "data": {  
    "sessionId": "<CHECKOUT_SESSION_ID>",  
    "hostedUrl": "<CCG_DOMAIN>/checkout-sessions/<CHECKOUT_SESSION_ID>"  
  }  
}  

```

### Load the widget[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#load-the-widget "Direct link to Load the widget")
```
<script src="https://<DOMAIN>.healthsafepay.com/wallet/<VERSION>/<FILE_NAME>.js"></script>  

```

  * Integrate by adding `<script>` tag. `optumCCG` object is added to the global `window` object


To reduce the load time for widget refer to
  * [Improve Page Load Time with cdn](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#improve-page-load-time-with-cdn)


Placeholder values
**DOMAIN** : `walletstage` | `walletprod`   
**VERSION** : v2 see [Version History](https://walletprod.healthsafepay.com/wallet/version-history.html "version history") for more details   
**FILE_NAME** : `ccg-widget.js` | `ccg-widget.min.js`   
**Example:**   
<https://walletstage.healthsafepay.com/wallet/v2/ccg-widget.min.js>   
<https://walletstage.healthsafepay.com/wallet/v2/ccg-widget.js>
### Access the widget initializer[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#access-the-widget-initializer "Direct link to Access the widget initializer")
```
const OptumCCGWidgetInitializer = window.optumCCG.OptumCCGWidgetInitializer;  

```

### Initialize[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#initialize "Direct link to Initialize")
```
const options = {...};  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```

`OptumCCGWidgetInitializer` function is used to setup and manage the widget. This sets up the widget, attaches to DOM and returns the instance
  

See
[OptumCCGWidgetInitializer Method options](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#optumccgwidgetinitializer-method-options)
### Render[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#render "Direct link to Render")
```
ccgWidget.render();  

```

Makes the embedded payment modal window visible on screen. By default, the widget is not visible when attached to DOM
See
[OptumCCGWidgetInitializer instance (render)](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#render-function)
### Full Example[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#full-example "Direct link to Full Example")
```
<!DOCTYPE html>  
<html lang="en">  
  <head>  
    <meta charset="UTF-8" />  
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
    <title>CCG Widget Integration</title>  
  </head>  
  <body>  
    <h1>CCG Widget Integration</h1>  
  
    <button id="payRemainingBalance">Pay Remaining Balance</button>  
  
    <div id="ccg-widget-container"></div>  
  
    <!-- 1. Load the widget -->  
    <script src="https://walletprod.healthsafepay.com/wallet/v2/ccg-widget.min.js"></script>  
    <script>  
      let ccgWidget;  
  
      document  
        .querySelector("#payRemainingBalance")  
        .addEventListener("click", () => {  
          // 2. Initialize widget once  
          if (!ccgWiget) {  
            // 3. Access the widget initializer  
            const OptumCCGWidgetInitializer =  
              window.optumCCG.OptumCCGWidgetInitializer;  
  
            const options = {  
              rootElement: document.querySelector("#ccg-widget-container"),  
              checkoutSessionId: "REPLACE_WITH_CHECKOUT_SESSION_ID",  
              appEnv: "prod",  
              onSuccess: (data) => {},  
              onError: (data) => {},  
              onEvent: (data) => {},  
            };  
            // 4. Initialize  
            ccgWidget = OptumCCGWidgetInitializer(options);  
          }  
  
          // 5. Render  
          ccgWidget.render();  
        });  
    </script>  
  </body>  
</html>  

```

### Removing the widget[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#removing-the-widget "Direct link to Removing the widget")
```
ccgWidget.unmount();  
ccgWidget = null;  

```

This unmounts the widget from the DOM
## Additional Details[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#additional-details "Direct link to Additional Details")
### OptumCCGWidgetInitializer method options[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#optumccgwidgetinitializer-method-options "Direct link to OptumCCGWidgetInitializer method options")
Option | Values | Description  
---|---|---  
rootElement  
required  
`Element` | `Valid DOM node` | CCG Widget will be injected into this DOM node  
checkoutSessionId  
required  
`string` | - | Valid checkout session id  
appEnv  
required  
`string` |  `stage` `prod` | Widget's environment variable  
appearance  
`Appearance` | `default: Optum Theme` | Brand/styling configuration  
[see Theming and Styling](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#theming-and-styling)   
  
deprecated >= 2.1.0   
Refer [`/POST sessions`](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post) on how to pass `appearance` as part of session creation  
containerConfig   
`object`  
[Container Config](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#container-config) | `default: { type: 'modal' }` |   
onSuccess  
`Function`  
[param type](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onsuccess-data) | `(data) => void` | Called when payment is successful  
onError  
`Function`  
[param type](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onerror-data) | `(data) => void` | Called when there is an error with the checkout session or a payment failure  
onEvent  
`Function`  
[param type](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onevent-data) | `(data) => void` | Called for all other events (i.e., widget `loaded`, `open`, `closed`, `PAYMENT_METHOD_SELECTION`)  
### OptumCCGWidgetInitializer instance[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#optumccgwidgetinitializer-instance "Direct link to OptumCCGWidgetInitializer instance")
#### render `Function`[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#render-function "Direct link to render-function")
  * show the widget as a modal
  * _this function would probably be called from your button's onClick handler_


#### unmount `Function`[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#unmount-function "Direct link to unmount-function")
  * unmount widget from host application


### Widget unmounting and re-initialization[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#widget-unmounting-and-re-initialization "Direct link to Widget unmounting and re-initialization")
Following scenarios will require the widget to be unmounted and reinitialized
  * When `onError` is called
  * When `onSuccess` is called


To use the widget again you must:
  * call unmount on the old instance
```
ccgWidget.unmount();  

```

  * initialize the widget again
```
ccgWidget = OptumCCGWidgetInitializer(options); // options includes the new checkout session id  

```

and then
```
ccgWidget.render();  

```



### Guest vs Wallet Experience[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#guest-vs-wallet-experience "Direct link to Guest vs Wallet Experience")
Refer [Guest vs Wallet Experience](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Guest-vs-Wallet-Experience/)
### Managing 'MerchantTransactionId'[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#managing-merchanttransactionid "Direct link to Managing 'MerchantTransactionId'")
Refer [Managing MerchantTransactionId](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/Managing-MerchantTransactionId/)
## Data Models[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#data-models "Direct link to Data Models")
### Callback data[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#callback-data "Direct link to Callback data")
```
{  
  code: string;  
  description?: string;  
  payload?: unknown;  
}  

```

### Container Config[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#container-config "Direct link to Container Config")
Option | Values | Description  
---|---|---  
type  
`modal`, `inline`, `drawer` |  `modal`, `inline`, `drawer` | Embedded experience variant   
defaults to `modal`  
secondaryContainer  
[Secondary Container](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#secondary-container) |  | An optional configuration for a inline modal container  
autoScrollEnabled  
[Auto Scroll](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#auto-scroll) |  | An optional configuration only for inline container, defaults to `false`  
#### Secondary Container[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#secondary-container "Direct link to Secondary Container")
Property | Values | Description  
---|---|---  
type  
`modal` | `modal` |   
#### Auto Scroll[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#auto-scroll "Direct link to Auto Scroll")
Property | Values | Description  
---|---|---  
autoScrollEnabled |  `true`, `false` | defaults to `false`  
#### Container Config Examples[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#container-config-examples "Direct link to Container Config Examples")
##### Modal[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#modal "Direct link to Modal")
```
const modalConfig: ContainerConfig = {  
  type: "modal",  
};  

```

##### Inline[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#inline "Direct link to Inline")
```
const inlineConfig: ContainerConfig = {  
  type: "inline",  
};  
  
const inlineWithSecondaryConfig: ContainerConfig = {  
  type: "inline",  
  secondaryContainer: {  
    type: "modal",  
  },  
};  

```

##### Drawer[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#drawer "Direct link to Drawer")
```
const drawerConfig: ContainerConfig = {  
  type: "drawer",  
};  

```

##### Inline with Auto Scroll[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#inline-with-auto-scroll "Direct link to Inline with Auto Scroll")
```
const inlineConfig: ContainerConfig = {  
  type: "inline",  
  autoScrollEnabled: true,  
};  

```

### onSuccess Data[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onsuccess-data "Direct link to onSuccess Data")
Property | Values  
---|---  
code | `PAYMENT_SUCCEEDED`  
description  
`string` |   
payload   
`CheckoutSession` [details](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#checkoutsession) |   
### onError Data[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onerror-data "Direct link to onError Data")
Property | Type | Values  
---|---|---  
code   
_deprecated in favor of title_ | string |  `INITIALIZATION_ERROR`   
`SESSION_TIMEOUT`   
`SESSION_TIMEOUT`   
`SESSION_ALREADY_PROCESSED`   
`INVALID_REQUEST`   
`PAYMENT_METHOD_ERROR`  
description  
 _deprecated in favor of description_ | string |   
payload _(optional)_ | [CheckoutSession](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#checkoutsession) |   
title | string |  `INITIALIZATION_ERROR`   
`SESSION_TIMEOUT`   
`SESSION_TIMEOUT`   
`SESSION_ALREADY_PROCESSED`   
`INVALID_REQUEST`   
`PAYMENT_METHOD_ERROR`  
detail | string |   
status _(optional)_ | number |   
errorDetails   
_supported starting v2.10.0_   
populated only for payment related error | null or [ErrorDetails](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#error-structure) |   
### onEvent Data[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onevent-data "Direct link to onEvent Data")
Property | Values  
---|---  
code |  `WIDGET_LOADED`   
`WIDGET_OPEN`   
`WIDGET_CLOSED`   
`PAYMENT_METHOD_SELECTION`  
description _(optional)_   
`string` |   
### CheckoutSession[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#checkoutsession "Direct link to CheckoutSession")
```
{  
    checkoutSession: {  
      id: string;  
      customerId: string;  
      paymentId: string;  
      checkoutSessionStatus: 'COMPLETED' | 'FAILED';  
      merchantId: string;  
      vendorMerchantId: string;  
      checkoutRequest: {  
        statementDescriptorSuffix: string;  
        amount: number;  
        merchantTransactionId: string;  
        authorizeCard: boolean; // true = PRE_AUTH; false = SALE;  
        paymentType: string; // DEPRECATED; possible values: SALE, PRE_AUTH;  
        metadata: {  
          [key: string]: string | undefined;  
        };  
      };  
      error: null; // backward compatability only; For error details, inspect 'onError' callbacks  
    };  
  }  

```

## Events[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#events "Direct link to Events")
### onError Scenarios[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onerror-scenarios "Direct link to onError Scenarios")
Network Error
```
{  
  "code": "INITIALIZATION_ERROR",  
  "description": "Network Error"  
}  

```

Attempt to initialize CCG Widget with empty "checkoutSessionId"
```
{  
  code: "INVALID_SESSION",  
  description: "session id is invalid",  
}  

```

Attempt to initialize CCG Widget with an invalid value for "checkoutSessionId" (eg: "a12u", doesn't conform to UUID format)
```
{  
  code: "INVALID_REQUEST",  
  description: "Please review API specs https://docs.healthsafepay.com/api-reference/",  
}  

```

Attempt to initialize CCG Widget with expired "checkoutSessionId"
```
{  
  code: "SESSION_TIMEOUT",  
  description: "session no longer valid",  
}  

```

Attempt to initialize CCG Widget with canceled "checkoutSessionId"
```
{  
  code: "SESSION_CANCELED",  
  description: "Your session is no longer valid",  
}  

```

Attempt to initialize CCG Widget with "checkoutSessionId" that's already processed (succeeded/failed)
```
{  
  code: "SESSION_ALREADY_PROCESSED",  
  description: "session is already processed",  
}  

```

Payment Failure
```
{  
    "code": "PAYMENT_METHOD_ERROR",  
    "description": "Your card has insufficient funds.",  
    "payload": {  
        "checkoutSession": {  
            "checkoutRequest": {  
                "merchantTransactionId": "xxx-xxx-xxx-xxx-xxx",  
                "amount": 1500  
            },  
            "paymentId": "xxx-xxx-xxx-xxx-xxx"  
        }  
    },  
    "detail": "Your card has insufficient funds.",  
    "status": 405,  
    "title": "PAYMENT_METHOD_ERROR"  
}  

```

### onEvent Scenarios[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onevent-scenarios "Direct link to onEvent Scenarios")
Widget loaded
```
{  
  code: "WIDGET_LOADED";  
}  

```

Widget open
```
{  
  code: "WIDGET_OPEN";  
}  

```

Widget closed
```
{  
  code: "WIDGET_CLOSED";  
}  

```

Payment Method Selection
```
{  
  code: "PAYMENT_METHOD_SELECTION";  
}  

```

### onSuccess Scenarios[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onsuccess-scenarios "Direct link to onSuccess Scenarios")
Payment Success
```
{  
    "code": "PAYMENT_SUCCEEDED",  
    "description": "Payment was successfully processed",  
    "payload": {  
        "checkoutSession": {  
            "id": "xxx-xxx-xxx-xxx-xxx",  
            "checkoutRequest": {  
                "paymentType": "SALE",  
                "authorizeCard": false,  
                "merchantTransactionId": "xxx-xxx-xxx-xxx-xxx",  
                "amount": 10012,  
                "statementDescriptorSuffix": null  
            }  
        }  
    },  
    "data": {  
        "sessionId": "xxx-xxx-xxx-xxx-xxx",  
        "status": "COMPLETED",  
        "payment": {  
            "id": "xxx-xxx-xxx-xxx-xxx",  
            "amount": 10012,  
            "description": "xxx-xxx-xxx-xxx-xxx",  
            "merchantTransactionId": "xxx-xxx-xxx-xxx-xxx",  
            "merchantId": "xxx-xxx-xxx-xxx-xxx",  
            "paymentType": "SALE",  
            "currencyCode": "usd",  
            "status": "COMPLETED",  
            "paymentMethodId": "xxx-xxx-xxx-xxx-xxx",  
            "metadata": {  
                "checkoutId": "xxx-xxx-xxx-xxx-xxx",  
                "merchantId": "xxx-xxx-xxx-xxx-xxx",  
                "referenceId": "xxx-xxx-xxx-xxx-xxx",  
                "merchantName": "xxx-xxx-xxx-xxx-xxx",  
                "ccg_nameoncard": "xxx-xxx-xxx-xxx-xxx",  
                "merchantGroupId": "xxx-xxx-xxx-xxx-xxx",  
                "merchantTransactionId": "xxx-xxx-xxx-xxx-xxx",  
                "ccg_paymentmethodnickname": "xxx-xxx-xxx-xxx-xxx"  
            },  
            "error": null,  
            "statementDescriptorSuffix": null,  
            "paymentDetails": {  
                "healthcare": {  
                    "iias": {  
                        "qualifiedAmount": 700,  
                        "qualifiedAmountDetails": {  
                            "prescriptionAmount": 1200  
                        }  
                    },  
                    "visionAmount": 25  
                }  
            },  
            "paymentMethod": null  
        }  
    }  
}  

```

## Theming and Styling[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#theming-and-styling "Direct link to Theming and Styling")
  * Refer [Theming and Styling](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Theming-and-Styling/)


## Alternative Setup - Module (npm/yarn)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#alternative-setup---module-npmyarn "Direct link to Alternative Setup - Module \(npm/yarn\)")
### Install the package[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#install-the-package "Direct link to Install the package")
Package Availability
This package is only available in private [Optum NPM repo (repo1)](https://repo1.uhc.com/ui/packages "repo1").
```
yarn add @optum-ccg/convenient-checkout-ui --save  

```

or
```
npm install @optum-ccg/convenient-checkout-ui --save  

```

### Load the widget[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#load-the-widget-1 "Direct link to Load the widget")
```
import { OptumCCGWidgetInitializer } from "@optum-ccg/convenient-checkout-ui/dist/widget/ccg-widget.min";  

```

### Initialize[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#initialize-1 "Direct link to Initialize")
```
const options = {  
  rootElement: document.querySelector("#ccg-widget-container"),  
  checkoutSessionId: "REPLACE_WITH_CHECKOUT_SESSION_ID",  
  appEnv: "prod",  
};  
// 3. Initialize  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```

### Render[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#render-1 "Direct link to Render")
```
ccgWidget.render();  

```

### Full Example (npm)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#full-example-npm "Direct link to Full Example \(npm\)")
```
import React, { useRef, useState } from "react";  
/* 1. include ccg widget as COMPILE-TIME dependency */  
import { OptumCCGWidgetInitializer } from "@optum-ccg/convenient-checkout-ui/dist/widget/ccg-widget.min";  
  
const PaymentWidget = ({  
  appEnv,  
  checkoutSessionId,  
  containerType,  
  onSuccess,  
  onError,  
  onEvent,  
}) => {  
  /* 4. CCG widget type (required) */  
  let ccgWidget: ReturnType<typeof OptumCCGWidgetInitializer>;  
  const widgetContainer = useRef(null);  
  
  useEffect(() => {  
    if (widgetContainer.current) {  
      // 5. Initialize  
      ccgWidget = OptumCCGWidgetInitializer({  
        rootElement: widgetContainer.current,  
        checkoutSessionId,  
        appEnv,  
        containerConfig: {  
          type: containerType,  
        },  
        onSuccess,  
        onError,  
        onEvent,  
      });  
  
      // 6. display  
      ccgWidget.render();  
    }  
  }, []);  
  
  return <div ref={widgetContainer}></div>;  
};  
  
export default PaymentWidget;  

```

## Improve Page Load Time with cdn[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#improve-page-load-time-with-cdn "Direct link to Improve Page Load Time with cdn")
To Improve the page load time use "async" and "defer" which significantly reduces the "DOMContentloadtime" which doesn't block the page and makes it available for users while the script is being loaded in background.
### Code Snippet for using async and defer[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#code-snippet-for-using-async-and-defer "Direct link to Code Snippet for using async and defer")
```
  document.getElementById("ccgScript").addEventListener("load", (event) => {    
    initWidget();  
    renderWidget();  
  });  
  
  where “ccgScript” is the id for <script > tag for ccg-widget.min.js.  
  
  <script id="ccgScript" src="https://walletprod.healthsafepay.com/wallet/v2/ccg-widget.min.js" async defer></script>   
  

```



# Onboarding


# Ideas
## CCG Idea Intake Process[​](https://docs.healthsafepay.com/docs/ideas/#ccg-idea-intake-process "Direct link to CCG Idea Intake Process")
If you have a new idea for CCG you'd like to share with us, the CCG Product Team will review new idea requests from our partners or clients that fall in one of these categories:
  1. New business enhancements
  2. New technology development


*Note: Issues and/or production defects should be routed to ServiceNow for CCG_Support and not through the Aha Idea Portal.
To submit your idea, please use the Aha Ideas Portal for entering new requests: [New idea | Convenient Checkout Ideas Portal (aha.io)](https://ccoptum.ideas.aha.io/ideas/new)
The CCG Product Team will review all new ideas submitted through the intake portal, and will contact requesters with questions or updates related to their idea(s).
If you have any questions, please reach out to: ConvenientCheckout@ds.uhc.com


# Merchant Onboarding
## Requirements[​](https://docs.healthsafepay.com/docs/onboarding/Merchant-Onboarding/#requirements "Direct link to Requirements")
  * [Merchant details](https://docs.healthsafepay.com/docs/onboarding/Merchant-Onboarding/#merchant-information)
  * [Webhooks](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Configuration/)
  * [Reports](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/introduction/)


### Merchant Information[​](https://docs.healthsafepay.com/docs/onboarding/Merchant-Onboarding/#merchant-information "Direct link to Merchant Information")
  * Merchant Name
  * Customer Identifiers
  * [Payment Method Settings](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/)
  * [Stripe Connect Account Id](https://docs.healthsafepay.com/docs/developers/onboarding/stripe-configuration/#create-connect-account)
  * [WS2Check](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/ws2/)
  * [Language Preference](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Languages/)




# Overview
Convenient Checkout Gateway (CCG) is aligning payment experiences with consumer expectations.
## WHY[​](https://docs.healthsafepay.com/docs/overview/#why "Direct link to WHY")
![Snag_834ff02d](https://user-images.githubusercontent.com/100694515/193914167-fa9ef07d-0514-406c-8fe7-347ca85973ed.png)
## WHAT[​](https://docs.healthsafepay.com/docs/overview/#what "Direct link to WHAT")
Broad capabilities to meet evolving payment needs ![Snag_83819ab6](https://user-images.githubusercontent.com/100694515/193926034-f2388922-bc8f-4f9b-b092-7c57b6ace25e.png)
## HOW[​](https://docs.healthsafepay.com/docs/overview/#how "Direct link to HOW")
Built on flexible and reusable technology and integrations ![Snag_838833cd](https://user-images.githubusercontent.com/100694515/193927678-73a180c0-1920-412a-ab72-3c87b7decf6f.png)


# Reporting data
## Types of Data[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#types-of-data "Direct link to Types of Data")
Depending on the audience of Payout report, it will be composed of the combination of four categories of data:
  * [Reporting data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#reporting-data)
    * [Types of Data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#types-of-data)
      * [CCG specific metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-specific-metadata)
        * [CCG Payment metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-payment-metadata)
        * [CCG Refund metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-refund-metadata)
      * [Merchant specific metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-specific-metadata)
        * [Merchant Payment metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-payment-metadata)
        * [Merchant Refund Metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-refund-metadata)
      * [Transaction data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#transaction-data)
      * [Fee data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#fee-data)


### CCG specific metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-specific-metadata "Direct link to CCG specific metadata")
CCG will always include the following metadata in payments and other transactions.
#### CCG Payment metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-payment-metadata "Direct link to CCG Payment metadata")
Field Name | Description | Sample value  
---|---|---  
checkoutId | CCG unique checkout identifier | 434189e3-e63v-47ef-a8fc-0d9a6d22f6c8  
merchantGroupId | CCG merchant Group Identifier composed of different Merchants belonging to a same group | 98da3d38-ff4j-44ee-be00-c47a94ed01a4  
merchantId | CCG unique merchant identifier | d4d9760a-9cea-45h8-a25d-e6a3612e479a  
merchantName | CCG merchant name | someNewMerchant-merchant-stage  
merchantTransactionId | Merchant payment transaction identifier | cef9923e-9fe0-4679-82hf-7151fe311cbb  
referenceId | CCG unique reference identifier | e1837bc7-f5b3-4f52-bfrg-77e8d1cc95a0  
ccg_processor | CCG processor | STRIPE  
ccg_paymentmethodlast4 | CCG payment method last 4 | 1234  
ccg_nameoncard | CCG name that was entered for the card | Shahrukh Khan  
ccg_paymentmethodnickname | CCG nickname for customers payment method | personal WF Master  
ccg_paymentMethodId | CCG Payment method id | 534179e3-redv-47ef-a7fc-0d9a5d22f6c7  
merchantTransactionId | merchant unique Transaction identifier | cef9923e-9fe0-4679-82hf-7151fe311cbb  
#### CCG Refund metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-refund-metadata "Direct link to CCG Refund metadata")
Field Name | Description | Sample value  
---|---|---  
ccg_refundId | CCG unique refund identifier | bf75eb27-7b1f-4171-b27f-099a284f5540  
merchantTransactionId | Merchant refund transaction identifier | cef9923e-9fe0-4679-82hf-7151fe312cbe  
### Merchant specific metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-specific-metadata "Direct link to Merchant specific metadata")
Merchant chosen data that may be beneficial to tie back to Merchant records for reconciling, reporting etc. Merchant can have payment or refund specific metadata.
#### Merchant Payment metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-payment-metadata "Direct link to Merchant Payment metadata")
Some examples of Payment meta data:
Field Name | Description | Sample value  
---|---|---  
ItemCode | Merchants unique code for an Item | 3456-4876  
orderId | Merchant unique orderId | 98da3d38-ff4j-44ee-be00-c47a94ed01a4  
siteName | Merchant site where payment is initiated from | [www.somesitename.com](http://www.somesitename.com)  
claimId | Merchant unique claim identifier payment is made for | ABCDE-12345  
InvoiceNumber | Merchant unique Invoice number payment is made for | 34987  
#### Merchant Refund Metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-refund-metadata "Direct link to Merchant Refund Metadata")
Some examples of Refund meta data:
Field Name | Description | Sample value  
---|---|---  
Refund_ID | Merchants refund Identifier | 3456-4876  
Claim_ID | Claim ID the refund will go towards | ABCDF-12346  
### Transaction data[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#transaction-data "Direct link to Transaction data")
Field Name | Description | Sample value  
---|---|---  
customer_name | Name of the customer, if any, associated with the transaction | John Smith  
customer_email | Email address of the customer, if any, associated with the transaction | testcustomer@gmail.com  
reporting_category | Categorization of transaction | charge  
charge_created_utc | Creation time of the original charge associated with this balance transaction. Available for charges, refunds and disputes. For charges that were separately authorized and captured, this is the authorization time. Dates in UTC. | 2023-08-16 10:14:30  
payment_method_type | The type of payment method used in the related payment. | card  
dispute_reason | Reason given by cardholder for dispute | fraudulent  
shipping_address_postal_code | Postal code of the shipping address associated with this charge, if any | 123456  
currency | Three-letter ISO code for the currency in which the gross, fee and net amounts are defined | usd  
created_utc | Time at which the balance transaction was created. Dates in UTC. | 2023-08-16 10:15:32  
available_on_utc | The date the balance transaction’s net funds will become available in the Stripe balance. Dates in UTC. | 2023-08-23 12:00:00  
gross | Gross amount of the transaction. Expressed in major units of the currency | 35.33  
net | Net amount of the transaction. Expressed in major units of the currency | 34.01  
fee | Fees paid for this transaction Expressed in major units of the currency | 1.32  
description | Payment description that will be useful to a Merchant to identify the payment | UI widget payment  
card_brand | CCG merchant name, set up when the merchant is onboarded | Possible values:AMEX, CARTES_BANCAIRES, DINERS, DISCOVER, INTERAC, JCB, MASTERCARD, UNIONPAY, VISA, UNKNOWN  
card_funding | CCG merchant name, set up when the merchant is onboarded | Possible values:CREDIT, DEBIT, PREPAID, UNKNOWN  
processor | Who processed the transaction | STRIPE  
payment_method_last4 | The last four of the payment method account/card number | 1234  
### Fee data[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#fee-data "Direct link to Fee data")
Field Name | Description | Sample value  
---|---|---  
balance_transaction_created_at | Creation time of this balance transaction Dates in UTC. | 2024-04-02 08:22:00  
balance_transaction_reporting_category | Categorization of balance transaction | charge  
balance_transaction_component |  | per_auth_fee  
event_type | The originating type of event | charge_authorized  
activity_at | The time associated with this balance transaction. Dates in UTC. | 2024-04-01 23:37:00  
activity_interval_type | The transaction time interval | instant  
activity_start_date | The transaction start time. Dates in UTC. | 2024-04-01  
activity_end_date | The transaction end time. Dates in UTC. | 2024-04-01  
amount | Amount of the transaction in major units | 25.000000  
balance_transaction_description | Description of the transaction | SALE Transaction  
card_address_postal_code | Postal code of the card address | 12345  
automatic_payout_effective_at | The expected automatic payout date. Dates in UTC. | 2024-04-03 00:05:00:00  
card_country | The two-letter ISO country code | US  
statement_descriptor





# Introduction
## What is report?[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/introduction/#what-is-report "Direct link to What is report?")
Reports in a payment gateway refer to the detailed information and data related to transactions processed through the gateway. These reports provide valuable insights into the financial activity of an organization, including details such as successful and failed transactions, transaction amounts, payment statuses, customer information, and more.
Payment gateway reports typically include various types of reports such as transaction reports, settlement reports, reconciliation reports, chargeback reports, and refund reports. These reports help businesses track and monitor their financial transactions, analyze payment trends, reconcile accounts, and make informed decisions based on the data provided.
Overall, reports in a payment gateway play a crucial role in helping businesses manage their payment processing operations efficiently and effectively.
## What are all the reports offered by CCG?[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/introduction/#what-are-all-the-reports-offered-by-ccg "Direct link to What are all the reports offered by CCG?")
Convenient Checkout Gateway (CCG) will provide payout reports via Electronic Communication Gateway(ECG).  
A Payout report is a reconciliation report to help match the payouts received in the Merchants bank account with the payments and other transactions that they relate to. There are two types of payout reports:
  * [Individual Payout](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Merchant-payout/) for Merchants and Finance team
  * [Combined Payout](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Combined%20Report/) for Treasury Team
  * [Transaction-Level Fee report](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Transaction-level-fee-report/) for Merchants




# Webhook Configuration
  1. Merchant should expose a https endpoint that should be reachable in public internet.
  2. Merchant should validate the request using the Authorization token that comes as part of the request header. The authorization token is a JWT token. A public key for validating the token will be provided as a part of Merchant onboarding by CCG team.


### Validating the JWT Authorization Token[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Configuration/#validating-the-jwt-authorization-token "Direct link to Validating the JWT Authorization Token")
The **JWT token** will be sent as **Authorization Header** in the HTTPS request.
```
# Header  
Authorization:Bearer eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ7bWVyY2hhbnRJZH0iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTUxNjI0OTAyMn0.188mvtjbW1xf6fCFNun0ZjlreckxFnUEEGZO-rvvdp3II-70C-M_W7QP6Dm7B57qnZJq6lPWxCjJnbF3hkTtAg  

```

The JWT token should be validated for
  1. Expiry
  2. Signature


The JWT tokens will be signed using **ES256** (Eliptical Curve Cryptography with 256 bit hashing) algorithm.


# Partial Authorization
##### Partial authorization[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Partial%20Authorization/#partial-authorization-1 "Direct link to Partial authorization")
```
{  
    "name": "PAYMENT_AUTHORIZED",  
    "payload": {  
        "amount": 5000,  
        "capturedAmount": 0,  
        "authorizedAmount": 3500,  
        "partialAuthorization": true,  
        "description": "Test Payment from Postman_16",  
        "id": "2b12ce09-73eb-43c3-b39b-89419f319746",  
        "merchantId": "44387763-4eeb-4592-a564-b10aadee95be",  
        "merchantTransactionId": "100ee626-0795-4b5e-b0d9-c543868207b1",  
        "paymentDateUtc": "2024-05-06T12:43:19.550101",  
        "paymentMethod": {  
            "card": {  
                "cardBrand": "VISA",  
                "expiryMonth": 5,  
                "expiryYear": 2055,  
                "last4": "0014",  
                "status": "ACTIVE",  
                "manufacturerCard": false  
            },  
            "paymentMethodType": "CARD",  
            "paymentMethodDetails": {  
                "type": "CARD",  
                "cardBrand": "VISA",  
                "expiryMonth": 5,  
                "expiryYear": 2055,  
                "last4": "0014",  
                "status": "ACTIVE",  
                "manufacturerCard": false  
            },  
            "default": false  
        }  
    }  
}  

```



# Disputes
Using the webhook, merchant application can get real time updates on the dispute status and dispute related events.
## Disputes[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Disputes/#disputes-1 "Direct link to Disputes")
### Supported Events[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Disputes/#supported-events "Direct link to Supported Events")
Event Type | Description | Applicable payment method types  
---|---|---  
DISPUTE_WON | Emitted when dispute is won and funds are reinstated. | CARD, BANK_ACCOUNT  
DISPUTE_LOST | Emitted when dispute is lost. ` | CARD, BANK_ACCOUNT  
DISPUTE_INITIATED | Emitted when a dispute is created and funds are withdrawn. | CARD, BANK_ACCOUNT  
### Event Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Disputes/#event-structure "Direct link to Event Structure")
Field | Type | Valid values | Description  
---|---|---|---  
name | Enum | DISPUTE_WON, DISPUTE_LOST, DISPUTE_INITIATED | Event name  
payload | [Payload](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Disputes/#payload-structure) |  | Event Payload  
#### Payload Structure Sample[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Disputes/#payload-structure-sample "Direct link to Payload Structure Sample")
```
{  
   "amount": 50,  
   "eventType": "DISPUTE_INITIATED||DISPUTE_WON||DISPUTE_LOST",  
   "merchantTransactionId": "3ecd813a-12dd-4135-ac4e-9f400d5181fb",  
   "merchantId": "8e44f962-36bf-4eef-b80c-fd6a23029800",  
   "evidence": {  
      "access_activity_log": null,  
      "billing_address": "IN",  
      "cancellation_policy": null,  
      "cancellation_policy_disclosure": null,  
      "cancellation_rebuttal": null,  
      "customer_communication": null,  
      "customer_email_address": null,  
      "customer_name": "Devender",  
      "customer_purchase_ip": null,  
      "customer_signature": null,  
      "duplicate_charge_documentation": null,  
      "duplicate_charge_explanation": null,  
      "duplicate_charge_id": null,  
      "product_description": null,  
      "receipt": null,  
      "refund_policy": null,  
      "refund_policy_disclosure": null,  
      "refund_refusal_explanation": null,  
      "service_date": null,  
      "service_documentation": null,  
      "shipping_address": null,  
      "shipping_carrier": null,  
      "shipping_date": null,  
      "shipping_documentation": null,  
      "shipping_tracking_number": null,  
      "uncategorized_file": null,  
      "uncategorized_text": null  
   },  
   "reason": "FRAUDULENT",  
   "status": "NEEDS_RESPONSE",  
   "paymentType": "CARD",  
   "balanceTransactions": [  
      {  
         "amount": -50,  
         "available_on": 1716854400,  
         "created": 1716283111,  
         "currency": "usd",  
         "description": "Chargeback withdrawal for ch_3PIoq2I4dYE13Vva13lNTr3y",  
         "exchange_rate": null,  
         "fee": 1500,  
         "fee_details": [  
            {  
               "amount": 1500,  
               "application": null,  
               "currency": "usd",  
               "description": "Dispute fee",  
               "type": "stripe_fee"  
            }  
         ],  
         "id": "txn_1PIoq3I4dYE13VvaWkU6uYvT",  
         "net": -1550,  
         "object": "balance_transaction",  
         "reporting_category": "dispute",  
         "source": "dp_1PIoq2I4dYE13Vva263rszkj",  
         "status": "pending",  
         "type": "adjustment"  
      }  
   ]  
}  

```



# Refunds
Refund events are sent when a refund is processed. Refunds can be processed for both CARD and BANK_ACCOUNT payment methods. There are two types of refunds that can be processed i.e., `linked` and `unlinked` refunds.
  * **Linked refunds** are **processed against a payment** and unlinked refunds are processed without a payment.
  * In case of **unlinked refunds** i.e., credit / cashback, **payment method id** is needed to process the refund.


### Supported Events[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#supported-events "Direct link to Supported Events")
Event Type | Description | Applicable payment method types  
---|---|---  
REFUND_SUCCESS | Emitted when refund is successful. | CARD, BANK_ACCOUNT  
REFUND_FAILED | Emitted when a refund fails. | CARD, BANK_ACCOUNT  
REFUND_PENDING | Emitted when a refund status is pending. | CARD, BANK_ACCOUNT  
### Event Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#event-structure "Direct link to Event Structure")
Field | Type | Valid values | Description  
---|---|---|---  
name | Enum | REFUND_SUCCESS, REFUND_FAILED, REFUND_PENDING | Event name  
source | string | Max length 50 | Indicates the X-source header value received in API request  
payload | [Payload](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#payload-structure) |  | Event Payload  
#### Payload Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#payload-structure "Direct link to Payload Structure")
Field | Type | Valid values | Description  
---|---|---|---  
amount | long | 50 - 99999999 | Refund amount in United States Cents  
reason | String | Max length 50 | Refund reason  
refundId | uuid | valid uuid4 | Refund Identifier  
Payment | [Payment](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#payload-structure) |  | Payment Details  
merchantTransactionId | String | Max length 50 | MerchantTransactionId sent by the merchant with original refund request  
merchantId | uuid | valid uuid4 | Merchant Identifier  
metadata | String | Max length 50 | Client provided additional metadate  
paymentMethod | [PaymentMethod](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#paymentmethod-structure) |  | Paymentmethod Description  
customer | [Customer](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#customer-structure) |  | Customer Description  
error | [Error](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#error-structure) |  | Error Information  
status | String | PENDING, COMPLETED, FAILED | Refund Status  
### Customer Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#customer-structure "Direct link to Customer Structure")
Field | Type | Valid values | Description  
---|---|---|---  
enterpriseId | string | Max length | Enterprise Identifier  
hsid | uuid | valid uuid4 | Healthsafe Identifier  
metadata | Object |  | Client provided additional metadata  
firstName | String |  | first name  
lastName | String |  | last name  
email | String |  | email address  
ssnLastFour | Digits (4) |  | SSN last four digits, e.g 1234  
phoneNumber | Object |  | Contains both the phone number and the country code  
└─ number | Digits (10-20) |  | Phone number, e.g. 9876543210  
└─ countryCode | Digits (1-3) |  | Country code, e.g. 91  
dateOfBirth | Date (YYYY-MM-DD) |  | Date of Birth, e.g. 1975-11-14  
zip5 | Digits (5) |  | ZIP Code, e.g. 10001  
#### Error Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#error-structure "Direct link to Error Structure")
Field | Type | Valid values | Description  
---|---|---|---  
code | string | Max length 50 | Short code for error  
description | string | Max length 255 | Error description  
errorDetails | [ErrorDetails](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#error-details-structure) |  | Error details  
#### Error Details Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#error-details-structure "Direct link to Error Details Structure")
Field | Type | Valid values | Description  
---|---|---|---  
code | string | Max length 100 | code for error  
message | string | Max length 255 | Error description  
declineCode | string | Max length 100 | Decline Code  
networkAdviceCode | string | Max length 100 | Network Advice Code  
networkDeclineCode | string | Max length 100 | Network Decline Code  
#### Sample Event[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Refunds/#sample-event "Direct link to Sample Event")
Events will be sent in JSON format.
```
{  
    "name": "REFUND_SUCCESS | REFUND_FAILED  | REFUND_PENDING",  
    "source": "vendor-portal",  
    "payload": {  
        "amount": 100,  
        "reason": "DUPLICATE",  
        "status": "COMPLETED",  
        "payment": {  
            "id": "d3398a06-e038-4aaa-9a6f-08e6884b6aa9",  
            "amount": 900000,  
            "merchantId": "b955db5e-aef2-47de-bbb9-c80b9cc16e8f",  
            "description": "UI widget payment",  
            "capturedAmount": 900000,  
            "partialAuthorization": false,  
            "merchantTransactionId": "68da00a3-d96c-4731-ad9c-f7b4f005b04c"  
        },  
        "refundId": "242ecd9b-333a-4537-ba95-bea1de6ce973",  
        "merchantId": "b955db5e-aef2-47de-bbb9-c80b9cc16e8f",  
        "customer": {    
             "name": null,    
             "firstName": "John",    
             "lastName": "Doe",    
             "email": "test@mail.com",    
             "ssnLastFour": "6785",    
             "dateOfBirth": "2000-09-21",    
             "hsid": "62b737bf-ca25-4319-b2b7-05d0fd684654",    
             "enterpriseId": null,    
             "zip5": null,    
             "phoneNumber": {    
                "number": "9876543210",    
                "countryCode": "91"    
             },    
             "metadata": {  
                "patientId": "rx-patient-id"  
            }    
        },  
        "paymentMethod": {  
            "card": {  
                "last4": "4444",  
                "status": "ACTIVE",  
                "zipCode": "94043",  
                "cardBrand": "MASTERCARD",  
                "expiryYear": 2026,  
                "nameOnCard": "Card Holder Name",  
                "expiryMonth": 12,  
                "manufacturerCard": false  
            },  
            "default": false,  
            "nickname": "",  
            "paymentMethodType": "CARD",  
            "paymentMethodDetails": {  
                "type": "CARD",  
                "last4": "4444",  
                "status": "ACTIVE",  
                "zipCode": "94043",  
                "cardBrand": "MASTERCARD",  
                "expiryYear": 2026,  
                "nameOnCard": "Card Holder Name",  
                "expiryMonth": 12,  
                "manufacturerCard": false  
            }  
        },  
        "merchantTransactionId": "b6d52a1f-b4e7-4de7-85de-9bd5032d7643"  
    },  
    "error": {  
        "code": "VENDOR_ERROR",  
        "message": "Cannot issue refund on expired or cancelled card",  
        "declineCode": "generic_decline",  
        "errorDetails": null  
    }  
}  

```



# Payment Method
### Supported Events[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#supported-events "Direct link to Supported Events")
  * PAYMENT_METHOD_CREATED - Emitted when a payment method is created.
  * PAYMENT_METHOD_UPDATED - Emitted when a payment method is updated.
  * PAYMENT_METHOD_DELETED - Emitted when a payment method is deleted.
  * PAYMENT_METHOD_REPLACED - Emitted when a payment method is replaced, [find more details here](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Replace-Payment-Method/).


### Event Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#event-structure "Direct link to Event Structure")
Field | Type | Valid values | Description  
---|---|---|---  
name | Enum | PAYMENT_METHOD_CREATED, PAYMENT_METHOD_UPDATED, PAYMENT_METHOD_DELETED, PAYMENT_METHOD_REPLACED | Event name  
source | string | Max length 50 | Indicates the X-source header value received in API request  
payload | [Payload](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#payload-structure-1) |  | Event Payload  
#### Payload Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#payload-structure "Direct link to Payload Structure")
Field | Type | Valid values | Description  
---|---|---|---  
paymentMethod | [PaymentMethod](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#paymentmethod-structure) |  | Paymentmethod Description  
customer | [Customer](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#customer-structure) |  | Customer Description  
agent | [Agent](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#agent-structure) |  | Agent Description  
deletedPaymentMethodId | UUID | Valid UUID | Deleted PaymentMethod Id, in PAYMENT_METHOD_REPLACED event  
#### Customer Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#customer-structure "Direct link to Customer Structure")
Field | Type | Valid values | Description  
---|---|---|---  
enterpriseId | string | Max length | Enterprise Identifier  
hsid | uuid | valid uuid4 | Healthsafe Identifier  
metadata | Object |  | Client provided additional metadata  
firstName | String |  | first name  
lastName | String |  | last name  
dateOfBirth | Date (YYYY-MM-DD) |  | Date of Birth, e.g. 1975-11-14  
email | String |  | email address  
ssnLastFour | Digits (4) |  | SSN last four digits, e.g 1234  
phoneNumber | Object |  | Contains both the phone number and the country code  
└─ number | Digits (10-20) |  | Phone number, e.g. 9876543210  
└─ countryCode | Digits (1-3) |  | Country code, e.g. 91  
zip5 | Digits (5) |  | ZIP Code, e.g. 10001  
#### Agent Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#agent-structure "Direct link to Agent Structure")
Field | Type | Valid values | Description  
---|---|---|---  
firstName | string | Max length 50 | First name of Agent  
lastName | string | Max length 50 | First name of Agent  
userId | string | Max length 50 | MSId of Agent  
isAccessVerified | boolean | true/false | Is access verified by merchant  
#### Paymentmethod Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#paymentmethod-structure "Direct link to Paymentmethod Structure")
Field | Type | Valid values | Description  
---|---|---|---  
id | uuid | valid uuid4 | Payment method Id  
~~card~~ | [Card](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#card-structure) |  | Card Description when payment Method is of type CARD.   
**Deprecated in favour of paymentMethodDetails**  
nickname | string | Max length 50 | Payment method nickname  
default | boolean | true/false | determines if the payment method is default for the customer  
paymentMethodType | string | Max length 50 | Payment method type can be CARD or BANK_ACCOUNT  
paymentMethodDetails |  [Card](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#card-structure) or [ACH](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#ach-structure) |  | One of Card or ACH  
#### Card Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#card-structure "Direct link to Card Structure")
Field | Type | Valid values | Description  
---|---|---|---  
nameOnCard | string | Max length 50 | Name of the customer  
cardBrand | string | VISA, AMEX, DINERS, DISCOVER, JCB, MASTERCARD, UNIONPAY, UNKNOWN | Card brand  
expiryMonth | long | 01-12 | Month of expiration  
expiryYear | long | Max length 4 | Year of expiration  
last4 | string | Max length 4 | Last four digits of the card  
zipCode | string | Max length 5 | 5 digit zipcode  
status | string | ACTIVE/EXPIRED | Status of the card  
manufacturerCard | boolean | true/false | Determines if the card is manufacturer card or not. Only Agents can flag certain cards as manufacturer cards. Cards flagged as manufacturer cards cannot be default card.  
#### ACH Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#ach-structure "Direct link to ACH Structure")
Field | Type | Valid values | Description  
---|---|---|---  
type | string | BANK_ACCOUNT | Type of the PaymentMethod  
accountHolderType | string | individual or company | Account holder type  
accountType | string | checking or savings | Account Type  
bankName | string |  | Bank Name  
last4 | string |  | Last 4 digits of bank account number  
routingNumber | string |  | Routing number of bank  
nameOnAccount | string |  | Name on Account  
status | enum | ACTIVE and INVALIDATED | Bank Account Status  
#### Sample Event[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#sample-event "Direct link to Sample Event")
Events will be sent in JSON format.
##### CARD Payment Method[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#card-payment-method "Direct link to CARD Payment Method")
**_card_** object under paymentMethod is deprecated in favor of paymentMethodDetails. Please refer [PaymentMethod](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#paymentmethod-structure) for more details.
```
{  
    "name": "PAYMENT_METHOD_CREATED | PAYMENT_METHOD_UPDATED | PAYMENT_METHOD_DELETED | PAYMENT_METHOD_REPLACED",  
    "source": "vendor-portal",  
    "payload": {  
        "paymentMethod": {  
            "id": "497f6eca-6276-4993-bfeb-53cbbbba6f08",  
            "card": {  
                "last4": "string",  
                "type" : "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
             "paymentMethodDetails": {  
                "last4": "string",  
                "type" : "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
            "default": true,  
            "paymentMethodType": "CARD",  
            "nickname": "string"  
        },  
        "customer": {    
             "name": null,    
             "firstName": "John",    
             "lastName": "Doe",    
             "email": "test@mail.com",    
             "ssnLastFour": "6785",    
             "dateOfBirth": "2000-09-21",    
             "hsid": "62b737bf-ca25-4319-b2b7-05d0fd684654",    
             "enterpriseId": enterprise id,    
             "zip5": null,    
             "phoneNumber": {    
             "number": "9876543210",    
             "countryCode": "91"    
             },    
             "metadata": {  
                "patientId": "rx-patient-id"  
            }    
        },  
        "agent": {  
            "firstName": "First Name",  
            "lastName": "Last Name",  
            "userId": "msId",  
            "isAccessVerified": true  
        },  
        "deletedPaymentMethodId": "597f6eca-6276-4993-bfeb-53cbbbba6f12"  
    }  
}  

```

##### BankAccount Payment Method[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#bankaccount-payment-method "Direct link to BankAccount Payment Method")
```
{  
    "name": "PAYMENT_METHOD_CREATED | PAYMENT_METHOD_UPDATED | PAYMENT_METHOD_DELETED | PAYMENT_METHOD_REPLACED",  
    "source": "vendor-portal",  
    "payload": {  
        "paymentMethod": {  
            "id": "497f6eca-6276-4993-bfeb-53cbbbba6f08",  
            "paymentMethodType": "BANK_ACCOUNT",  
            "paymentMethodDetails": {  
                "type": "BANK_ACCOUNT",  
                "accountHolderType": "individual",  
                "accountType": "checking",  
                "bankName": "STRIPE TEST BANK",  
                "last4": "6789",  
                "routingNumber": "110000000",  
                "nameOnAccount": "Name on account test",  
                "status": "ACTIVE"  
            },  
            "nickname": "Nickname test",  
            "default": true  
        },  
        "customer": {    
             "name": null,    
             "firstName": "John",    
             "lastName": "Doe",    
             "email": "test@mail.com",    
             "ssnLastFour": "6785",    
             "dateOfBirth": "2000-09-21",    
             "hsid": "62b737bf-ca25-4319-b2b7-05d0fd684654",    
             "enterpriseId": enterprise id,    
             "zip5": null,    
             "phoneNumber": {    
                "number": "9876543210",    
                "countryCode": "91"    
             },    
             "metadata": {  
                "patientId": "rx-patient-id"  
            }    
        },  
        "agent": {  
            "firstName": "First Name",  
            "lastName": "Last Name",  
            "userId": "msId",  
            "isAccessVerified": true  
        },  
        "deletedPaymentMethodId": "597f6eca-6276-4993-bfeb-53cbbbba6f12"  
    }  
}  

```



# Payments
### Supported Events[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#supported-events "Direct link to Supported Events")
Event Type | Description | Applicable payment method types  
---|---|---  
PAYMENT_SUCCEEDED | Emitted when payment is captured and is successful. | CARD, BANK_ACCOUNT  
PAYMENT_SUCCEDED | Emitted when payment is captured and is successful. **`Will be deprecated** ` | CARD, BANK_ACCOUNT  
PAYMENT_FAILED | Emitted when a payment fails. | CARD, BANK_ACCOUNT  
PAYMENT_ACCEPTED | Emitted when a payment is submitted successfully and is being processed. | CARD, BANK_ACCOUNT  
PAYMENT_AUTHORIZED | Emitted when a payment is AUTHORIZED. Authorized payment should be captured later using capture endpoint to complete the payment. | CARD  
PAYMENT_CANCELED | Emitted when a payment is canceled. | CARD, BANK_ACCOUNT  
### Event Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#event-structure "Direct link to Event Structure")
Field | Type | Valid values | Description  
---|---|---|---  
name | Enum | PAYMENT_SUCCEEDED, PAYMENT_FAILED, PAYMENT_ACCEPTED, PAYMENT_AUTHORIZED, PAYMENT_CANCELED | Event name  
source | string | Max length 50 | Indicates the X-source header value received in API request  
payload | [Payload](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#payload-structure) |  | Event Payload  
### Payload Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#payload-structure "Direct link to Payload Structure")
Field | Type | Valid values | Description  
---|---|---|---  
amount | long | 50 - 99999999 | Amount (in cents) requested for payment  
authorizedAmount | long | 50 - 99999999 | (PRE_AUTH) Maximum amount approved for capture (in cents); Starting R27, pre-authorization and partial-authorization, should infer this field to consider authorized amount; Prior to R27, infer `amount` field;  
capturedAmount | long | 50 - 99999999 | (SALE) Amount(in cents) immediately settled. (PRE_AUTH) Amount(in cents) successfully captured.  
partialAuthorization | boolean | true/false | (PRE_AUTH) Indicates whether a partial authorization was requested.  
description | string | Max length 50 | Payment Description  
id | uuid | valid uuid4 | Payment Identifier  
merchantId | uuid | valid uuid4 | Merchant Identifier  
merchantTransactionId | string | Max length 50 | MerchantTransactionId sent by the merchant with original payment request  
paymentDateUtc | date | Date in ISO string format | Payment completed datetime  
paymentMethod | [PaymentMethod](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#paymentmethod-structure) |  | Paymentmethod Description  
customer | [Customer](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#customer-structure) |  | Customer Description  
error | [Error](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#error-structure) |  | Error Information  
consent | [Consent](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#consent-structure) |  | Consent required for bank account payments  
#### Customer Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#customer-structure "Direct link to Customer Structure")
Field | Type | Valid values | Description  
---|---|---|---  
enterpriseId | string | Max length | Enterprise Identifier  
hsid | uuid | valid uuid4 | Healthsafe Identifier  
metadata | Object |  | Client provided additional metadata  
firstName | String |  | first name  
lastName | String |  | last name  
dateOfBirth | Date (YYYY-MM-DD) |  | Date of Birth, e.g. 1975-11-14  
email | String |  | email address  
ssnLastFour | Digits (4) |  | SSN last four digits, e.g 1234  
phoneNumber | Object |  | Contains both the phone number and the country code  
└─ number | Digits (10-20) |  | Phone number, e.g. 9876543210  
└─ countryCode | Digits (1-3) |  | Country code, e.g. 91  
zip5 | Digits (5) |  | ZIP Code, e.g. 10001  
#### Consent Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#consent-structure "Direct link to Consent Structure")
Field | Type | Valid values | Description  
---|---|---|---  
merchantConsentId | string | Valid UUID | Consent Id  
merchantConsentText | string |  | Consent text  
collectionTimestamp | string |  | Timestamp of when the consent was collected  
collectionDetails | [ConsentCollectionDetails](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#consent-collection-details-structure) |  | Details about how consent was collected  
#### Consent Collection Details Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#consent-collection-details-structure "Direct link to Consent Collection Details Structure")
Field | Type | Valid values | Description  
---|---|---|---  
type | enum | WEB, TEL, PPD | Consent type  
web | [ConsentCollectionWeb](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#consent-collection-web-structure) |  | Details of consent collected through the website  
tel | [ConsentCollectionTel](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#consent-collection-tel-structure) |  | Details of consent collected through the telephone  
#### Consent Collection Web Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#consent-collection-web-structure "Direct link to Consent Collection Web Structure")
Field | Type | Valid values | Description  
---|---|---|---  
ipAddress | string | Valid IP address | IP address from which the consent is collected  
userAgent | string |  | Agent involved in the consent collection  
#### Consent Collection Tel Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#consent-collection-tel-structure "Direct link to Consent Collection Tel Structure")
Field | Type | Valid values | Description  
---|---|---|---  
phoneNumber | [PhoneNumber](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#phone-number-structure) | Valid country code and phone number | Phone number from which the consent is collected  
#### Phone Number Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#phone-number-structure "Direct link to Phone Number Structure")
Field | Type | Valid values | Description  
---|---|---|---  
countryCode | string | Valid country code | Country code  
number | string | Valid phone number | Phone number  
#### Paymentmethod Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#paymentmethod-structure "Direct link to Paymentmethod Structure")
Field | Type | Valid values | Description  
---|---|---|---  
id | uuid | valid uuid4 | Payment method Id  
~~card~~ | [Card](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#card-structure) |  | Card Description when payment Method is of type CARD.   
**Deprecated in favour of paymentMethodDetails**  
nickname | string | Max length 50 | Payment method nickname  
default | boolean | true/false | determines if the payment method is default for the customer  
paymentMethodType | string | Max length 50 | Payment method type can be CARD or BANK_ACCOUNT  
paymentMethodDetails |  [Card](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#card-structure) or [ACH](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#ach-structure) |  | One of Card or ACH  
sourceProvider | [SourceProvider](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#sourceprovider-structure) |  | To identify the source of the Payment method  
#### Source Provider Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#source-provider-structure "Direct link to Source Provider Structure")
Field | Type | Valid values | Description  
---|---|---|---  
name | Enum | CCG, GOOGLE_PAY, APPLE_PAY | Name of the source provider  
#### Card Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#card-structure "Direct link to Card Structure")
Field | Type | Valid values | Description  
---|---|---|---  
nameOnCard | string | Max length 50 | Name of the customer  
cardBrand | string | VISA, AMEX, DINERS, DISCOVER, JCB, MASTERCARD, UNIONPAY, UNKNOWN | Card brand  
expiryMonth | long | 01-12 | Month of expiration  
expiryYear | long | Max length 4 | Year of expiration  
last4 | string | Max length 4 | Last four digits of the card  
zipCode | string | Max length 5 | 5 digit zipcode  
status | string | ACTIVE/EXPIRED | Status of the card  
manufacturerCard | boolean | true/false | Determines if the card is manufacturer card or not. Only Agents can flag certain cards as manufacturer cards. Cards flagged as manufacturer cards cannot be default card.  
#### ACH Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#ach-structure "Direct link to ACH Structure")
Field | Type | Valid values | Description  
---|---|---|---  
type | string | BANK_ACCOUNT | Type of the PaymentMethod  
accountHolderType | string | individual or company | Account holder type  
accountType | string | checking or savings | Account Type  
bankName | string |  | Bank Name  
last4 | string |  | Last 4 digits of bank account number  
routingNumber | string |  | Routing number of bank  
nameOnAccount | string |  | Name on Account  
status | enum | ACTIVE and INVALIDATED | Bank Account Status  
#### Error Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#error-structure "Direct link to Error Structure")
Field | Type | Valid values | Description  
---|---|---|---  
code | string | Max length 50 | Short code for error  
description | string | Max length 255 | Error description  
errorDetails | [ErrorDetails](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#error-details-structure) |  | Error details  
#### Error Details Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#error-details-structure "Direct link to Error Details Structure")
Field | Type | Valid values | Description  
---|---|---|---  
code | string | Max length 100 | code for error  
message | string | Max length 255 | Error description  
declineCode | string | Max length 100 | Decline Code  
networkAdviceCode | string | Max length 100 | Network Advice Code  
networkDeclineCode | string | Max length 100 | Network Decline Code  
#### Important Note[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#important-note "Direct link to Important Note")
In the event that payment is captured and succeeded, we will be publishing two events: PAYMENT_SUCCEDED and PAYMENT_SUCCEEDED.
PAYMENT_SUCCEDED will be deprecated by **06/15/2024** and only PAYMENT_SUCCEEDED will be published going forward.
##### Payment with CARD[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#payment-with-card "Direct link to Payment with CARD")
Events will be sent in JSON format.
**_card_** object under paymentMethod is deprecated in favor of paymentMethodDetails. Please refer [PaymentMethod](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#paymentmethod-structure) for more details.
```
{  
      "name": "PAYMENT_SUCCEEDED"  
      "source": "vendor-portal",  
      "payload": {  
        "amount": 1500,  
        "description": "Payment Description",  
        "id": "6ab9bf74-03e0-4f47-bd70-bf57b103a5fd",  
        "merchantId": "44387763-4eeb-4592-a564-b10aadee95be",  
        "merchantTransactionId": "e31de58d-cb20-40ff-ad58-b99d500z0001",  
        "paymentDateUtc": "2011-10-05T14:48:00.000Z",  
        "paymentMethod": {  
            "id": "497f6eca-6276-4993-bfeb-53cbbbba6f08",  
            "sourceProvider":{  
                "name": "CCG"  
            },  
            "card": {  
                "last4": "string",  
                "type": "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
            "paymentMethodDetails": {  
                "last4": "string",  
                "type": "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
            "default": true,  
            "paymentMethodType": "CARD",  
            "nickname": "string"  
        },  
        "customer": {  
            "enterpriseId": "enterprise id",  
            "hsid": "hsid",  
            "firstName": "first name",  
            "lastName": "last name",  
            "email": "email",  
            "ssnLastFour": "1234",  
            "phoneNumber": {  
                "number": "1234567890",  
                "countryCode": "1"  
            },  
            "dateOfBirth": "dob",  
            "zip5": "23124"  
            "metadata": {  
                "patientId": "rx-patient-id"  
            }  
        },  
        "error": {  
            "code": "card_declined",  
            "message": "Your card has insufficient funds.",  
            "declineCode": "generic_decline",  
            "errorDetails": {  
                "code": "no_account",  
                "message": "The customer's bank account could not be located.",  
                "declineCode": "generic_decline",  
                "networkDeclineCode": "51",  
                "networkAdviceCode":"02"  
              }  
          }  
      }  
}  

```

##### Payment with BANK ACCOUNT[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payments/#payment-with-bank-account "Direct link to Payment with BANK ACCOUNT")
```
{  
    "name": "PAYMENT_SUCCEEDED",  
    "source": "vendor-portal",  
    "payload": {  
        "amount": 5000,  
        "capturedAmount": 5000,  
        "partialAuthorization": false,  
        "description": "Test Payment from Postman_003",  
        "id": "27f986f9-8440-4d30-8816-b3faf82dfd2e",  
        "merchantId": "44387763-4eeb-4592-a564-b10aadee95be",  
        "merchantTransactionId": "a812eb9d-9726-4764-b30a-06c234a75fa1",  
        "paymentDateUtc": "2024-05-06T12:26:27.192037",  
        "consent": {  
            "merchantConsentText": "some text",  
            "collectionTimestamp": "1054684654",  
            "collectionDetails": {  
                "type": "TEL",  
                "tel": {  
                    "inboundPhoneNumber": {  
                        "countryCode": "1",  
                        "number": "1234567890"  
                    }  
                }  
            }  
        },  
        "paymentMethod": {  
            "paymentMethodType": "BANK_ACCOUNT",  
            "id": "497f6eca-6276-4993-bfeb-53cbbbba6f08",  
            "sourceProvider":{  
                "name": "CCG"  
            },  
            "paymentMethodDetails": {  
                "type": "BANK_ACCOUNT",  
                "accountHolderType": "individual",  
                "accountType": "checking",  
                "bankName": "STRIPE TEST BANK",  
                "last4": "6789",  
                "routingNumber": "110000000",  
                "nameOnAccount": "Name on account test",  
                "status": "ACTIVE"  
            },  
            "nickname": "Nickname test",  
            "default": true  
        },  
        "customer": {  
            "enterpriseId": "enterprise id",  
            "hsid": "hsid",  
            "firstName": "first name",  
            "lastName": "last name",  
            "email": "email",  
            "ssnLastFour": "1234",  
            "phoneNumber": {  
                "number": "1234567890",  
                "countryCode": "1"  
            },  
            "dateOfBirth": "dob",  
            "zip5": "23124"  
            "metadata": {  
                "patientId": "rx-patient-id"  
            }  
        }  
    }  
}  

```



# Wallet
## What is Wallet?[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Manage%20Wallet/#what-is-wallet "Direct link to What is Wallet?")
Wallets allows users to store payment information securely for making online transactions. Digital wallets can store various payment methods, such as credit or debit card details, bank account information, and even cryptocurrency. Users can link their preferred payment methods to their digital wallet for quick and convenient checkout processes.
When a user chooses to pay using a wallet through a payment gateway, the payment information stored in the digital wallet is securely transmitted for authorization and processing. This eliminates the need for users to manually enter payment details for each transaction, streamlining the payment process and enhancing convenience and security for both users and merchants thus enabling One-Click Payments.
## Manage Wallet[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Manage%20Wallet/#manage-wallet "Direct link to Manage Wallet")
Managing a wallet involves tasks such as adding, removing, updating, and organizing payment methods within a digital wallet. Users can manage their digital wallets through various actions, including:
  * **Adding Payment Methods** : Users can add different payment methods, such as credit cards, debit cards, bank accounts, or other forms of payment, to their digital wallet for future transactions.
  * **Updating Payment Methods** : Users can update or edit existing payment method information stored in their digital wallet, such as updating expiration dates, billing addresses, name on payment method.
  * **Removing Payment Methods** : Users can remove outdated or unused payment methods from their digital wallet to declutter and streamline their payment options.
  * **Setting Preferences** : Users may have the option to set preferences within their digital wallet, such as default payment methods.
  * **Making Payment** : Users can choose a desired payment method and make a payment




# Payment Methods


# WS2 Group
WS2 group refers to member belongs to `PCI_Workstation_2` group in UHC Secure
  * PCI Workstation typically refers to a workstation computer that is equipped with PCI (Peripheral Component Interconnect) expansion slots.
  * Only Agents with WS2 group access can perform on-screen-entry for adding/making payment through cards




# Payments
## What is Payment?[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/#what-is-payment "Direct link to What is Payment?")
Payments refer to the transfer of money, typically from a customer to a merchant, in exchange for goods or services. Payments can be made using various methods such as cash, credit or debit cards, mobile wallets, bank transfers, and online payment platforms. The process of making a payment involves the authorization and verification of the transaction, the transfer of funds, and the confirmation of successful payment completion. Payments are a fundamental aspect of commerce and financial transactions, enabling businesses to receive compensation for products or services rendered.
## Payment modes[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/#payment-modes "Direct link to Payment modes")
Payment modes refer to the methods or channels through which customers can pay for goods or services, encompassing both one-time payments and options to store payment information for future transactions. These payment methods play a crucial role in the payment operations of a business or e-commerce platform.
## CCG Offered Payment modes and transctions[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/#ccg-offered-payment-modes-and-transctions "Direct link to CCG Offered Payment modes and transctions")
  * [Payment Modes](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Payment-modes/)
  * Payment Transactions
    * [Pre-Authorization](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Pre-Auth%20Transactions/)
    * [Sale Transacrions](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/sale-transactions/)
    * [Partial Authorization](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Partial-Authorization/)




# Extracts
## Merchant Extract[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Extract/#merchant-extract "Direct link to Merchant Extract")
Merchant extracts will include migration results, encompassing any potential issues encountered during the migration process. These extracts can be categorized into two distinct types:
  * **Error Extract** : This extract contains the original file with an additional column called errorDescription. It is used to capture any errors that occurred during the migration.
  * **Success Extract** : This extract also includes the original file but with a new column called ccgPaymentMethodId. It is used to indicate a successful migration.


By utilizing these Merchant Extracts, merchants can effectively analyze and address any migration-related concerns, ensuring a smooth transition to CCG.
## Error Extract[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Extract/#error-extract "Direct link to Error Extract")
Error Extract will contain any record that was not successfully processed. For instance, due to wrong formatting, invalid input fields or missing compulsory information. Description of the issue will be added at the end of each line.
Card example:
[card_test_migration_file_20240625-153549_error_20240625.csv](https://github.com/user-attachments/files/16063743/card_test_migration_file_20240625-153549_error_20240625.csv)
## Success Extract[​](https://docs.healthsafepay.com/docs/developers/Customer-migration/Extract/#success-extract "Direct link to Success Extract")
Success Extract will contain all records, those that were successfully migrated will also contain the CCG Payment Method Id at the end of the line.
Card example:
[card_test_migration_file_20240625-153549_completed_20240625.csv](https://github.com/user-attachments/files/16063744/card_test_migration_file_20240625-153549_completed_20240625.csv)
Bank Account example:
[bank_account_test_migration_file_20240701-095200_completed_20240701.csv](https://github.com/user-attachments/files/16063741/bank_account_test_migration_file_20240701-095200_completed_20240701.csv)


# Payment Methods and Types
## What is Payment Methods[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/#what-is-payment-methods "Direct link to What is Payment Methods")
Payment mode refers to the method used by a customer to make a payment for goods or services. It specifies the form of payment accepted by the merchant or business for a transaction. Common payment modes include cash, credit or debit cards, mobile wallets, bank transfers, online payment platforms, and electronic fund transfers.
Customers can choose their preferred payment mode based on convenience, security, and availability. Businesses may offer multiple payment modes to accommodate different customer preferences and enhance the overall shopping experience. The payment mode selected by the customer determines how the funds will be transferred to the merchant to complete the transaction.
**As a CCG Consumer, Merchant should provide list of payment methods and channels required for thier business to be configured.**
## Accepted Payment Methods[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/#accepted-payment-methods "Direct link to Accepted Payment Methods")
CCG offers the following payment options
  * Cards
    * Supported [Card Brands](https://docs.stripe.com/terminal/payments/collect-card-payment/supported-card-brands)
    * [Manufacturer Card](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/Card/manufacturer-card/)
  * Bank Account
    * A financial account held by an individual or entity at a financial institution, such as a bank or credit union. A bank account allows account holders to deposit and withdraw funds, make payments, receive direct deposits, and access other banking services
  * [Google Pay](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/)
    * Google Pay is a digital wallet platform and online payment system developed by Google. It allows users to make payments using their mobile devices, tablets, or computers at online and physical stores. Google Pay securely stores users' credit and debit card information, loyalty cards, and other payment methods for convenient and secure transactions.
  * [Apple Pay](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/)
    * Apple Pay is a mobile payment and digital wallet service developed by Apple Inc. It allows users to make payments using their Apple devices, such as iPhones, iPads, Apple Watches, and Mac computers. Apple Pay securely stores users' credit and debit card information, as well as other payment methods, and allows for contactless payments in stores that support NFC technology.




# HCP Gateway Application
## Introduction[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#introduction "Direct link to Introduction")
This readme file provides important information about the HCC Gateway application and its current configuration with the inclusion of a Web Application Firewall (WAF). It addresses potential issues that clients may encounter related to blocked requests with **HTTP status code 403 FORBIDDEN**.
## Application Overview[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#application-overview "Direct link to Application Overview")
The HCC Gateway application serves as an interface between our customers and our services. Its primary purpose is to facilitate secure and efficient communication between the two parties.
## Issue Description[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#issue-description "Direct link to Issue Description")
To enhance security, the HCC Gateway now incorporates a Web Application Firewall (WAF). While this is a positive step towards protecting our infrastructure, it can lead to certain limitations that affect the application's functionality.
Two specific scenarios have been identified that may result in blocked requests:
#### 1. Request Body containing URLS[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#1-request-body-containing-urls "Direct link to 1. Request Body containing URLS")
Requests may be blocked if the URLs included in the request body are not properly encoded. It is crucial to ensure that any URLs within the request body are correctly encoded to ensure successful processing.
**POST /sessions API:**
  * config.privacypolicyurl
  * appearance.font.fontSources.cssSrc
  * appearance.merchantlogo


##### Remidiation[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#remidiation "Direct link to Remidiation")
When making any **POST requests** , ensure that any URLs included in the request body are properly encoded. Utilize URL encoding techniques such as percent-encoding to achieve this.
#### 2. GET Requests with `Transfer-Encoding` header[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#2-get-requests-with-transfer-encoding-header "Direct link to 2-get-requests-with-transfer-encoding-header")
GET requests can be blocked if they include the `Transfer-Encoding` header. The presence of this header triggers the WAF, leading to request blocking. To avoid this, it is important to exclude the `Transfer-Encoding` header from GET requests.
##### Remidiation[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#remidiation-1 "Direct link to Remidiation")
**GET Requests** : Do not include the `Transfer-Encoding` header in any GET requests. If the header is necessary for other purposes, consider alternative approaches.
#### 3. Requests missing `Accept` header[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#3-requests-missing-accept-header "Direct link to 3-requests-missing-accept-header")
Azure Web Application Firewall (WAF) blocks can occur when requests do not include the required Accept header. The Accept header is an HTTP request header field that specifies the types of content the client is willing to accept from the server. Its absence may trigger the WAF, leading to request blocking.
Few of the APIs that are affected by this issue are:
  * /token/setup-payment-methods
  * /sessions
  * /payments/{payment_id}
  * /customers/{customer_id}/payment-methods
  * /payment-methods/search


##### Remediation[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#remediation "Direct link to Remediation")
**GET Requests** : Ensure that all GET requests include the required Accept header. The Accept header should specify the types of content the client is willing to accept from the server. By including this header, you can avoid triggering the WAF and prevent request blocking.
#### 4. Other common best practices to avoid WAF blocks[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#4-other-common-best-practices-to-avoid-waf-blocks "Direct link to 4. Other common best practices to avoid WAF blocks")
  * GET OR HEAD requests should not have a body
  * POST requests should have a valid json body
  * Don't include any SQL characters in the request body
  * Encode all URL's in the request body


### Further Analysis[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/hcp/#further-analysis "Direct link to Further Analysis")
  1. [HCP GATEWAY NON-PROD Splunk Query](https://est-sh.prod.cloud-splunk-optum.com/en-US/app/search/search?q=search%20index%3Dcloud_hcp_stargate%20%22commerce%2Fnonprodcheckout%22%20sourcetype%3D%22microsoft.network-applicationgateways%22%20data.properties.action%3D%22matched%22%0A%7Cstats%20count%20by%20data.properties.ruleId%2Cdata.properties.requestUri%2Cdata.properties.details.message%2Cdata.properties.details.data%0A%7C%20rename%20data.properties.ruleId%20as%20Waf_RuleId%2Cdata.properties.requestUri%20as%20URI%2Cdata.properties.details.message%20as%20Message%2C%20data.properties.details.data%20as%20Issue%0A%7C%20sort%20-count&display.page.search.mode=smart&dispatch.sample_ratio=1&earliest=-30d%40d&latest=now&display.page.search.tab=statistics&display.general.type=statistics&display.visualizations.charting.chart=line&sid=1712648217.57421_A5869624-06A2-476A-BA89-63A7C3271915) will show the _Waf_RuleId_ caused the block, _URI_ impacted, _Message_ , _Issue_ providing details of the property causing the block
  2. [Azure WAF Rule Set](https://learn.microsoft.com/en-us/azure/web-application-firewall/ag/application-gateway-crs-rulegroups-rules?tabs=drs21)




# Stage Release Notes
Convenient Checkout Gateway (CCG) Non-Production (Stage) environments release notes.
##  [11-15-2023 (R18)](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/#11-15-2023-r18 "Direct link to 11-15-2023-r18")
##  [11-30-2023 (R18 continued)](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-30-2023/)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/#11-30-2023-r18-continued "Direct link to 11-30-2023-r18-continued")
##  [12-22-2023 (R21)](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/12-22-2023/)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/#12-22-2023-r21 "Direct link to 12-22-2023-r21")


# Production Release Notes
Convenient Checkout Gateway (CCG) Production environment release notes.
##  [1-23-2024 (R21)](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/#1-23-2024-r21 "Direct link to 1-23-2024-r21")
##  [12-8-2023 (R18)](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/#12-8-2023-r18 "Direct link to 12-8-2023-r18")
##  [11-17-2023 (R17)](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/11-17-2023/)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/#11-17-2023-r17 "Direct link to 11-17-2023-r17")


# Convenient Checkout Users
## Users[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/users/#users "Direct link to Users")
  * Customers
  * Agents


### Customers[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/users/#customers "Direct link to Customers")
Customers are individuals or entities who make purchases or transactions online and use the payment gateway to process their payments. Customers interact with the payment gateway when they are ready to make a purchase on an e-commerce website, mobile app, or any online platform that supports online payments.
Customers typically provide their payment information, such as credit card details, debit card information, or other payment methods, to the payment gateway during the checkout process. The payment gateway securely transmits this information to the appropriate financial institutions for authorization and processing.
Customers may also create accounts within the payment gateway system to store their payment information securely for future transactions, view transaction history, manage payment methods, and receive notifications related to their purchases.
### Agents[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/users/#agents "Direct link to Agents")
A agent typically refers to a user role or account type that has permissions to process transactions and manage payments within the system. agents are typically employees or individuals who are responsible for accepting payments, processing orders, and handling transactions on behalf of a merchant or business.
Agents within a payment gateway platform may have access to functionalities such as initiating payments, capturing funds, issuing refunds, managing payment methods, and generating reports related to transactions. They play a crucial role in facilitating payments and ensuring a smooth checkout experience for customers.
Agents may also have the ability to view transaction details, monitor payment activity, and reconcile payments with orders. They are usually trained to handle various payment methods, troubleshoot payment issues, and adhere to security protocols to protect sensitive payment information.


# Stripe Platform
## What is Stripe[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/stripe/#what-is-stripe "Direct link to What is Stripe")
Stripe is a leading payment gateway service provider that facilitates online transactions for businesses.
Key features:
  * Payment processing
  * Subscription management
  * Invoicing
  * Fraud prevention
  * Analytics and reporting


## Stripe Accounts[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/stripe/#stripe-accounts "Direct link to Stripe Accounts")
  * Platform account
  * Connected account
  * Test account


## Platform Account[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/stripe/#platform-account "Direct link to Platform Account")
In Stripe Connect, a platform account refers to the main Stripe account that manages and controls connected accounts. Here are some key points about platform accounts:
  * A platform account is used to create and manage connected accounts for businesses or individuals that sign up to access your platform's services.
  * Platform accounts can request different capabilities for connected accounts, such as accepting card payments or receiving transferred funds.
  * Platform accounts can control various aspects of connected accounts, including:
    * Onboarding and identity verification processes
    * Charge types (direct, destination, or separate charges and transfers)
    * Payout settings
    * Access to Stripe Dashboard features


## Connect Account[​](https://docs.healthsafepay.com/docs/developers/Getting-Started/stripe/#connect-account "Direct link to Connect Account")
A Connect account, also known as a connected account, is a Stripe account that is linked to and managed by a platform using Stripe Connect. Here are the key points about Connect accounts:
  * Connected accounts represent individual businesses or sellers on your platform. They allow these businesses to accept payments through your platform.
  * There are different types of connected accounts:
    * Standard: Full Stripe accounts with their own dashboard, connected account handles fraud/disputes
    * Express: Lighter accounts with a simplified dashboard, platform handles fraud/disputes
    * Custom: Fully white-labeled accounts without direct Stripe access, platform handles fraud/disputes
  * Connected accounts can have various capabilities, such as accepting payments or handling payouts and Connected accounts have their own balance, separate from the platform's balance.




# Stage Release Notes (12-22-2023)
Convenient Checkout Gateway (CCG) Non-Production (Stage) environment release notes.
## 12-22-2023 (R21)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/12-22-2023/#12-22-2023-r21 "Direct link to 12-22-2023 \(R21\)")
### Make payment with option to save for future use: Credit Card[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/12-22-2023/#make-payment-with-option-to-save-for-future-use-credit-card "Direct link to Make payment with option to save for future use: Credit Card")
Allows payment with card, with option to store payment method for future use in wallet.
Where to find details: [API - Create Payment > Payment Method > Save Payment Method](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createPayment)
### Make payment with option to save for future use: ACH[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/12-22-2023/#make-payment-with-option-to-save-for-future-use-ach "Direct link to Make payment with option to save for future use: ACH")
Merchant **must** send consent object with ACH payment consent text.
Allows payment with ACH, with option to store payment method for future use in wallet.
Where to find details:
[API - Create Payment > Payment Method > Save Payment Method](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createPayment)
[API - Create Payment > Consent](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createPayment)


# Unusual Payment Failures
### 500 Internal Server Error during Get Payment by (PaymentId/Merchant Transaction id):[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Unusual%20payments%20failiure/#500-internal-server-error-during-get-payment-by-paymentidmerchant-transaction-id "Direct link to 500 Internal Server Error during Get Payment by \(PaymentId/Merchant Transaction id\):")
If you receive a 500 Internal Server Error on your first GET request when polling for payment status, this indicates a non-recoverable issue. Please do not continue polling for this payment, as the error will not resolve with further attempts.


# Testing
### Testing interactively[​](https://docs.healthsafepay.com/docs/developers/Testing/Testing/#testing-interactively "Direct link to Testing interactively")
When testing interactively, use the following Visa test card details in a test UI:  
Use card number 4242 4242 4242 4242.  
Use a valid future date, such as 12/34.  
Use any three-digit CVC.  
Use any value you like for other form fields.
### Testing by code[​](https://docs.healthsafepay.com/docs/developers/Testing/Testing/#testing-by-code "Direct link to Testing by code")
To simulate a successful payment, use test cards from the following list. The billing country for each test card is set to the United States.
BRAND | NUMBER | CVC | DATE  
---|---|---|---  
Visa | 4242424242424242 | Any 3 digits | Any future date  
Visa (debit) | 4000056655665556 | Any 3 digits | Any future date  
Mastercard | 5555555555554444 | Any 3 digits | Any future date  
Mastercard (debit) | 5200828282828210 | Any 3 digits | Any future date  
American Express | 378282246310005 | Any 4 digits | Any future date  
Discover | 6011111111111117 | Any 3 digits | Any future date  
Discover (debit) | 6011981111111113 | Any 3 digits | Any future date


# Duplicate Payment Method
Payment method is considered as a duplicate payment method if newly added payment method details match with the existing payment method.
## Duplicate Card[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Add-Duplicate-Payment-Method/#duplicate-card "Direct link to Duplicate Card")
### What is Duplicate Card?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Add-Duplicate-Payment-Method/#what-is-duplicate-card "Direct link to What is Duplicate Card?")
If customer adds payment method with following details then, payment method is considered as a duplicate card.
  * Type as `CARD` with same card number and same `fingerprint` as existing card in the wallet.
  * Same or updated information like `expiry date`, `name on card`, `nickname` and `zip code`.


### How CCG handles duplicate card scenario?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Add-Duplicate-Payment-Method/#how-ccg-handles-duplicate-card-scenario "Direct link to How CCG handles duplicate card scenario?")
If customer adds duplicate card as per above definition in the wallet, then:
  * CCG updates existing card with updated information like new expiry date, name on card, nickname and zip code from newly added card.
  * `PAYMENT_METHOD_CREATED` webhook is sent to the merchant to indicate creation of new payment method.
  * `PAYMENT_METHOD_UPDATED` webhook is also sent to the merchant to indicate existing card details are updated as newly added payment method was duplicate.
  * In duplicate card scenario, if warning details mentioned below are present in the setup payment method details response or list payment methods response, then it indicates that duplicate card has been added by the customer, but CCG has updated existing card with new details and newly added card has been discarded.


> ⚠️ **Warning Message Details:**
  * **Title:** Payment method already exists
  * **Description:** Any new details provided have been updated accordingly.


### How to access warning details?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Add-Duplicate-Payment-Method/#how-to-access-warning-details "Direct link to How to access warning details?")
1. GET Setup Payment Method API Response: 
```
{  
  "data": {  
    "id": "xxx-xxx-xxx-xxx-xxx",  
    "platformVendorMerchantId": "platformVendorMerchantId",  
    "vendorSetupPaymentMethodSecret": "vendorSetupPaymentMethodSecret",  
    "status": "COMPLETED",  
    "paymentMethodId": "paymentMethodId",  
    "paymentMethodType": "CARD",  
    "error": null,  
    "warning": {  
      "code": "DUPLICATE_ENTRY",  
      "title": "Payment method already exists",  
      "description": "Any new details provided have been updated accordingly."  
    }  
  },  
  "url": "/customers/<customerId>/setup-payment-methods/<setupPaymentMethodId>"  
}  

```

2. GET Payment Methods API Response: 
```
[  
  {  
    "id": "xxx-xxx-xxx-xxx-xxx",  
    "paymentMethodType": "CARD",  
    "vendorPaymentMethodId": "pm_xxx",  
    "vendorMerchantId": null,  
    "customerId": "xxx-xxx-xxx-xxx-xxx",  
    "vendor": "STRIPE",  
    "status": "COMPLETED",  
    "zipCode": "xxxxx",  
    "error": null,  
    "nickname": "nickname",  
    "lastModifiedBySource": null,  
    "lastModifiedByMerchantId": "xxx-xxx-xxx-xxx-xxx",  
    "lastModifiedByAgent": {  
      "firstName": null,  
      "lastName": null,  
      "isAccessVerified": null,  
      "userId": "string"  
    },  
    "paymentMethodDetails": {  
      "vendorPaymentMethodFingerprint": "fingerprint",  
      "type": "CARD",  
      "nameOnCard": "nameOnCard",  
      "cardBrand": "cardBrand",  
      "expiryMonth": "expiryMonth",  
      "expiryYear": "expiryYear",  
      "last4": "last4",  
      "manufacturerCard": true,  
      "zipCode": null,  
      "status": "ACTIVE"  
    },  
    "warning": {  
      "code": "DUPLICATE_ENTRY",  
      "title": "Payment method already exists",  
      "description": "Any new details provided have been updated accordingly."  
    },  
    "accountNumber": null,  
    "card": {  
      "vendorPaymentMethodFingerprint": "fingerprint",  
      "type": "CARD",  
      "nameOnCard": "nameOnCard",  
      "cardBrand": "cardBrand",  
      "expiryMonth": "expiryMonth",  
      "expiryYear": "expiryYear",  
      "last4": "last4",  
      "manufacturerCard": true,  
      "zipCode": null,  
      "status": "ACTIVE"  
    },  
    "usbankAccountDetails": null,  
    "usbankAccount": false,  
    "default": false  
  }  
]  

```



# Payment Method Replaced
### Scenario[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Replace-Payment-Method/#scenario "Direct link to Scenario")
Consider the following the scenario when a payment method is replaced
  1. User Adds a card **A** ending with 1234.
  2. Card **A** is expired and user got a new card **B** ending with 5678.
  3. User Adds the new card **B** ending with 5678.
  4. CCG got the event from Vendor saying card **A** is updated with card **B**


In the above case, the card **A** is considered as duplicate.
**NOTE:** The above is just a example scenario for a CARD, it can happen to any of the payment method types.
### What happens to the Duplicate card **A**?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Replace-Payment-Method/#what-happens-to-the-duplicate-card-a "Direct link to what-happens-to-the-duplicate-card-a")
CCG deletes the card **A** from the wallet and sends [**PAYMENT_METHOD_DELETED**](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/) event to merchants.
### How merchants knows card **A** is replaced with card **B**?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Replace-Payment-Method/#how-merchants-knows-card-a-is-replaced-with-card-b "Direct link to how-merchants-knows-card-a-is-replaced-with-card-b")
CCG sends a [**PAYMENT_METHOD_REPLACED**](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/) event to the merchants.
Sample event structure is given below.
```
{  
    "name": "PAYMENT_METHOD_REPLACED",  
    "payload": {  
        "paymentMethod": { // Payment Method information of CARD B   
            "id": "497f6eca-6276-4993-bfeb-53cbbbba6f08",  
            "card": {  
                "last4": "string",  
                "type" : "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
             "paymentMethodDetails": {  
                "last4": "string",  
                "type" : "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
            "default": true,  
            "paymentMethodType": "CARD",  
            "nickname": "string"  
        },  
        "customer": {  
            "enterpriseId": "enterprise id",  
            "hsid": "hsid",  
            "dateOfBirth": "dob",  
            "metadata": {  
                "patientId": "rx-patient-id"  
            }  
        },  
        "agent": {  
            "firstName": "First Name",  
            "lastName": "Last Name",  
            "userId": "msId",  
            "isAccessVerified": true  
        },  
        "deletedPaymentMethodId": "597f6eca-6276-4993-bfeb-53cbbbba6f12" // CCG Payment Method ID of CARD A   
    }  
}  

```



# Firewall Restrictions
If there is firewall restriction based on domain name, then add these domains to allow Convenient Checkout wallet application.
  * wallet.healthsafepay.com
  * walletprod.healthsafepay.com
  * *.stripe.com
  * *.stripe.network
  * *.applicationinsights.azure.com
  * pay.google.com
  * [www.gstatic.com](http://www.gstatic.com)
  * play.google.com




# API Terminology
### Merchant Id[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/API-Terminology/#merchant-id "Direct link to Merchant Id")
Merchant Id is a unique identifier that is used to identify a merchant system. Merchant Id is created during the merchant onboarding process and will be provided to the respective team.
### Statement Descriptors[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/API-Terminology/#statement-descriptors "Direct link to Statement Descriptors")
Statement descriptors explain charges or payments on bank statements. Using clear and accurate statement descriptors can reduce chargebacks and disputes. Banks and card networks require the inclusion of certain types of information that help customers understand their statements, and statement descriptors provide this information.
The static statement descriptor is configured during merchant onboarding process. For card transactions we can additionally set a dynamic statement descriptor suffix as a part of [/sessions] ( /api-reference/#tag/Merchant/paths/~1sessions/post ) or [/payments] ( /api-reference/#tag/Merchant/operation/createPayment ) API request.
Description | Max Length | Valid characters pattern  
---|---|---  
Statement Descriptor | 10 | ^[a-zA-Z0-9\s-.]-10$  
Statement Descriptor Suffix | 10 | ^[a-zA-Z0-9\s-.]-10$


# Managing Payment Methods


# Payments


# Managing MerchantTransactionId
`MerchantTransactionId` serves the purpose of uniquely identifying every payment/transaction.
  

When a payment fails, the transaction is assumed to be completed (either succeeds or fails). So, a new `MerchantTransactionId` would be required to restart the failed payment transaction
  

Payment failure is signalled by `onFailure(statusObject)` callback


# Initiate Session Request
To enhance the integration with the CCG widget, it's crucial to have comprehensive details regarding session-based request and response interactions.
## Sample Request[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/create-session-request-response/#sample-request "Direct link to Sample Request")
### Mode: `Pay with wallet`[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/create-session-request-response/#mode-pay-with-wallet "Direct link to mode-pay-with-wallet")
Session request - PAY with Wallet
```
{  
    "customer": {  
        "name": "customer_name",  
        "email": "emailUsername@<validDomain>.com",  
        "ssnLastFour": "9214",  
        "dateOfBirth": "2000-09-21",  
        "hsid": "{{hsid}}",  
        "enterpriseId": null,  
        "zip5": null,  
        "phoneNumber": {  
            "number": "8998090898",  
            "countryCode": "91"  
        },  
        "metadata": null  
    },  
    "payment": {  
        "merchantTransactionId": "{{merchantTransactionId}}",  
        "amount": 20099,  
        "authorizeCard": true,  
        "statementDescriptorSuffix": "A.-090 A",  
        "metadata": {}  
    },  
      
    "appearance": null,  
      
    "consent": {  
        "merchantConsentText": "qq"  
    },  
    "cashier": "s438",  
    "config": {  
        "modes": [  
            "PAYMENT_WITH_WALLET"  
        ],  
        "paymentMethodChannel": {  
            "card": ["WEBFORM"]  
        },  
         "options":{  
          
        "preferredLanguage":"es"  
    }  
    }  
     
}  

```



# Sessions
## What is Sessions[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/#what-is-sessions "Direct link to What is Sessions")
The Session serves as the primary entry point for the CCG UI (Credit Card Gateway User Interface). It determines the payment modes and channels requested by a merchant and specifies the options available to the merchant. The Session encompasses language preferences, features such as Pay and Save, Pay with wallet, and one-time payment modes, as well as the Payment Method Selector and wallet management options for the merchant.
Moreover, the Session contains essential payment details such as the transaction amount, merchant transaction ID, statement descriptors, and customer information necessary for customer identification and the creation of customer wallets.
## Session API[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/#session-api "Direct link to Session API")
API Request | Consumer  
---|---  
`post/sessions` | Merchant  
`get/checkout-sessions` | Widget  
`get/sessions` | Merchant


# Integration Components
To integrate with the CCG widget, it's important to understand three main components
  * [Users](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#users)
  * [Widget Capabilities](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#widget-capabilities)
  * [Widget Experience](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#widget-experience)


## Components[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#components "Direct link to Components")
### Users[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#users "Direct link to Users")
Authenticated users are CCG `wallet` users, while anonymous users are considered `guest` users.
### Widget Capabilities[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#widget-capabilities "Direct link to Widget Capabilities")
[Widget capabilities](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/) determine what actions a user can perform within the widget.
Capability | Mode | User | Experience  
---|---|---|---  
[Manage wallet and make payment](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#manage-wallet-and-make-payment) | `PAYMENT_WITH_WALLET` | `wallet` |  `Hosted` `Embedded`  
[Make one time payment](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#make-one-time-payment) | `PAYMENT` |  `wallet`, `guest` |  `Hosted` `Embedded`  
[Add a payment method](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#add-a-payment-method) | `PAYMENT_METHOD_ENTRY` | `wallet` |  `Hosted` `Embedded`  
[Manage wallet](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#manage-wallet) | `WALLET` | `wallet` |  `Hosted` `Embedded`  
[Payment Method Selector](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#payment-method-selector) | `PAYMENT_METHOD_SELECT` | `wallet` |  `Hosted` `Embedded`  
[Payment Method Display](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#payment-method-display) | `PAYMENT_METHOD_DISPLAY` | `wallet` | `Embedded`  
### Widget Experience[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#widget-experience "Direct link to Widget Experience")
Widget experience determines how the widget is presented: as a hosted pop-up or embedded.
  * **Hosted:** Displayed as a browser pop-up, launched separately from the parent application.
  * **Embedded:** Integrated into the parent application for a seamless, thematically consistent experience with three embedding options: modal, inline, and drawer.
    * For details on container and capability combinations, [click here](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/).


## Integration approaches[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#integration-approaches "Direct link to Integration approaches")
  * [Hosted Experience](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/)
  * [Embedded Experience](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/)


### Choosing an Integration approach[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#choosing-an-integration-approach "Direct link to Choosing an Integration approach")
Each integration option has unique attributes that make it suitable for different scenarios. Developers can choose the integration option that best fits their needs, based on factors such as the user experience and ease of integration.
| Embedded Experience | Hosted Experience  
---|---|---  
[Widget Experience (UX)](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/#widget-experience) |  **embedded** as a component into merchant app | launched as **browser popup**  
[Session](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/create-session-request-response/) | Managed by **Merchant** | Managed by **Merchant**  
Build Time Integration (npm) | Available | NA  
Run Time Integration (CDN) | Available | NA  
Usage within React App | Yes | Yes  
Usage within Non-React App | Yes | Yes


# Languages
## Overview[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Languages/#overview "Direct link to Overview")
The CCG widget offers a language translation feature that enables the translation of its content between English and Spanish. This feature is available for all integration patterns including hosted and embedded. Future updates will include additional languages.
### Supported Langauages[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Languages/#supported-langauages "Direct link to Supported Langauages")
Language | Code  
---|---  
English | `en`  
Spanish | `es`


# Known Issues
## Widget version 2.4.0[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Known-Issues/#widget-version-240 "Direct link to Widget version 2.4.0")
  * There was an issue with the TypeScript declaration file `ccg-widget.d.ts` and `ccg-widget.min.d.ts` which was causing build issues when using the widget in a TypeScript project.
    * The issue was fixed in version `2.4.1`.




# TypeScript Support
## CDN Integration[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/TypeScript-Support/#cdn-integration "Direct link to CDN Integration")
### Using NPM[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/TypeScript-Support/#using-npm "Direct link to Using NPM")
  1. [Install package via NPM](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#install-the-package)
  2. Add the following reference before using the widget:   
`/// <reference types="@optum-ccg/convenient-checkout-ui/dist/widget/ccg-widget" />`   
Note: Types support was added starting in package version 2.4.1


### Manual[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/TypeScript-Support/#manual "Direct link to Manual")
Add or augment your existing global typings file (usually named `global.d.ts`) with the following:
```
declare global {  
  interface Window {  
    optumCCG: {  
      /**  
       * Note: For a comprehensive list of typings go to:  
       * https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#optumccgwidgetinitializer-method-options  
       * @returns  
       */  
      OptumCCGWidgetInitializer: (  
        args: {  
          rootElement: HTMLElement;  
          appEnv: 'stage' | 'prod';  
          checkoutSessionId: string;  
        } & Record<string, unknown>  
      ) => ({  
        render: () => void;  
        unmount: () => void;  
      });  
    };  
  }  
}  

```

## NPM Integration[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/TypeScript-Support/#npm-integration "Direct link to NPM Integration")
Starting with package version `2.4.1` the function `OptumCCGWidgetInitializer` is exported with types.
```
import { OptumCCGWidgetInitializer } from "@optum-ccg/convenient-checkout-ui/dist/widget/ccg-widget.min";  

```

if using a version older than `2.4.1`:
```
import { OptumCCGWidgetInitializer as UntypedOptumCCGWidgetInitializer } from "@optum-ccg/convenient-checkout-ui/dist/widget/ccg-widget.min";  
  
import type cjsWidget from "@optum-ccg/convenient-checkout-ui/dist/cjs/widget-wrapper/OptumCCGWidgetInitializer";  
  
const OptumCCGWidgetInitializer =  
  UntypedOptumCCGWidgetInitializer as typeof cjsWidget;  
  
  let ccgWidget: ReturnType<typeof cjsWidget>;  

```



# Hosted Experience
## Setup[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#setup "Direct link to Setup")
### Generate a Session[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#generate-a-session "Direct link to Generate a Session")
  * From the Merchant's backend, make a call to [`/POST sessions`](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post) to generate `session` and pass it to the web app
  * Widget's capabilities can be customized using `config` property in `session` request object
  * Refer [Generate a Session](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/create-session-request-response/) for details

/POST session (request/response)
```
## /POST sessions request  
curl --location --request POST '<HCP_DOMAIN>/api/financial/commerce/nonprodcheckout/v1/sessions' \  
--header 'X-Merchant-Id: <x-merchant-id>' \  
--header 'X-Upstream-Env: <x-upstream-env>' \  
--header 'Content-Type: application/json' \  
--header 'Authorization: Bearer <authorization-token>' \  
--data-raw '{  
    "customer": {  
        "firstName": "foo",  
        "lastName": "bar",  
        "email": "foo.bar@email.com",  
        "ssnLastFour": "1234",  
        "dateOfBirth": "1970-31-12",  
        "phoneNumber": {  
            "number": "9876543210",  
            "countryCode": "1"  
        },  
        "zip5": "54321",  
        "hsid": "120c5730-e796-4448-8da9-081fde4e3e79",  
        "metadata": {}  
    },  
    "payment": {  
        "merchantTransactionId": "f32736c8-266a-4da1-af16-293fa02a351a",  
        "amount": 1200,  
        "authorizeCard": false,  
    },  
    "config": {  
        "modes": [  
            "PAYMENT_METHOD_ENTRY"  
        ]  
    }  
}'  

```

```
// /POST sessions reponse  
{  
  "url": "/sessions/<CHECKOUT_SESSION_ID>",  
  "data": {  
    "sessionId": "<CHECKOUT_SESSION_ID>",  
    "hostedUrl": "<CCG_DOMAIN>/app?checkoutSessionId=<CHECKOUT_SESSION_ID>"  
  }  
}  

```

### Initialize[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#initialize "Direct link to Initialize")
  * use `session_response.hostedUrl` from [session response](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/create-session-request-response/) to open the widget as a popup

Launch widget as popup
// update to include left/height dyna props
```
// openCCGWidget  
const openCCGWidget = (hostedUrl) => {  
  const width = 400;  
  const height = 850;  
  const left = window.screen.width / 2 - width / 2;  
  
  if(!widgetPopupInstance || widgetPopupInstance?.closed) {  
      widgetPopupInstance = window.open(  
        hostedUrl,  
        "_blank",  
        `popup=true,width=${width},height=${height},left=${left}`  
      );  
    } else {  
      widgetPopupInstance.location = hostedUrl;  
      widgetPopupInstance.focus();  
    }  
  };  
};  

```

### Poll for session status[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#poll-for-session-status "Direct link to Poll for session status")
Start polling on `session_response.url` from [session response](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/create-session-request-response/) to know the session status
Poll session status
```
// poll for session status  
const pollSessionStatus = ({ url, onCompleted, onError }) => {  
  setTimeout(async () => {  
    const response = await fetch(url);  
    const session = await response.json();  
    if (response.status >= 400 && response.status < 500) {  
      onError(session);  
      return;  
    }  
  
    const status = session.status;  
    if (status === "COMPLETED") {  
      onCompleted(session);  
    } else {  
      console.info(`session status: ${status}; continue to poll...`);  
      pollSessionStatus({  
        url,  
        onCompleted,  
        onError,  
      });  
    }  
  }, 2000); // Poll every 2 seconds  
};  

```

### Close widget[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#close-widget "Direct link to Close widget")
We recommend closing the widget upon session completion (success or error).
Close popup (widget)
```
// closeCCGWidget  
const closeCCGWidget = () => {  
  widgetPopupInstance?.close();  
};  

```

### Handle close popup[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#handle-close-popup "Direct link to Handle close popup")
Notifies or Cancels widget being closed, an interval timer defined by `POPUP_WINDOW_CLOSED_CHECK_INTERVAL` is used to check if a popup window has been closed. If the popup window is closed, the timer is cleared using `window.clearInterval()`.
Cancel popup (widget)
```
const pollTimer = window.setInterval(() => {  
  if (win?.closed !== false) {  
    // react to the closing of popup window.  
  }  
}, POPUP_WINDOW_CLOSED_CHECK_INTERVAL);  

```

### Full Example[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#full-example "Direct link to Full Example")
```
<!DOCTYPE html>  
<html lang="en">  
  <head>  
    <meta charset="UTF-8" />  
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
    <title>CCG Widget Integration</title>  
  </head>  
  <body>  
    <h1>CCG Widget Integration</h1>  
  
    <button id="checkoutBtn">Pay Remaining Balance</button>  
  
    <script>  
      (() => {  
        let widgetPopupInstance;  
        let popupWindowCancelPollingInterval;  
        const POPUP_WINDOW_CLOSED_CHECK_INTERVAL = 500;  
  
        const reset = () => {  
          widgetPopupInstance = null;  
        };  
  
        // create session request object  
        const createSessionRequestObject = () => {  
          const customer = {  
            firstName: "foo",  
            lastName: "bar",  
            dateOfBirth: "1970-31-12",  
            hsid: "120c5730-e796-4448-8da9-081fde4e3e79",  
          };  
  
          const payment = {  
            merchantTransactionId: "f32736c8-266a-4da1-af16-293fa02a351a",  
            amount: 1200,  
            authorizeCard: false,  
            metadata: {  
              invoice: "inv-9023",  
            },  
          };  
  
          const config = {  
            modes: ["PAYMENT_WITH_WALLET"],  
          };  
  
          return {  
            customer,  
            payment,  
            config,  
          };  
        };  
  
        // generate session  
        const generateSessionFromBackend = async () => {  
          const { customer, payment, config } = createSessionRequestObject();  
  
          // Due to security reasons,  
          // merchant's web app can't directly talk to CCG's API to generate session ID.  
          // Instead, merchant web app communicates with their backend service,  
          // which inturn securely talks to CCG's API for generating session.  
          const response = await fetch("/merchant-api/sessions", {  
            method: "POST",  
            body: JSON.stringify({  
              customer,  
              payment,  
              config,  
            }),  
          });  
  
          return response.json();  
        };  
  
        // poll for session status  
        const pollSessionStatus = ({ url, onCompleted, onError }) => {  
          setTimeout(async () => {  
            const response = await fetch(url);  
            const session = await response.json();  
            if (response.status >= 400 && response.status < 500) {  
              onError(session);  
              return;  
            }  
  
            const status = session.status;  
            if (status === "COMPLETED") {  
              onCompleted(session);  
            } else {  
              console.info(`session status: ${status}; continue to poll...`);  
              pollSessionStatus({  
                url,  
                onCompleted,  
                onError,  
              });  
            }  
          }, 2000); // Poll every 2 seconds  
        };  
  
        // onCompleted callback to handle session completion  
        const onCompleted = (session) => {  
          console.info("session complete", session);  
          closeCCGWidget();  
          reset();  
        };  
  
        // onError callback to handle session error  
        const onError = ({ title, detail, status }) => {  
          console.error("Session errored", { title, detail, status });  
          closeCCGWidget();  
          reset();  
        };  
  
        const onClosePopup = () => {  
          console.log("popup window was closed.");  
        };  
  
        // open CCGWidget  
        const openCCGWidget = (hostedUrl) => {  
          const width = 400;  
          const height = 850;  
          const left = window.screen.width / 2 - width / 2;  
  
          if (!widgetPopupInstance || widgetPopupInstance?.closed) {  
            widgetPopupInstance = window.open(  
              hostedUrl,  
              "_blank",  
              `popup=true,width=${width},height=${height},left=${left}`  
            );  
          } else {  
            widgetPopupInstance.location = hostedUrl;  
            widgetPopupInstance.focus();  
          }  
        };  
  
        // handle popup close  
          popupWindowCancelPollingInterval = window.setInterval(() => {  
            if (widgetPopupInstance?.closed !== false) {  
              onClosePopup();  
              clearInterval(popupWindowCancelPollingInterval);  
            }  
          }, POPUP_WINDOW_CLOSED_CHECK_INTERVAL);  
        };  
  
        // close CCGWidget  
        const closeCCGWidget = () => {  
          widgetPopupInstance?.close();  
        };  
  
        // setup EventListeners: wire up checkout button to generate session, launch and manage hosted widget;  
        const setupEventListeners = () => {  
          const checkoutBtn = document.querySelector("#checkoutBtn");  
  
          checkoutBtn.addEventListener("click", async (event) => {  
            event.preventDefault();  
            closeCCGWidget();  
  
            const session = await generateSessionFromBackend();  
  
            const hostedUrl = session?.data?.hostedUrl;  
  
            if (hostedUrl) {  
              // #3. open widget as popup  
              openCCGWidget(hostedUrl);  
  
              // #4. poll for status  
              pollSessionStatus({  
                url: session.url,  
                onCompleted,  
                onError,  
              });  
            } else {  
              onError(session);  
            }  
          });  
        };  
  
        // Initialize application  
        const init = () => {  
          setupEventListeners();  
        };  
  
        // Start here  
        init();  
      })();  
    </script>  
  </body>  
</html>  

```

## Theming and Styling[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#theming-and-styling "Direct link to Theming and Styling")
  * Refer [Theming and Styling](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Theming-and-Styling/)


## Additional Details[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#additional-details "Direct link to Additional Details")
### Guest vs Wallet Experience[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#guest-vs-wallet-experience "Direct link to Guest vs Wallet Experience")
Refer [Guest vs Wallet Experience](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Guest-vs-Wallet-Experience/)
### Managing 'MerchantTransactionId'[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/#managing-merchanttransactionid "Direct link to Managing 'MerchantTransactionId'")
Refer [Managing MerchantTransactionId](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/Managing-MerchantTransactionId/)


# Terms and FAQ
## Terms[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#terms "Direct link to Terms")
### Merchant[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#merchant "Direct link to Merchant")
Consumer of CCG UI widget/API
### Merchant Identifiers (MCID)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#merchant-identifiers-mcid "Direct link to Merchant Identifiers \(MCID\)")
Refers to the identifier(s) used by each merchant to uniquely identify an user
  * MedicareBeneficiaryIdentifier


### Payment Method[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#payment-method "Direct link to Payment Method")
The method chosen for making a payment. eg: Card, ACH etc
### Default Payment Method[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#default-payment-method "Direct link to Default Payment Method")
The payment method, when marked as default will be selected in the widget by default to make the payment by the customer, until or unless they choose a different payment method for payment.
### Hosted[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#terminology-hosted "Direct link to Hosted")
Refers to the widget version that is hosted and maintained on our servers, accessible through our hosted site.
### Embedded[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#terminology-embedded "Direct link to Embedded")
Refers to the widget version that merchants can download via CDN or NPM to integrate directly into their own websites.
### Guest user[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#terminology-guest-user "Direct link to Guest user")
An anonymous user.
### Wallet user[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#terminology-wallet-user "Direct link to Wallet user")
An authenticated user.
## FAQ[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#faq "Direct link to FAQ")
#### Can there be more than one default payment method for a customer?[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#can-there-be-more-than-one-default-payment-method-for-a-customer "Direct link to Can there be more than one default payment method for a customer?")
No, at a time only one payment method can be set as default for the customer.
#### Can a customer have no default payment method?[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#can-a-customer-have-no-default-payment-method "Direct link to Can a customer have no default payment method?")
Yes, a customer can have payment methods without having a default payment method.
#### Can a customer delete a default payment method?[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#can-a-customer-delete-a-default-payment-method "Direct link to Can a customer delete a default payment method?")
Yes, a customer can delete the default payment method, resulting in payment methods that are not selected by default for payments.
#### Can a customer make a payment with a non-default payment method in the wallet?[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#can-a-customer-make-a-payment-with-a-non-default-payment-method-in-the-wallet "Direct link to Can a customer make a payment with a non-default payment method in the wallet?")
Yes, a customer can make a payment, but they have to choose the payment method first. If there is no default card when the customer lands on the wallet page, none of the cards will be selected, so they have to select a card and make the payment.
#### How to mark a payment method as default?[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#how-to-mark-a-payment-method-as-default "Direct link to How to mark a payment method as default?")
To mark a payment method as default, go to the edit payment method page and check the `Set as default payment method` checkbox. You can get to this page by clicking on the payment method card on the payment method list page.
#### How to mark a payment method as non-default?[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#how-to-mark-a-payment-method-as-non-default "Direct link to How to mark a payment method as non-default?")
To unset an existing default payment method to non-default, go to the edit payment method page and uncheck the `Set as default payment method` checkbox. You can get to this page by clicking on the payment method card on the payment method list page.
#### Can a customer mark a payment method as default during creation?[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#can-a-customer-mark-a-payment-method-as-default-during-creation "Direct link to Can a customer mark a payment method as default during creation?")
Yes, the customer can choose the payment method to be default or non-default while setting up their payment method, using the `Set as default payment method` checkbox at the bottom of the setup payment method form.


# Versioning
  * see [Version History](https://walletprod.healthsafepay.com/wallet/version-history.html "version history")




# Widget Experience


# Guest vs Wallet Experience
The `session` object is used to determine whether the **wallet** or **guest** experience will be displayed for the user. Here is a sample session object:
Session Object Sample
```
{  
  "payment": {  
    "merchantTransactionId": "xxx-xxx-xxx-xxx-xxx",  
    "amount": 1500,  
    "authorizeCard": true,  
    "metaData": {}  
  },  
  "customer": {  
    "email": "<email>",  
    "enterpriseId": "<enterpriseId>",  
    "hsid": "<hsid">,  
    "metaData": {  
      "userId": "<userId>"  
    }  
  }  
}  

```

**wallet** experience is displayed if _one_ of the following is provided:
  * `customer.enterpriseId` has a valid value
  * `customer.hsid` has a valid value
  * (or) `customer.metadata` is a non-null object with valid [Merchant Identifiers (MCID)](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Terms-and-FAQ/#merchant-identifiers-mcid)


otherwise **guest** experience is displayed.


# Widget Translation
### Feature Availability for User Type in CCG Integration Patterns[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-translation/#feature-availability-for-user-type-in-ccg-integration-patterns "Direct link to Feature Availability for User Type in CCG Integration Patterns")
The language translation feature is available in the CCG integration patterns for the following user types:
User Type | Inline | Modal | Drawer | Hosted  
---|---|---|---|---  
Customer | ✅ | ✅ | ✅ | ✅  
Agent | ❌ | ❌ | ❌ | ✅  
Guest | ✅ | ✅ | ✅ | ✅  
### How to Select Preferred Language for CCG Integration Patterns[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-translation/#how-to-select-preferred-language-for-ccg-integration-patterns "Direct link to How to Select Preferred Language for CCG Integration Patterns")
Content translation for the CCG widget is available in both embedded and hosted experience via `POST Session Request` by passing the supported language value for the `preferredLanguage` prop. Beside the initial session request, CCG hosted experience also provides langauge selector dropdown for user to be able to switch language during their journey on the widget. The CCG widget currently supports English and Spanish for the translation feature.
To utilize the language translation feature, refer to the [API documentation](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post).
Language Selection Through | Inline | Modal | Drawer | Hosted  
---|---|---|---|---  
POST `/checkout-sessions` request | ✅ | ✅ | ✅ | ✅  
Language Selector/Dropdown | ❌ | ❌ | ❌ | ✅  
### Example[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-translation/#example "Direct link to Example")
Here is the structure of Config object in POST `checkout-sessions` request including `preferredLanguage`:
```
  "config": {  
    "modes": [  
      "PAYMENT"  
    ],  
    "options": {  
      "saveDisabled": false,  
      "preferredLanguage": "es"   
    }  
  }  

```

### Things to Keep in Mind[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-translation/#things-to-keep-in-mind "Direct link to Things to Keep in Mind")
The following items are not included within the scope of the language translation feature:
  * `API responses from CCG or Stripe` : Merchants are responsible for translating these responses as needed.
  * `Name and Nickname` values entered by customers will not be translated.
  * `Privacy Policy` : The Privacy Policy link shared with CCG should have its own translated version. Refer to [Optum Privacy Policy](https://www.optum.com/en/privacy-policy.html).
  * `ACH mandate`
  * `NPS survey/questionnaire`
  * `ACH Consent Text`
  * `Text and Email to Add (future feature)`
  * `Terms and Conditions` : Check with legal for more details.




# Widget Capabilities
CCG UI widget can be customized to suit specific use cases, ranging from simple one-time payments to managing the entire wallet.
## Capabilities[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#capabilities "Direct link to Capabilities")
### Manage wallet and make payment[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#manage-wallet-and-make-payment "Direct link to Manage wallet and make payment")
  * Provides ability to:
    * Manage wallet
      * Add/update/delete one or more payment method
      * Set a payment method as `default`
    * Make a payment

Mode | User  
---|---  
`PAYMENT_WITH_WALLET` | `wallet`  
### Make one time payment[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#make-one-time-payment "Direct link to Make one time payment")
  * Provides ability to:
    * Make a single payment
    * `wallet` user have the provision to
      * _save the card_ and optionally _set it as default_ while making the payment

Mode | User  
---|---  
`PAYMENT` |  `wallet`,`guest`  
### Add a payment method[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#add-a-payment-method "Direct link to Add a payment method")
  * Provides ability to:
    * Add single payment method

Mode | User  
---|---  
`PAYMENT_METHOD_ENTRY` | `wallet`  
### Manage wallet[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#manage-wallet "Direct link to Manage wallet")
  * Provides ability to:
    * Manage wallet
      * Add/update/delete one or more payment method
      * Set a payment method as `default`

Mode | User  
---|---  
`WALLET` | `wallet`  
### Payment method selector[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#payment-method-selector "Direct link to Payment method selector")
  * Provides ability to:
    * Display all saved payment methods in a users wallet

Mode | User  
---|---  
`PAYMENT_METHOD_SELECT` | `wallet`  
For more information, see the [Payment Method Selector Documentation](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/).
### Payment method display[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/#payment-method-display "Direct link to Payment method display")
  * Provides ability to:
    * Showcase the chosen payment method in card-like display

Mode | User  
---|---  
`PAYMENT_METHOD_DISPLAY` | `wallet`


# Translate Child Session Through Agent Flow
## CCG Language Support[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-translation/child-session-translation/#ccg-language-support "Direct link to CCG Language Support")
Refer [Languages](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Languages/)
## Overview[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-translation/child-session-translation/#overview "Direct link to Overview")
The CCG widget provides agent experience with the capability of enabling translation of child session in the following user journeys:
Agent Experience | Text to Add | Email to Add | Text to Pay | Email to Pay  
---|---|---|---|---  
Language translation for child session | ✅ | ✅ | ✅ | ✅  
### How to Select Preferred Language for child session[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-translation/child-session-translation/#how-to-select-preferred-language-for-child-session "Direct link to How to Select Preferred Language for child session")
Content translation of child session of the CCG widget is supported by giving agent flow an ability to select preferred language for customer (child session) through dropdown featured in the screens metioned above. By selecting customer's preferred language from dropdown, agents are able to support their customers to initiate their CCG widget in selected language.
  * **Example:** `Add payment method` in Agent experience. Please note that the process is similar for `Making a payment`:
![send_text](https://docs.healthsafepay.com/img/send_text.png)
![send_email](https://docs.healthsafepay.com/img/send_email.png)


After initiating a session in the language selected by the agent, customers can still update their preferred language using another language dropdown located in the header part of the CCG widget. Please note that the child session is initiated by the agent and only within the hosted experience.
When customer receives the link through preferred method (text or email), upon clicking it, cgg widget will be initiated as hosted experience for the customer:
![translate_child_session](https://docs.healthsafepay.com/img/child_session_translate.png)
To utilize the language translation feature, refer to the [API documentation](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post).


# Authentication
  * Convenient Checkout API service is available through HCP, allowing users to make RESTful requests without using the Convenient Checkout UI.
  * To utilize any Payment-related APIs, a PaymentMethodId is needed instead of the card number for PCI Compliance.
  * Use cases for these APIs include recurring payments and capturing authorized payments.
  * To access these APIs, visit the [HCP site](https://docs.hcp.uhg.com/api-management/getting-started-consumer) for information on subscribing to and using the Convenient Checkout APIs within the Financial package via the Commerce SubPackage.
  * After configuring this through HCP, access to all APIs in the Commerce sub-package will be provided.




# Stripe Configuration
As a CCG Consumer, Connect account is mandatory to enable online transactions under CCG platform account
## Create Connect Account[​](https://docs.healthsafepay.com/docs/developers/onboarding/stripe-configuration/#create-connect-account "Direct link to Create Connect Account")
  * Login into stripe dashboard(<https://dashboard.stripe.com>)
  * Choose the CCG platform account and follow the [documentation](https://optumfinancial.atlassian.net/wiki/spaces/CC/pages/95944705/Stripe+Connect+Account+Creation+Enable+SSO+Gate#To-create-connected-account-with-Standard-Type.) to create a connect account
  * Enable SSO for connected account at stripe, refer [SSO for Connect Account](https://optumfinancial.atlassian.net/wiki/spaces/CC/pages/95944705/Stripe+Connect+Account+Creation+Enable+SSO+Gate#6.---Enable-SSO-Gated-Feature-for-Account)


## Set up Single Sign On (SSO)[​](https://docs.healthsafepay.com/docs/developers/onboarding/stripe-configuration/#set-up-single-sign-on-sso "Direct link to Set up Single Sign On \(SSO\)")
The Convenient Checkout Admin portal allows SSO capabilities to access the Stripe Dashboard. This capability is provided by the WAM team using Ping Federate. When a user is provisioning access to the Convenient Checkout Admin portal via Secure, groups are assigned automatically allowing the IAM team to use expressions to build out the proper SAML request based on a specific naming convention for accounts and roles.
  * `AZU_CCG_{{ENV}}_STRIPE_ACCT_{{Stripe-Account-ID}}`
  * `AZU_CCG_{{ENV}}_STRIPE_ROLE_{{Stripe-Role}}`


This leads to a direct SSO URL pattern for accessing an account that follows:
[https://dashboard.stripe.com/login/saml_direct/domain/uhg.com/merchant/{{Stripe-Account-ID}}](https://dashboard.stripe.com/login/saml_direct/domain/uhg.com/merchant/%7B%7BStripe-Account-ID%7D%7D)
## Stripe Support[​](https://docs.healthsafepay.com/docs/developers/onboarding/stripe-configuration/#stripe-support "Direct link to Stripe Support")
  * To obtain access, please refer [Getting Access to Slack](https://optumfinancial.atlassian.net/wiki/spaces/PRO/pages/139428128/Getting+Access+to+Slack)
  * Access Stripe Support via [Slack Platform](https://providerworki-i9y5190.slack.com/)
  * Designated Channel - [Optum CCG thread](https://app.slack.com/client/T02GS6Q4TQC/C03LVF9983S)
  * Point of contact(POC): Technical Advisor: `Kyle Macey` with cc: `Bill Christian`
  * Please be advised that slack url is inaccesible within optum network or VPN




# Express Checkout with Digital Wallets
## Overview[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#overview "Direct link to Overview")
Express Checkout is a new feature in Common Checkout UI that enables customers to make payments using digital wallets such as Apple Pay and Google Pay. This integration leverages Stripe's Payment Request API to deliver a streamlined checkout experience with fewer clicks and improved payment completion rates. By reducing payment friction, merchants typically experience a significant increase in the percentage of customers who successfully complete transactions—a key metric for e-commerce success.
## Benefits[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#benefits "Direct link to Benefits")
  * **Simplified Checkout Process** : Reduces the number of steps required to complete a transaction
  * **Higher Conversion Rates** : Minimizes form filling and payment friction, resulting in:
    * Fewer abandoned carts (industry research shows up to 69% of carts are abandoned, with complex checkout being a primary reason[1](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#user-content-fn-1))
    * Increased completion of payment transactions
    * Better return on investment from existing traffic
  * **Enhanced Security** : Utilizes tokenization and device-level authentication for secure payments
  * **Familiar User Experience** : Leverages payment interfaces customers already know and trust


## Implementation[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#implementation "Direct link to Implementation")
Express Checkout is automatically included in the Common Checkout UI payment flow. When enabled, it appears above standard payment methods, allowing customers to choose between Express Checkout options and traditional payment methods.
### Merchant Onboarding Requirements[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#merchant-onboarding-requirements "Direct link to Merchant Onboarding Requirements")
Before implementing Express Checkout, merchants must complete these onboarding steps:
  * **Domain Registration** : For embedded integration using Google Pay and Apple Pay, provide your domain and subdomain(s) (e.g., optum.com, mysubdomainname.optum.com) during CCG onboarding
  * **Feature Activation** : Request CCG to enable Apple Pay and Google Pay features as additional payment methods for your merchant account
  * **Payment Scenario Configuration** : Configure session request properties according to your specific payment scenario (one-time payment or payment with wallet)


### Integration Methods[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#integration-methods "Direct link to Integration Methods")
CCG supports these integration methods for Express Checkout:
#### Web Integration[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#web-integration "Direct link to Web Integration")
Standard web integration functions automatically once all onboarding steps are completed.
#### Mobile WebView Integration[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#mobile-webview-integration "Direct link to Mobile WebView Integration")
For mobile applications using WebView:
  * **iOS WebView** : Standard WebView iOS implementation typically supports Apple Pay and Google Pay without additional configuration
  * **Android WebView** : Payment Request API is not enabled by default for WebView components. [Requirements to use Google Pay](https://developers.google.com/pay/api/android/guides/recipes/using-android-webview) include:
    * App must include dependencies for Payment Request API support
    * Application must be published in production
    * App must be approved and onboarded by the Google Pay team following instructions on [publishing integration](https://developers.google.com/pay/api/android/guides/test-and-deploy/publish-your-integration)


#### Native Application Integration[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#native-application-integration "Direct link to Native Application Integration")
  * CCG does not currently provide a library for native applications
  * Only hosted integration within a WebView or similar component is supported


### Session Configuration[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#session-configuration "Direct link to Session Configuration")
When creating a session that supports Express Checkout, ensure your session request includes all required properties as detailed in the session creation documentation, plus:
  * **Payment Scenario Settings** :
    * For one-time payments: Configure with mode `PAYMENT`, customer details, and payment attributes (including merchant transaction ID, amount, and other required fields)
Session Request - PAYMENT
```
{  
    "customer": {  
        "name": "John Smith",  
        "email": "john.smith@outlook.com",  
        "ssnLastFour": "1001",  
        "dateOfBirth": "2000-09-21",  
        "zip5": "10003",  
        "phoneNumber": {  
            "number": "917-555-3352",  
            "countryCode": "+1"  
        },  
        "metadata": {  
            "patientId": "12345678",  
            "accountNumber": "4259882"  
        }  
    },  
    "payment": {  
        "merchantTransactionId": "ORDER-12345",  
        "statementDescriptorSuffix": "12345 Test",  
        "amount": 15000,  
        "authorizeCard": false,  
    },  
    "config": {  
        "modes": [  
            "PAYMENT"  
        ],  
        "paymentMethodChannel": {  
            "card": [  
                "WEBFORM",  
                "GOOGLE_PAY",  
                "APPLE_PAY"  
            ],  
            "bankAccount": [  
                "WEBFORM"  
            ]  
        }  
    },  
    "consent": {  
      "merchantConsentText": "Nesciunt at esse beatae recusandae aut nulla similique voluptatem nostrum. Est possimus sit enim culpa expedita sint qui sint harum. Delectus earum tenetur molestiae quia voluptas ut aut. Dolorem dolor impedit sint fugiat quae distinctio ullam laudantium nisi. Hic aliquam enim nihil beatae nesciunt rerum et at aut. Cumque qui nesciunt ullam dolores odit ea rerum."  
    }  
}  

```

    * For payment with wallet: Set mode to `PAYMENT_WITH_WALLET` and include all properties required for one-time payments
Session Request - PAYMENT_WITH_WALLET
```
{  
    "customer": {  
        "name": "John Smith",  
        "email": "john.smith@outlook.com",  
        "ssnLastFour": "1001",  
        "dateOfBirth": "2000-09-21",  
        "zip5": "10003",  
        "phoneNumber": {  
            "number": "917-555-3352",  
            "countryCode": "+1"  
        },  
        "metadata": {  
            "patientId": "12345678",  
            "accountNumber": "4259882"  
        }  
    },  
    "payment": {  
        "merchantTransactionId": "ORDER-12345",  
        "statementDescriptorSuffix": "12345 Test",  
        "amount": 15000,  
        "authorizeCard": false,  
    },  
    "config": {  
        "modes": [  
            "PAYMENT_WITH_WALLET"  
        ],  
        "paymentMethodChannel": {  
            "card": [  
                "WEBFORM",  
                "GOOGLE_PAY",  
                "APPLE_PAY"  
            ],  
            "bankAccount": [  
                "WEBFORM"  
            ]  
        }  
    },  
    "consent": {  
      "merchantConsentText": "Nesciunt at esse beatae recusandae aut nulla similique voluptatem nostrum. Est possimus sit enim culpa expedita sint qui sint harum. Delectus earum tenetur molestiae quia voluptas ut aut. Dolorem dolor impedit sint fugiat quae distinctio ullam laudantium nisi. Hic aliquam enim nihil beatae nesciunt rerum et at aut. Cumque qui nesciunt ullam dolores odit ea rerum."  
    }  
}  

```

  * **Merchant Identification** :
    * Configure merchant details comprehensively during onboarding to ensure proper display in payment sheets
      * Include a clear, descriptive statement descriptor to facilitate payment identification in customer transaction statements


### Express Checkout Payment Lifecycle[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#express-checkout-payment-lifecycle "Direct link to Express Checkout Payment Lifecycle")
  1. Initialize CCG Widget.
  2. Initialize and Display Payment Webform or CCG Wallet with Apple Pay / Google Pay if available.
  3. User authenticates payment using Face ID / Touch ID / PIN.
  4. Upon successful authentication, CCG Widget submits payment request to CCG Services.
  5. Transaction completes and User receives confirmation.

![Express Checkout Lifecycle](https://docs.healthsafepay.com/img/express_checkout_flow.png)
## Limitations and Requirements[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#limitations-and-requirements "Direct link to Limitations and Requirements")
### Availability Restrictions[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#availability-restrictions "Direct link to Availability Restrictions")
  * **Self-Service Only** : Express Checkout is available exclusively for self-service (non-agent) sessions and will not appear in agent-assisted payment flows
  * **Geographic Restrictions** : Unavailable in regions where Stripe doesn't support digital wallet payments, specifically:
    * IP addresses in India are not supported by Stripe for these payment methods


### Device and Browser Support[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#device-and-browser-support "Direct link to Device and Browser Support")
  * **Apple Pay** :
    * Requires Safari browser on iOS 10+ or macOS 10.12+
    * Device must be Apple Pay compatible
    * User must have at least one card added to Apple Wallet
    * **Corporate Device Restriction** : Apple accounts are not permitted on UHG/Optum devices; testing requires personal devices equipped with biometric authentication
  * **Google Pay** :
    * Supported on Chrome, Firefox, Safari (Android), and Edge browsers
    * Requires Android 5.0+ or iOS with Google Pay app installed
    * User must have at least one card added to Google Pay account

Browser | Apple Pay | Google Pay  
---|---|---  
Chrome | ❌ | ✅  
Edge | ❌ | ✅  
Firefox | ❌ | ✅  
Opera | ❌ | ✅  
Safari | ✅ | ✅  
Chrome on iOS 16+ | ✅ | ✅  
Firefox on iOS 16+ | ✅ | ✅  
Edge on iOS 16+ | ✅ | ✅  
### Mobile Application Constraints[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#mobile-application-constraints "Direct link to Mobile Application Constraints")
  * **Android Native Applications** : Payment Request API requires:
    * App must include necessary dependencies
    * App must be published in production
    * Google Pay team must approve and onboard the application
  * **Integration Method** : Only hosted integration within WebView or similar components is supported, as CCG does not provide native application libraries


## Testing Guidelines[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#testing-guidelines "Direct link to Testing Guidelines")
### Google/Apple Pay Domain Validation[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#googleapple-pay-domain-validation "Direct link to Google/Apple Pay Domain Validation")
To enable Google Pay and/or Apple Pay on your website, your domain and subdomain must be registered. Follow these steps:
Domain Registration Process
  1. **Domain Registration** :
     * Provide your domain(s) to the CCG team during onboarding
     * Include all relevant subdomains that will offer Google Pay and Apple Pay.
  2. **Domain Validation** :
     * Once you receive confirmation from CCG Team that your domain has been registered, please validate by making a test payment.
     * If the test fails, please reach out to our support team via ServiceNow and use the assignment group: CCG_NONPROD_SUPPORT.


### Test Scenarios[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#test-scenarios "Direct link to Test Scenarios")
Focus testing on successful payment scenarios, as all payment processing occurs through Stripe's network. Declined payment scenarios are already covered by existing credit card payment path tests because:
  * Both Express Checkout and standard credit card payments use the same underlying Stripe payment infrastructure
  * Card decline handling, error responses, and validation logic are implemented at the Stripe gateway level
  * Error codes, decline messages, and exception handling for failed transactions follow the same patterns regardless of the payment method source
  * The same fraud detection, authorization systems, and gateway error handling apply to both Express Checkout payments and manual card entry


This shared infrastructure eliminates the need to duplicate declined payment testing specifically for Express Checkout payments.
### Test Device Requirements[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#test-device-requirements "Direct link to Test Device Requirements")
  * **For Apple Pay Testing** : Use a personal device with:
    * Safari browser
    * Apple Pay configured with a valid Stripe test card (no actual charges will occur in nonproduction environments)
    * Biometric authentication enabled (Touch ID or Face ID)
  * **For Google Pay Testing** : Use a device with:
    * Chrome browser
    * Google account registered with the Google Developer Program for full testing capabilities[2](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#user-content-fn-2)


### Test Recommendations[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#test-recommendations "Direct link to Test Recommendations")
  1. **Device/Browser Detection** : Verify wallet buttons appear only on supported devices and browsers
  2. **Button Display** : Confirm buttons are properly styled and positioned
  3. **Payment Flow** : Complete test transactions using each available wallet method
  4. **Confirmation** : Verify successful payment completion and receipt of related webhook payment events if applicable


## Troubleshooting[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#troubleshooting "Direct link to Troubleshooting")
### Common Issues[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#common-issues "Direct link to Common Issues")
  * **Buttons Not Appearing** : Verify device and browser support, and confirm wallet setup
  * **Payment Failures** : Check test card configuration and network connectivity
  * **Integration Issues** : Confirm CCG widget configuration and session request parameter setup


### Support[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#support "Direct link to Support")
For technical assistance with Express Checkout integration, contact CCG support and provide:
  * Detailed issue description
  * Device and browser information
  * Screenshots or error messages (if applicable)
  * Transaction ID (if a payment was attempted)


## Future Enhancements[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#future-enhancements "Direct link to Future Enhancements")
Express Checkout will continue to evolve with updates and support according to changes in the underlying payment gateway provider used to support Google Pay and Apple Pay. Contact the Product Team if you need to extend functionalities related to this feature. You can also submit a ticket on the [idea portal](https://docs.healthsafepay.com/docs/ideas/).
## References[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#references "Direct link to References")
## Footnotes[​](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#footnote-label "Direct link to Footnotes")
  1. Baymard Institute. (2023). "Cart Abandonment Rate Statistics." According to their research, the average cart abandonment rate is 69.82%, and checkout complexity is among the top reasons for abandonment. <https://baymard.com/lists/cart-abandonment-rate> [↩](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#user-content-fnref-1)
  2. Google Pay API. "Test Card Suite." For testing Google Pay integration, use the recommended test cards and configuration settings. <https://developers.google.com/pay/api/android/guides/resources/test-card-suite> [↩](https://docs.healthsafepay.com/docs/developers/onboarding/express-checkout-with-digital-wallet/#user-content-fnref-2)




# Combined Payout report
Combined Payout report merges all Merchant Payout reports into a single file. This file is delivered to treasury for reconciliation and contains all the Merchants that CCG services has under the UHC Entity such as Rx, UHC, Solutran, etc.
This report is generated on a daily basis, being triggering for a date two days prior. For example, if the report is triggered on June 11th, 2024, the timestamp range will be set from June 9th, 2024 00:00:00 UTC to June 10th, 2024 00:00:00 UTC. Please note that this report will be delivered 24 hours after the Merchant Payout report.
The file will be delivered on a daily basis between 11:00 and 16:00 UTC via ECG.
It includes:
  * [CCG specific metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-specific-metadata)
  * [Transaction data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#transaction-data)


### Report name format:[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Combined%20Report/#report-name-format "Direct link to Report name format:")
`<report-name>_<yyyymmdd>.csv` where  
Report-name is type of report. In this case: CCG_Treasury_CombinedPayout  
Example: CCG_Treasury_CombinedPayout_20231202.csv
### Report Example[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Combined%20Report/#report-example "Direct link to Report Example")
[Stripe_Treasury_CombinedPayout_20230824.csv](https://github.com/optum-financial/ConvenientCheckout/files/12641616/Stripe_Treasury_CombinedPayout_20230824.csv)


# ECG Setup
[ECG Setup](https://ecgdash.healthtechnologygroup.com/cockpit/home.do) has details on how to request and setup. Merchant, Finance and Treasury team members can get the reports from ECG source location. CCG will provide source user ID and Merchant ID during Merchant configuration that will be needed for the setup.
## ECG Folder Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/ECG-SetUp/#ecg-folder-structure "Direct link to ECG Folder Structure")
Merchant determines the destination location.  
ECG Source folder structure to request for Individual Payout report: `/ccg/<env>/reports/<merchant-id>`
ECG Source folder structure to request for Treasury Payout report: `/ccg/<env>/reports/treasury`


# Merchant Payout report
The Merchant Payout report is a comprehensive reconciliation report designed specifically for merchants. It serves as a detailed record that outlines fund transfers made to the merchant's bank account. This report includes important information such as the date, amount, currency, payment and refund metadata, the total sum of fees deducted, etc.
This report is generated daily, providing information up until the previous day. For example, if the report is triggered on June 11th, 2024, the timestamp range will cover from June 10th, 2024 00:00:00 UTC to June 11th, 2024 00:00:00 UTC. The time it takes for a transaction to appear in the payout report varies depending on the transaction type and settlement date. Typically, a sale could take up to 24 hours to be reflected, while **authorizations may take longer, depending on the capture date**.
The file will be delivered on a daily basis between 11:00 and 16:00 UTC via ECG.
It includes three types of data specified above:
  * [CCG specific metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-specific-metadata)
  * [Merchant specific metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-specific-metadata)
  * [Transaction data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#transaction-data)


### Report name format:[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Merchant-payout/#report-name-format "Direct link to Report name format:")
`<ccg-merchant-id>_<report-source>_<report-name>_<yyyymmdd>.csv` where  
ccg-merchant-id is what CCG will provide after configuration. Example: 44387763-4eeb-4592-a564-b10aadee95be  
report-source is the source where the report was generated. In this case: CCG Report-name is type of report. In this case: MERCHANT_DAILY_PAYOUT_TRANSACTION Example: 1729eb88-619a-49d0-8780-a04e79243337_CCG_MERCHANT_DAILY_PAYOUT_TRANSACTION_20231204.csv
### Payout Report Delivery[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Merchant-payout/#payout-report-delivery "Direct link to Payout Report Delivery")
Payout reports are delivered daily. It is important to note that reports delivered on Sunday, Monday, and the day after a bank holiday, which correspond to transactions from Saturday, Sunday, and the bank holiday, will be empty.
Transactions are displayed in the payout reports once they are settled, whether it is a sale, authorization, refund, dispute, fee or network cost. Other fees may be applicable.
#### Sale or Authorization[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Merchant-payout/#sale-or-authorization "Direct link to Sale or Authorization")
The examples below illustrate the schedule for the capture of sales or authorizations, their respective settlement dates, and the date of the payout report in which it will be shown:
Sale or Authorization Capture Date | Settlement | Payout Report Delivery Date  
---|---|---  
Friday (2025-01-03 23:57:15 UTC) | Monday (2025-01-06) | Tuesday (2025-01-07)  
Saturday (2025-01-04 00:07:43 UTC) | Tuesday (2025-01-07) | Wednesday (2025-01-08)  
Sunday (2025-01-05 14:36:10 UTC) | Tuesday (2025-01-07) | Wednesday (2025-01-08)  
Monday (2025-01-06 17:19:03 UTC) | Tuesday (2025-01-07) | Wednesday (2025-01-08)  
Tuesday (2025-01-07 11:43:12 UTC) | Wednesday (2025-01-08) | Thursday (2025-01-09)  
Wednesday (2025-01-08 19:47:13 UTC) | Thursday (2025-01-09) | Friday (2025-01-10)  
Thursday (2025-01-09 06:39:36 UTC) | Friday (2025-01-10) | Saturday (2025-01-11)  
Day before bank holiday (2024-12-31 15:45:24 UTC) | Next working-day (2025-01-02) | Next day after settlement (2025-01-03)  
#### Refunds or Disputes[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Merchant-payout/#refunds-or-disputes "Direct link to Refunds or Disputes")
Below examples illustrates the schedule for the refunds or disputes, their respective settlement dates, and the date of the payout report in which it will be shown:
Refund or Dispute Date | Settlement | Payout Report Delivery Date  
---|---|---  
Friday (2025-01-03 07:33:53 UTC) | Monday (2025-01-06) | Tuesday (2025-01-07)  
Saturday (2025-01-04 07:41:44 UTC) | Monday (2025-01-06) | Tuesday (2025-01-07)  
Sunday (2025-01-05 07:41:44 UTC) | Monday (2025-01-06) | Tuesday (2025-01-07)  
Monday (2025-01-06 21:29:39 UTC) | Tuesday (2025-01-07) | Wednesday (2025-01-08)  
Tuesday (2025-01-07 11:52:06 UTC) | Wednesday (2025-01-08) | Thursday (2025-01-09)  
Wednesday (2025-01-08 19:50:58 UTC) | Thursday (2025-01-09) | Friday (2025-01-10)  
Thursday (2025-01-09 06:36:37 UTC) | Friday (2025-01-10) | Saturday (2025-01-11)  
Day before bank holiday (2024-12-31 18:22:25 UTC) | Next working-day (2025-01-02) | Next day after settlement (2025-01-03)  
#### Fee or Network Cost[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Merchant-payout/#fee-or-network-cost "Direct link to Fee or Network Cost")
Below examples illustrates the schedule for the fee or network cost, their respective settlement dates, and the date of the payout report in which it will be shown:
Fee or Network Cost Date | Settlement | Payout Report Delivery Date  
---|---|---  
Friday (2025-01-03 08:00:36 UTC) | Monday (2025-01-06) | Tuesday (2025-01-07)  
Saturday (2025-01-04 07:41:44 UTC) | Monday (2025-01-06) | Tuesday (2025-01-07)  
Sunday (2025-01-05 07:23:51 UTC) | Monday (2025-01-06) | Tuesday (2025-01-07)  
Monday (2025-01-06 07:05:47 UTC) | Tuesday (2025-01-07) | Wednesday (2025-01-08)  
Tuesday (2025-01-07 07:14:54 UTC) | Wednesday (2025-01-08) | Thursday (2025-01-09)  
Wednesday (2025-01-08 07:28:27 UTC) | Thursday (2025-01-09) | Friday (2025-01-10)  
Thursday (2025-01-09 07:42:14 UTC) | Friday (2025-01-10) | Saturday (2025-01-11)  
Day before bank holiday (2024-12-31 07:34:18 UTC) | Next working-day (2025-01-02) | Next day after settlement (2025-01-03)  
Adjustments on fees or network costs for previous days may be added to the payout reports.
#### Time Zone and Bank Holiday Considerations[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Merchant-payout/#time-zone-and-bank-holiday-considerations "Direct link to Time Zone and Bank Holiday Considerations")
All days of the week are based on Coordinated Universal Time (UTC). Consequently, transactions dates considered in other time zones might appear in the payout report of the following day. Each Payout Report Date encompasses a full day from 00:00:00 to 23:59:59 UTC. For example, the report for January 3, 2025, covers transactions from 2025-01-03 00:00:00 UTC to 2025-01-03 23:59:59 UTC.
Furthermore, the payout reports bank holiday considerations will be aligned with the official holidays observed by US banks.
### Report Example[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Merchant-payout/#report-example "Direct link to Report Example")
[44387763-4eeb-4592-a564-b10aadee95be_STRIPE_MERCHANT_DAILY_PAYOUT_TRANSACTION_20230531_frr_1NiaKbJZKFwWoBI2S3iWEW3r.csv](https://github.com/optum-financial/ConvenientCheckout/files/12641624/44387763-4eeb-4592-a564-b10aadee95be_STRIPE_MERCHANT_DAILY_PAYOUT_TRANSACTION_20230531_frr_1NiaKbJZKFwWoBI2S3iWEW3r.csv)


# Reporting data
## Types of Data[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#types-of-data "Direct link to Types of Data")
Depending on the audience of Payout report, it will be composed of the combination of four categories of data:
  * [Reporting data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#reporting-data)
    * [Types of Data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#types-of-data)
      * [CCG specific metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-specific-metadata)
        * [CCG Payment metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-payment-metadata)
        * [CCG Refund metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-refund-metadata)
      * [Merchant specific metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-specific-metadata)
        * [Merchant Payment metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-payment-metadata)
        * [Merchant Refund Metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-refund-metadata)
      * [Transaction data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#transaction-data)
      * [Fee data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#fee-data)


### CCG specific metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-specific-metadata "Direct link to CCG specific metadata")
CCG will always include the following metadata in payments and other transactions.
#### CCG Payment metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-payment-metadata "Direct link to CCG Payment metadata")
Field Name | Description | Sample value  
---|---|---  
checkoutId | CCG unique checkout identifier | 434189e3-e63v-47ef-a8fc-0d9a6d22f6c8  
merchantGroupId | CCG merchant Group Identifier composed of different Merchants belonging to a same group | 98da3d38-ff4j-44ee-be00-c47a94ed01a4  
merchantId | CCG unique merchant identifier | d4d9760a-9cea-45h8-a25d-e6a3612e479a  
merchantName | CCG merchant name | someNewMerchant-merchant-stage  
merchantTransactionId | Merchant payment transaction identifier | cef9923e-9fe0-4679-82hf-7151fe311cbb  
referenceId | CCG unique reference identifier | e1837bc7-f5b3-4f52-bfrg-77e8d1cc95a0  
ccg_processor | CCG processor | STRIPE  
ccg_paymentmethodlast4 | CCG payment method last 4 | 1234  
ccg_nameoncard | CCG name that was entered for the card | Shahrukh Khan  
ccg_paymentmethodnickname | CCG nickname for customers payment method | personal WF Master  
ccg_paymentMethodId | CCG Payment method id | 534179e3-redv-47ef-a7fc-0d9a5d22f6c7  
merchantTransactionId | merchant unique Transaction identifier | cef9923e-9fe0-4679-82hf-7151fe311cbb  
#### CCG Refund metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-refund-metadata "Direct link to CCG Refund metadata")
Field Name | Description | Sample value  
---|---|---  
ccg_refundId | CCG unique refund identifier | bf75eb27-7b1f-4171-b27f-099a284f5540  
merchantTransactionId | Merchant refund transaction identifier | cef9923e-9fe0-4679-82hf-7151fe312cbe  
### Merchant specific metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-specific-metadata "Direct link to Merchant specific metadata")
Merchant chosen data that may be beneficial to tie back to Merchant records for reconciling, reporting etc. Merchant can have payment or refund specific metadata.
#### Merchant Payment metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-payment-metadata "Direct link to Merchant Payment metadata")
Some examples of Payment meta data:
Field Name | Description | Sample value  
---|---|---  
ItemCode | Merchants unique code for an Item | 3456-4876  
orderId | Merchant unique orderId | 98da3d38-ff4j-44ee-be00-c47a94ed01a4  
siteName | Merchant site where payment is initiated from | [www.somesitename.com](http://www.somesitename.com)  
claimId | Merchant unique claim identifier payment is made for | ABCDE-12345  
InvoiceNumber | Merchant unique Invoice number payment is made for | 34987  
#### Merchant Refund Metadata[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-refund-metadata "Direct link to Merchant Refund Metadata")
Some examples of Refund meta data:
Field Name | Description | Sample value  
---|---|---  
Refund_ID | Merchants refund Identifier | 3456-4876  
Claim_ID | Claim ID the refund will go towards | ABCDF-12346  
### Transaction data[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#transaction-data "Direct link to Transaction data")
Field Name | Description | Sample value  
---|---|---  
customer_name | Name of the customer, if any, associated with the transaction | John Smith  
customer_email | Email address of the customer, if any, associated with the transaction | testcustomer@gmail.com  
reporting_category | Categorization of transaction | charge  
charge_created_utc | Creation time of the original charge associated with this balance transaction. Available for charges, refunds and disputes. For charges that were separately authorized and captured, this is the authorization time. Dates in UTC. | 2023-08-16 10:14:30  
payment_method_type | The type of payment method used in the related payment. | card  
dispute_reason | Reason given by cardholder for dispute | fraudulent  
shipping_address_postal_code | Postal code of the shipping address associated with this charge, if any | 123456  
currency | Three-letter ISO code for the currency in which the gross, fee and net amounts are defined | usd  
created_utc | Time at which the balance transaction was created. Dates in UTC. | 2023-08-16 10:15:32  
available_on_utc | The date the balance transaction’s net funds will become available in the Stripe balance. Dates in UTC. | 2023-08-23 12:00:00  
gross | Gross amount of the transaction. Expressed in major units of the currency | 35.33  
net | Net amount of the transaction. Expressed in major units of the currency | 34.01  
fee | Fees paid for this transaction Expressed in major units of the currency | 1.32  
description | Payment description that will be useful to a Merchant to identify the payment | UI widget payment  
card_brand | CCG merchant name, set up when the merchant is onboarded | Possible values:AMEX, CARTES_BANCAIRES, DINERS, DISCOVER, INTERAC, JCB, MASTERCARD, UNIONPAY, VISA, UNKNOWN  
card_funding | CCG merchant name, set up when the merchant is onboarded | Possible values:CREDIT, DEBIT, PREPAID, UNKNOWN  
processor | Who processed the transaction | STRIPE  
payment_method_last4 | The last four of the payment method account/card number | 1234  
### Fee data[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#fee-data "Direct link to Fee data")
Field Name | Description | Sample value  
---|---|---  
balance_transaction_created_at | Creation time of this balance transaction Dates in UTC. | 2024-04-02 08:22:00  
balance_transaction_reporting_category | Categorization of balance transaction | charge  
balance_transaction_component |  | per_auth_fee  
event_type | The originating type of event | charge_authorized  
activity_at | The time associated with this balance transaction. Dates in UTC. | 2024-04-01 23:37:00  
activity_interval_type | The transaction time interval | instant  
activity_start_date | The transaction start time. Dates in UTC. | 2024-04-01  
activity_end_date | The transaction end time. Dates in UTC. | 2024-04-01  
amount | Amount of the transaction in major units | 25.000000  
balance_transaction_description | Description of the transaction | SALE Transaction  
card_address_postal_code | Postal code of the card address | 12345  
automatic_payout_effective_at | The expected automatic payout date. Dates in UTC. | 2024-04-03 00:05:00:00  
card_country | The two-letter ISO country code | US  
statement_descriptor


# Transaction-Level Fee report
Transaction-Level Fee report is a comprehensive document that provides a detailed breakdown of all fees associated with transactions within a given date range.
This report is generated on a daily basis, with the latest possible triggering date being three days prior. For example, if the report is triggered on June 11th, 2024, the timestamp range will be set from June 7th, 2024 00:00:00 UTC to June 8th, 2024 00:00:00 UTC. Please note that there will be a time difference of 48 to 72 hours between this report and the Payout report if we want to see the broken down fees for a charge reflected in the Payout report.
The file will be delivered on a daily basis between 11:00 and 16:00 UTC via ECG.
This transaction-level fee report is specific to a Merchant. It includes all four types of data specified above:
  * [CCG specific payment metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-specific-metadata)
  * [Merchant specific payment metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#merchant-specific-metadata)
  * [Transaction data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#transaction-data)
  * [Fee data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#fee-data)


This report will not be enabled by default. Merchant should request enabling it. The reports will be delivered to merchant ECG location.
### Report name format:[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Transaction-level-fee-report/#report-name-format "Direct link to Report name format:")
`<ccg-merchant-id>_<report-source>_<report-name>_<yyyymmdd>.csv` where  
ccg-merchant-id is what CCG will provide after configuration. Example: f09af645-6e53-4a97-a209-ddfb0c846ccd  
report-source is the source where the report was generated. In this case: CCG Report-name is type of report. In this case: MERCHANT_DAILY_TRANSACTION_LEVEL_FEE_REPORT Example: f09af645-6e53-4a97-a209-ddfb0c846ccd_CCG_MERCHANT_DAILY_TRANSACTION_LEVEL_FEE_REPORT_20240401.csv
[f09af645-6e53-4a97-a209-ddfb0c846ccd_CCG_MERCHANT_DAILY_TRANSACTION_LEVEL_FEE_REPORT_20240401.csv](https://github.com/user-attachments/files/15792049/f09af645-6e53-4a97-a209-ddfb0c846ccd_CCG_MERCHANT_DAILY_TRANSACTION_LEVEL_FEE_REPORT_20240401.csv)


# Partial Authorization
##### Partial authorization[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Partial%20Authorization/#partial-authorization-1 "Direct link to Partial authorization")
```
{  
    "name": "PAYMENT_AUTHORIZED",  
    "payload": {  
        "amount": 5000,  
        "capturedAmount": 0,  
        "authorizedAmount": 3500,  
        "partialAuthorization": true,  
        "description": "Test Payment from Postman_16",  
        "id": "2b12ce09-73eb-43c3-b39b-89419f319746",  
        "merchantId": "44387763-4eeb-4592-a564-b10aadee95be",  
        "merchantTransactionId": "100ee626-0795-4b5e-b0d9-c543868207b1",  
        "paymentDateUtc": "2024-05-06T12:43:19.550101",  
        "paymentMethod": {  
            "card": {  
                "cardBrand": "VISA",  
                "expiryMonth": 5,  
                "expiryYear": 2055,  
                "last4": "0014",  
                "status": "ACTIVE",  
                "manufacturerCard": false  
            },  
            "paymentMethodType": "CARD",  
            "paymentMethodDetails": {  
                "type": "CARD",  
                "cardBrand": "VISA",  
                "expiryMonth": 5,  
                "expiryYear": 2055,  
                "last4": "0014",  
                "status": "ACTIVE",  
                "manufacturerCard": false  
            },  
            "default": false  
        }  
    }  
}  

```



# Payment Method
### Supported Events[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#supported-events "Direct link to Supported Events")
  * PAYMENT_METHOD_CREATED - Emitted when a payment method is created.
  * PAYMENT_METHOD_UPDATED - Emitted when a payment method is updated.
  * PAYMENT_METHOD_DELETED - Emitted when a payment method is deleted.
  * PAYMENT_METHOD_REPLACED - Emitted when a payment method is replaced, [find more details here](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Replace-Payment-Method/).


### Event Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#event-structure "Direct link to Event Structure")
Field | Type | Valid values | Description  
---|---|---|---  
name | Enum | PAYMENT_METHOD_CREATED, PAYMENT_METHOD_UPDATED, PAYMENT_METHOD_DELETED, PAYMENT_METHOD_REPLACED | Event name  
source | string | Max length 50 | Indicates the X-source header value received in API request  
payload | [Payload](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#payload-structure-1) |  | Event Payload  
#### Payload Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#payload-structure "Direct link to Payload Structure")
Field | Type | Valid values | Description  
---|---|---|---  
paymentMethod | [PaymentMethod](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#paymentmethod-structure) |  | Paymentmethod Description  
customer | [Customer](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#customer-structure) |  | Customer Description  
agent | [Agent](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#agent-structure) |  | Agent Description  
deletedPaymentMethodId | UUID | Valid UUID | Deleted PaymentMethod Id, in PAYMENT_METHOD_REPLACED event  
#### Customer Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#customer-structure "Direct link to Customer Structure")
Field | Type | Valid values | Description  
---|---|---|---  
enterpriseId | string | Max length | Enterprise Identifier  
hsid | uuid | valid uuid4 | Healthsafe Identifier  
metadata | Object |  | Client provided additional metadata  
firstName | String |  | first name  
lastName | String |  | last name  
dateOfBirth | Date (YYYY-MM-DD) |  | Date of Birth, e.g. 1975-11-14  
email | String |  | email address  
ssnLastFour | Digits (4) |  | SSN last four digits, e.g 1234  
phoneNumber | Object |  | Contains both the phone number and the country code  
└─ number | Digits (10-20) |  | Phone number, e.g. 9876543210  
└─ countryCode | Digits (1-3) |  | Country code, e.g. 91  
zip5 | Digits (5) |  | ZIP Code, e.g. 10001  
#### Agent Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#agent-structure "Direct link to Agent Structure")
Field | Type | Valid values | Description  
---|---|---|---  
firstName | string | Max length 50 | First name of Agent  
lastName | string | Max length 50 | First name of Agent  
userId | string | Max length 50 | MSId of Agent  
isAccessVerified | boolean | true/false | Is access verified by merchant  
#### Paymentmethod Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#paymentmethod-structure "Direct link to Paymentmethod Structure")
Field | Type | Valid values | Description  
---|---|---|---  
id | uuid | valid uuid4 | Payment method Id  
~~card~~ | [Card](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#card-structure) |  | Card Description when payment Method is of type CARD.   
**Deprecated in favour of paymentMethodDetails**  
nickname | string | Max length 50 | Payment method nickname  
default | boolean | true/false | determines if the payment method is default for the customer  
paymentMethodType | string | Max length 50 | Payment method type can be CARD or BANK_ACCOUNT  
paymentMethodDetails |  [Card](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#card-structure) or [ACH](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#ach-structure) |  | One of Card or ACH  
#### Card Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#card-structure "Direct link to Card Structure")
Field | Type | Valid values | Description  
---|---|---|---  
nameOnCard | string | Max length 50 | Name of the customer  
cardBrand | string | VISA, AMEX, DINERS, DISCOVER, JCB, MASTERCARD, UNIONPAY, UNKNOWN | Card brand  
expiryMonth | long | 01-12 | Month of expiration  
expiryYear | long | Max length 4 | Year of expiration  
last4 | string | Max length 4 | Last four digits of the card  
zipCode | string | Max length 5 | 5 digit zipcode  
status | string | ACTIVE/EXPIRED | Status of the card  
manufacturerCard | boolean | true/false | Determines if the card is manufacturer card or not. Only Agents can flag certain cards as manufacturer cards. Cards flagged as manufacturer cards cannot be default card.  
#### ACH Structure[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#ach-structure "Direct link to ACH Structure")
Field | Type | Valid values | Description  
---|---|---|---  
type | string | BANK_ACCOUNT | Type of the PaymentMethod  
accountHolderType | string | individual or company | Account holder type  
accountType | string | checking or savings | Account Type  
bankName | string |  | Bank Name  
last4 | string |  | Last 4 digits of bank account number  
routingNumber | string |  | Routing number of bank  
nameOnAccount | string |  | Name on Account  
status | enum | ACTIVE and INVALIDATED | Bank Account Status  
#### Sample Event[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#sample-event "Direct link to Sample Event")
Events will be sent in JSON format.
##### CARD Payment Method[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#card-payment-method "Direct link to CARD Payment Method")
**_card_** object under paymentMethod is deprecated in favor of paymentMethodDetails. Please refer [PaymentMethod](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#paymentmethod-structure) for more details.
```
{  
    "name": "PAYMENT_METHOD_CREATED | PAYMENT_METHOD_UPDATED | PAYMENT_METHOD_DELETED | PAYMENT_METHOD_REPLACED",  
    "source": "vendor-portal",  
    "payload": {  
        "paymentMethod": {  
            "id": "497f6eca-6276-4993-bfeb-53cbbbba6f08",  
            "card": {  
                "last4": "string",  
                "type" : "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
             "paymentMethodDetails": {  
                "last4": "string",  
                "type" : "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
            "default": true,  
            "paymentMethodType": "CARD",  
            "nickname": "string"  
        },  
        "customer": {    
             "name": null,    
             "firstName": "John",    
             "lastName": "Doe",    
             "email": "test@mail.com",    
             "ssnLastFour": "6785",    
             "dateOfBirth": "2000-09-21",    
             "hsid": "62b737bf-ca25-4319-b2b7-05d0fd684654",    
             "enterpriseId": enterprise id,    
             "zip5": null,    
             "phoneNumber": {    
             "number": "9876543210",    
             "countryCode": "91"    
             },    
             "metadata": {  
                "patientId": "rx-patient-id"  
            }    
        },  
        "agent": {  
            "firstName": "First Name",  
            "lastName": "Last Name",  
            "userId": "msId",  
            "isAccessVerified": true  
        },  
        "deletedPaymentMethodId": "597f6eca-6276-4993-bfeb-53cbbbba6f12"  
    }  
}  

```

##### BankAccount Payment Method[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/#bankaccount-payment-method "Direct link to BankAccount Payment Method")
```
{  
    "name": "PAYMENT_METHOD_CREATED | PAYMENT_METHOD_UPDATED | PAYMENT_METHOD_DELETED | PAYMENT_METHOD_REPLACED",  
    "source": "vendor-portal",  
    "payload": {  
        "paymentMethod": {  
            "id": "497f6eca-6276-4993-bfeb-53cbbbba6f08",  
            "paymentMethodType": "BANK_ACCOUNT",  
            "paymentMethodDetails": {  
                "type": "BANK_ACCOUNT",  
                "accountHolderType": "individual",  
                "accountType": "checking",  
                "bankName": "STRIPE TEST BANK",  
                "last4": "6789",  
                "routingNumber": "110000000",  
                "nameOnAccount": "Name on account test",  
                "status": "ACTIVE"  
            },  
            "nickname": "Nickname test",  
            "default": true  
        },  
        "customer": {    
             "name": null,    
             "firstName": "John",    
             "lastName": "Doe",    
             "email": "test@mail.com",    
             "ssnLastFour": "6785",    
             "dateOfBirth": "2000-09-21",    
             "hsid": "62b737bf-ca25-4319-b2b7-05d0fd684654",    
             "enterpriseId": enterprise id,    
             "zip5": null,    
             "phoneNumber": {    
                "number": "9876543210",    
                "countryCode": "91"    
             },    
             "metadata": {  
                "patientId": "rx-patient-id"  
            }    
        },  
        "agent": {  
            "firstName": "First Name",  
            "lastName": "Last Name",  
            "userId": "msId",  
            "isAccessVerified": true  
        },  
        "deletedPaymentMethodId": "597f6eca-6276-4993-bfeb-53cbbbba6f12"  
    }  
}  

```



# Add Payment method
  * CCG allows you to add below payment method to your wallet
    * `CARD`
    * `BANK ACCOUNT`
  * A Customer can add a valid card to thier wallet and mark that card as default payment method
  * Adding a payment method can be done through [Convienient Checkout UI](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/) or [Convienient Checkout API](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/)
  * Channels supported to add a payment method
    * TEXT
    * EMAIL
    * ON SCREEN ENTRY
    * TELEPHONIC ENTRY




# Update Payment method
  * CCG allows you to update below payment method to your wallet
    * `CARD`
    * `BANK ACCOUNT`
  * A Customer can flag/de-flag a payment method as default payment method
  * A Customer or Agent can update only the valid card, For Example, user cannot update a [Invalidated Payment Method](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/BankAccount/Invalidated%20Payment%20Method/)
  * Updating a payment method can be done through [Convienient Checkout UI](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/) or [Convienient Checkout API](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/)




# Remove Payment method
  * CCG allows you to remove below payment method from your wallet
    * `CARD`
    * `BANK ACCOUNT`
  * Updating a payment method can be done through [Convienient Checkout UI](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/) or [Convienient Checkout API](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/)




# Wallet
## What is Wallet?[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Manage%20Wallet/#what-is-wallet "Direct link to What is Wallet?")
Wallets allows users to store payment information securely for making online transactions. Digital wallets can store various payment methods, such as credit or debit card details, bank account information, and even cryptocurrency. Users can link their preferred payment methods to their digital wallet for quick and convenient checkout processes.
When a user chooses to pay using a wallet through a payment gateway, the payment information stored in the digital wallet is securely transmitted for authorization and processing. This eliminates the need for users to manually enter payment details for each transaction, streamlining the payment process and enhancing convenience and security for both users and merchants thus enabling One-Click Payments.
## Manage Wallet[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Manage%20Wallet/#manage-wallet "Direct link to Manage Wallet")
Managing a wallet involves tasks such as adding, removing, updating, and organizing payment methods within a digital wallet. Users can manage their digital wallets through various actions, including:
  * **Adding Payment Methods** : Users can add different payment methods, such as credit cards, debit cards, bank accounts, or other forms of payment, to their digital wallet for future transactions.
  * **Updating Payment Methods** : Users can update or edit existing payment method information stored in their digital wallet, such as updating expiration dates, billing addresses, name on payment method.
  * **Removing Payment Methods** : Users can remove outdated or unused payment methods from their digital wallet to declutter and streamline their payment options.
  * **Setting Preferences** : Users may have the option to set preferences within their digital wallet, such as default payment methods.
  * **Making Payment** : Users can choose a desired payment method and make a payment




# EMAIL Channel
Supported modes
> EMAIL_TO_ADD - Adding a payment method  
>  EMAIL_TO_PAY - Making a payment
## EMAIL TO ADD FLOW[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/email-channel/#email-to-add-flow "Direct link to EMAIL TO ADD FLOW")
Agent Initiates Session and launches widget
Agent selects EMAIL channel
Agent sends a Email with Add Payment Method link to customer phoneNumber
Customer recieves add payment method link
Customer completes payment method adding successfully
## EMAIL TO PAY FLOW[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/email-channel/#email-to-pay-flow "Direct link to EMAIL TO PAY FLOW")
Agent Initiates Session and launches widget
Agent selects EMAIL channel
Agent sends a Email with make a payment link to customer phoneNumber
Customer recieves make a payment link
Customer completes payment method adding successfully


# TEXT Channel
Supported modes
> TEXT_TO_ADD - Adding a payment method  
>  TEXT_TO_PAY - Making a payment
## TEXT TO ADD FLOW[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/text-channel/#text-to-add-flow "Direct link to TEXT TO ADD FLOW")
Agent Initiates Session and launches widget
Agent selects TEXT channel
Agent sends a Text with Add Payment Method link to customer phoneNumber
Customer recieves add payment method link
Customer completes payment method adding successfully
## TEXT TO PAY FLOW[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/text-channel/#text-to-pay-flow "Direct link to TEXT TO PAY FLOW")
Agent Initiates Session and launches widget
Agent selects TEXT channel
Agent sends a Text with make a payment link to customer phoneNumber
Customer recieves make a payment link
Customer completes payment method adding successfully


# Payment Method Channels
A payment method channel refers to the medium or platform through which a payment transaction is initiated and processed. It can include various methods such as wallets, online payment gateways, and other electronic payment systems that facilitate the transfer of funds between a payer and a payee. Payment channels provide the infrastructure for secure and efficient payment processing, allowing individuals and businesses to make and receive payments electronically.
### Allowed Payment Method Channels[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/#allowed-payment-method-channels "Direct link to Allowed Payment Method Channels")
  * [On-Screen Entry](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/on-screen-entry/)
  * [TEXT](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/text-channel/)
  * [EMAIL](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/email-channel/)
  * Telephonic Entry


### PCI Compliance[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/#pci-compliance "Direct link to PCI Compliance")
PCI compliance refers to the adherence to the Payment Card Industry Data Security Standard (PCI DSS), which is a set of security standards designed to ensure that all companies that accept, process, store, or transmit credit card information maintain a secure environment. Compliance with PCI DSS helps to protect cardholder data from security breaches and fraud.


# On-Screen Entry
On-screen entry is a process by which customers input their payment information directly on the screen during an online transaction. This typically occurs during the checkout process when a customer is ready to make a purchase on an e-commerce website or mobile app that uses a payment gateway to process payments.
Customers are presented with a payment form on the screen where they enter their payment details, such as credit card number, expiration date, CVV code, billing address, and any other required information. This information is securely transmitted to the payment gateway for processing and authorization.
Payment Method Type | Agent | Customer  
---|---|---  
CARD | Allowed for agents belongs to [WS2](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/ws2/) | Allowed  
Bank Account | Allowed | Allowed  
Google Pay | Not Applicable | Allowed  
Apple Pay | Not Applicable | Allowed


# WS2 Group
WS2 group refers to member belongs to `PCI_Workstation_2` group in UHC Secure
  * PCI Workstation typically refers to a workstation computer that is equipped with PCI (Peripheral Component Interconnect) expansion slots.
  * Only Agents with WS2 group access can perform on-screen-entry for adding/making payment through cards




# Sale Transactions
Sale transactions refer to payment transactions in which a customer purchases goods or services and completes the payment at the time of the transaction. In a sale transaction, the payment is immediately processed, and the funds are transferred from the customer's account to the merchant's account in exchange for the products or services rendered. Sale transactions are straightforward and common in retail settings, online shopping, and various other industries where immediate payment is required for the completion of a purchase.
## Handling Sale Transactions[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/sale-transactions/#handling-sale-transactions "Direct link to Handling Sale Transactions")


# Manufacturer Card
A manufacturer's card is a type of credit card that is issued by a specific retailer or manufacturer. These cards are typically co-branded with a financial institution and can only be used for purchases at that particular retailer or a group of affiliated stores.
Manufacturer's cards often come with special promotions, discounts, or financing options to incentivize customers to make purchases with the retailer. These offers may include discounts on initial purchases, promotional financing with deferred interest, rewards points, or exclusive access to sales and events.
## Managing Manufacturer card[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/Card/manufacturer-card/#managing-manufacturer-card "Direct link to Managing Manufacturer card")
Action | Allowed User  
---|---  
Add | Agent  
Flag | Agent  
Edit | Agent, Customer  
Delete | Agent, Customer


# Payment Modes
CCG allows following payment modes
  * Pay with Wallet
  * One Time Pay
  * Pay and Save


## Pay with Wallet[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Payment-modes/#pay-with-wallet "Direct link to Pay with Wallet")
Pay with Wallet refers to making a payment using a digital wallet or mobile wallet application. A digital wallet is a virtual wallet that allows users to securely store payment information, such as credit/debit card details, bank account information, and other payment methods, on a mobile device or online platform.
## One Time Pay[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Payment-modes/#one-time-pay "Direct link to One Time Pay")
One-time payment refers to a single payment made by the payer to resolve a debt, acquire goods or services, or meet a financial obligation. In contrast to recurring payments or subscriptions, a one-time payment does not entail continuous charges or automatic withdrawals from the payer's account. This payment method enables the payer to make a solitary payment for a particular purpose without the requirement for recurring payments or sustained financial obligations
## Pay and Save[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Payment-modes/#pay-and-save "Direct link to Pay and Save")
Pay and Save is crucial for managing subscriptions, installment payments, and recurring expenses, as it involves setting up automatic deductions from the individual's account at regular intervals, such as monthly or annually. By incorporating a savings component, Pay and Save enables individuals to streamline financial management, automate the savings process, and make significant strides towards securing a stable financial future.


# Card
  * Credit card or debit card used for making online or in-person transactions. When a customer chooses to pay with a card through a payment gateway, they are providing their card details for processing the payment securely.


## Key features[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/Card/#key-features "Direct link to Key features")
  * **Payment Processing** : Cards are a common payment method used in payment gateways to facilitate transactions. Customers enter their card information, including the card number, expiration date, and security code, to authorize the payment.
  * **Security** : Payment gateways are designed to encrypt and securely transmit card information to ensure the safety of customer data during transactions. This helps protect against fraud and unauthorized access to sensitive information.
  * **Authorization** : The payment gateway communicates with the card issuer to verify the card details and authorize the transaction. Once the payment is approved, the funds are transferred from the customer's card to the merchant's account.


## Default Card[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/Card/#default-card "Direct link to Default Card")
The default card in a digital wallet is the primary payment method that is automatically selected for transactions when you make a purchase. When you have multiple payment methods stored in your digital wallet, setting a default card allows for quicker and more convenient checkout experiences.
Having a default card means that when you initiate a payment, the digital wallet will automatically use the default card for the transaction unless you manually select a different payment method at the time of purchase. This streamlines the payment process, especially for frequent transactions, as you won't have to choose a payment method each time you make a purchase.
It's important to regularly review and update your default card settings in your digital wallet to ensure that the correct payment method is selected for your transactions and to prevent accidental charges on an unintended card.


# PRE AUTH Transactions
## what is pre-authorization?[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Pre-Auth%20Transactions/#what-is-pre-authorization "Direct link to what is pre-authorization?")
Pre-authorization is the first step in the payment process, where the merchant requests approval from the card issuer to ensure that the customer has sufficient funds or credit available for the transaction. This involves temporarily placing a hold on the customer's account for the pre-authorized amount without immediate fund transfer to the merchant. The pre-authorization hold serves as a temporary reservation of funds and remains active for a specified period, after which it will expire if the transaction is not completed.
**Payments that have been pre-authorized must be processed within 7 days; otherwise, the held amount will be released.**
## Business Scenarios[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Pre-Auth%20Transactions/#business-scenarios "Direct link to Business Scenarios")
Common business scenarios for pre-authorization transactions include:
  * Hotel reservations: Pre-authorizing a guest's credit card for the room rate and potential additional charges before check-in.
  * Car rentals: Pre-authorizing a customer's credit card for the estimated rental cost and any potential damages.
  * Online purchases: Pre-authorizing a customer's card for the purchase amount before shipping the goods.
  * Subscription services: Pre-authorizing recurring payments for subscription services to ensure continuity of service.
  * Travel bookings: Pre-authorizing payments for flights, hotels, and other travel-related services to secure reservations.
  * Retail stores: Pre-authorizing payments for high-value items or during peak shopping seasons to manage inventory and prevent fraud.


## Handling pre-authorization[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Pre-Auth%20Transactions/#handling-pre-authorization "Direct link to Handling pre-authorization")


# Production Release Notes (1-23-2024)
Convenient Checkout Gateway (CCG) Production environment release notes.
## 1-23-2024 (R21)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#1-23-2024-r21 "Direct link to 1-23-2024 \(R21\)")
### ACH Payments - Accept ACH payments with customer’s bank routing/account data[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#ach-payments---accept-ach-payments-with-customers-bank-routingaccount-data "Direct link to ACH Payments - Accept ACH payments with customer’s bank routing/account data")
#### Functionality:[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#functionality "Direct link to Functionality:")
Wallet Widget or API – Save customer’s bank routing/account data to wallet for future payments
Payment Widget or API – Accept ACH payment using existing payment method id or guest checkout
Cancel Payment API – Allows the ability to cancel ACH Payments when status is in-process
Refund API – Perform refund on original ACH using payment id
#### ACH Consent Mandate:[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#ach-consent-mandate "Direct link to ACH Consent Mandate:")
Consent Mandate - Consent is required to process an ACH Payment
Consent Object – Consent Collected Type (WEB, PRD, TEL) is required. Review <https://docs.healthsafepay.com/api-reference> for requirements by type: see Create Session API and Create Payment API
Consent Object Storage: The consent object is sent to CCG and will be shown within the consent box within the widget. CCG will maintain a copy of the consent sent with transaction id, but will not be available within Stripe. CCG recommends the business’s source system store the consent id, consent object, date of consent, and consent details for use when with customer questions or disputes.
Developers: See <https://docs.healthsafepay.com/api-reference> for further details: Create Session API, Create Payment API, Cancel API and Refund API
### Pay and Save Widget – Allow customer to make payment and store card on single page[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#pay-and-save-widget--allow-customer-to-make-payment-and-store-card-on-single-page "Direct link to Pay and Save Widget – Allow customer to make payment and store card on single page")
Payment Widget – Allows customer to store payment method within the 1x payment flow
Create Session API - Use Config Payment_With_Wallet to invoke Pay and Save with Payment Widget
CSR Experience – Pay and Save is enabled for all payment entry options: Text2Pay, Email2Pay, and Manual Card Entry By default, both Save for Future Payments and Default Card selection boxes are unchecked
Developers: See <https://docs.healthsafepay.com/api-reference> for further details: Create Session API>Config options
### Other[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#other "Direct link to Other")
#### Treasury – Below changes have been made to the Combined Payout Report[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#treasury--below-changes-have-been-made-to-the-combined-payout-report "Direct link to Treasury – Below changes have been made to the Combined Payout Report")
  * Remove all Stripe specific identifiers per specification
  * Change the file name per specification
  * Add new fields per specification - separate out
    1. processor (Stripe, as of today in the future we will PayPal, internal, etc)
    2. last 4 of card or bank account number (RX request, technically we can add to their Config to meet their request)
  * Ensure the data format is comma delimited, not pipe delimited


#### Individual Merchant – Below changes have been made to the Combined Payout Report[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#individual-merchant--below-changes-have-been-made-to-the-combined-payout-report "Direct link to Individual Merchant – Below changes have been made to the Combined Payout Report")
  * Remove all Stripe specific identifiers per specification
  * Change the file name per specification
  * Add new fields per specification - separate out
    1. processor (Stripe, as of today in the future we will PayPal, internal, etc)
    2. last 4 of card or bank account number (RX request, technically we can add to their Config to meet their request)
  * Ensure the data format is comma delimited, not pipe delimited


### Bug Fix[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#bug-fix "Direct link to Bug Fix")
  * Create Payment API will no longer process payment when paymentMethodId is present, but it not linked to any customer
  * CCG will no longer require agent.ID when Cashier field is sent as empty string ""
  * Refunds - CCG will send error message when refund is requested on an Uncaptured pre-auth payment
  * CRM Widget/T2A E2A – Waiting message for Text2Add/Email2Add is "Awaiting payment method..."
  * CRM Widget/T2P E2P – Waiting message for Text2Pay/Email2Pay is "Awaiting payment..."
  * T2P - Suppress or Show Back Button on card/ach Payment forms
  * T2P - Show 5 min or less notification Reminder for CARD & ACH of text2pay


### Defect Fix[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/1-23-2024/#defect-fix "Direct link to Defect Fix")
  * List Payment Methods API – Update Card Status to ‘EXPIRED’ for expired cards
  * UI Disclaimer text size fluctuation – Change made so disclaimer text is always 12.64 px
  * UHC Pay After Care – Support both MemberId and GroupNum during enterprise id lookup




# Partial Authorization
## What is Partial authorization?[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Partial-Authorization/#what-is-partial-authorization "Direct link to What is Partial authorization?")
Partial authorization offers a solution for handling transactions when there aren't enough funds in the card's balance to approve the full amount. Issuers can approve a portion of the requested sum, leaving the rest to be paid using other means.
## Common business scenarios where this may occur[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Partial-Authorization/#common-business-scenarios-where-this-may-occur "Direct link to Common business scenarios where this may occur")
Card product where the available balance is less than the requested amount.
  * Example: prepaid card with a balance of $50. Merchant requests authorization for $75. Issuer may either decline the transaction or return a partial authorization where the amount authorized is less than the requested amount, perhaps $50 in this case.


Card product with specific restrictive spending rules.
  * Example: substantiated FSA card where a merchant requests authorization for a $75 purchase, and includes IIAS information showing a healthcare subtotal of $50 and an Rx subtotal of $50 - this customer might be purchasing a $50 prescription and $25 non-medical items. The issuer might return a partial authorization for $50 in this use case.


## Handling partial authorization[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Partial-Authorization/#handling-partial-authorization "Direct link to Handling partial authorization")
When a partial authorization is returned, the merchant needs to choose how to handle it. Merchant options include:
  * Treat the partial authorization as a decline and follow existing declined authorization workflow
  * Split tender - get another payment method to be used for the remaining (unauthorized) balance
  * Adjust transaction - edit the shopping cart (for example, remove items) to build a new transaction and attempt authorization again


## Payment request with partial authorization[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Partial-Authorization/#payment-request-with-partial-authorization "Direct link to Payment request with partial authorization")
Merchants can indicate partial auth, via `partialAuthorization` flag through `/sessions` or `/payments` API(s)
  * sessionRequest.payment.partialAuthorization
  * paymentRequest.partialAuthorization

Sample /sessions request: **partialAuthorization**
```
## /POST sessions request  
curl --location --request POST 'https://api.uhg.com/api/financial/commerce/nonprodcheckout/v1/sessions' \  
--header 'X-Merchant-Id: <x-merchant-id>' \  
--header 'X-Upstream-Env: <x-upstream-env>' \  
--header 'Content-Type: application/json' \  
--header 'Authorization: Bearer <authorization-token>' \  
--data-raw '{  
    "customer": {  
        "firstName": "foo",  
        "lastName": "bar",  
        "email": "foo.bar@email.com",  
        "ssnLastFour": "1234",  
        "dateOfBirth": "1970-31-12",  
        "phoneNumber": {  
            "number": "9876543210",  
            "countryCode": "1"  
        },  
        "zip5": "54321",  
        "hsid": "120c5730-e796-4448-8da9-081fde4e3e79",  
        "metadata": {}  
    },  
    "payment": {  
        "merchantTransactionId": "f32736c8-266a-4da1-af16-293fa02a351a",  
        "amount": 1200,  
        "authorizeCard": true,  
        "partialAuthorization": true  
    }  
}'  

```

Sample /payments request: **partialAuthorization**
```
## /POST payments request  
curl --location -g --request POST 'https://api.uhg.com/api/financial/commerce/nonprodcheckout/v1/payments' \  
--header 'X-Merchant-Id: <x-merchant-id>' \  
--header 'X-Upstream-Env: <x-upstream-env>' \  
--header 'Content-Type: application/json' \  
--header 'Authorization: Bearer <authorization-token>' \  
--data-raw '{  
    "customer":  {  
       "firstName": "foo",  
        "lastName": "bar",  
        "email": "foo.bar@email.com",  
        "ssnLastFour": "1234",  
        "dateOfBirth": "1970-31-12",  
        "phoneNumber": {  
            "number": "9876543210",  
            "countryCode": "1"  
        },  
        "zip5": "54321",  
        "hsid": "120c5730-e796-4448-8da9-081fde4e3e79",  
        "metadata": {}  
    }  
    "merchantTransactionId": "f32736c8-266a-4da1-af16-293fa02a351a",  
    "amount": 1200,  
    "authorizeCard": true,  
    "partialAuthorization": true,  
    "paymentMethodId": "",  
}'  

```

## Payment response with partial authorization[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Partial-Authorization/#payment-response-with-partial-authorization "Direct link to Payment response with partial authorization")
Successful partial auth payment returns response with:
  * `data.payment.amount`: Initial requested amount
  * `data.payment.authorizedAmount`: Amount partially/fully authorized for capture
  * `data.payment.status`: reflects `AUTHORZIED` status


With a valid authorizedAmount, merchant's can proceed to capture the authorizedAmount
Sample /sessions response: partially authorized payment
```
{  
    "data": {  
        "sessionId": "",  
        "status": "COMPLETED",  
        "payment": {  
            "id": "",  
            "amount": 183,  
            "authorizedAmount": 128,  
            "capturedAmount": 0,  
            "description": "",  
            "merchantTransactionId": "",  
            "merchantId": "",  
            "paymentType": "PRE_AUTH",  
            "currencyCode": "usd",  
            "status": "AUTHORIZED",  
            "paymentMethodId": "",  
            "statementDescriptorSuffix": "",  
            "partialAuthorization": true,  
            "metadata": {},  
            "paymentMethod": {},  
            "agent": {}  
        },  
    }  
}  

```

Sample /payments response: partially authorized payment
```
{  
  "data": {  
    "id": "95bec1ab-9762-4fe7-a4cd-fcf92b20d5c5",  
    "amount": 183,  
    "authorizedAmount": 128,  
    "capturedAmount": 0,  
    "description": "",  
    "merchantTransactionId": "",  
    "merchantId": "",  
    "paymentType": "PRE_AUTH",  
    "currencyCode": "usd",  
    "status": "AUTHORIZED",  
    "customerId": "",  
    "vendor": "",  
    "vendorPaymentId": "",  
    "vendorMerchantId": "",  
    "statementDescriptorSuffix": "",  
    "partialAuthorization": true,  
    "metadata": {},  
    "paymentMethod": {}  
  }  
}  

```

## Error Handling[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Partial-Authorization/#error-handling "Direct link to Error Handling")
API Request would error, if incorrect combination of flags are passed.
  * partial auth is applicable only for `PRE_AUTH` (i.e. authorizeCard=`true`) payments involving 'card' payment method type.

paymentMethodChannel Type requested in session | paymentMethodChannel Type configured | authorizeCard | partialAuthorization | create session error response | create payment error response  
---|---|---|---|---|---  
card | card | no | yes | `400 BAD_REQUEST` | `400 BAD_REQUEST`  
(empty) | card | no | yes | `400 BAD_REQUEST` | `400 BAD_REQUEST`  
Invalid partial authorization request error: **400 BAD_REQUEST**
```
{  
    "title": "INVALID_REQUEST",  
    "status": 400,  
    "detail": "Partial authorization not allowed for authorizeCard = false",  
    "errorDetails": null  
}  

```



# Production Release Notes (11-17-2023)
Convenient Checkout Gateway (CCG) Production environment release notes.
## 11-17-2023 (R17)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/11-17-2023/#11-17-2023-r17 "Direct link to 11-17-2023 \(R17\)")
### Duplicate Card Business Rule Update[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/11-17-2023/#duplicate-card-business-rule-update "Direct link to Duplicate Card Business Rule Update")
If duplicate card is added to customer's wallet, then existing card details are updated with the newly provided information. User is shown a message indicating duplicate entry and new/updated information is returned to merchants. As part of this change, merchant receives 2 webhook events via PAYMENT_METHOD_CREATED and PAYMENT_METHOD_UPDATED.
### Manufacturer Card $0 Authorization Update[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/11-17-2023/#manufacturer-card-0-authorization-update "Direct link to Manufacturer Card $0 Authorization Update")
Manufacturer cards will no longer be validated with $0 authorization request to issuer.


# Stage Release Notes (11-30-2023)
Convenient Checkout Gateway (CCG) Non-Production (Stage) environment release notes.
## 11-30-2023 (R18 continued)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-30-2023/#11-30-2023-r18-continued "Direct link to 11-30-2023 \(R18 continued\)")
### Provide Agent Information Details – Agent Assisted Add/Change/Delete[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-30-2023/#provide-agent-information-details--agent-assisted-addchangedelete "Direct link to Provide Agent Information Details – Agent Assisted Add/Change/Delete")
Agent details now available via Webhook and Session Responses.
Where to find details: [API - Create Payment > View Response Details](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createPayment)
### ACH Mandatory Consent Agreement – CCG Widget and CCG API[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-30-2023/#ach-mandatory-consent-agreement--ccg-widget-and-ccg-api "Direct link to ACH Mandatory Consent Agreement – CCG Widget and CCG API")
Merchant **must** send consent object with ACH payment consent text.
CCG will return object within response and webhook for merchant future reference.
Where to find details:
[Widget – Create session for initializing the convenient checkout widget > Review Request Body Schema section](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post)
[API – Create Payment > Review Request Body Schema](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createPayment)
### Notice of Return (NOR) – Invalidate Bank Account Payment Method[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-30-2023/#notice-of-return-nor--invalidate-bank-account-payment-method "Direct link to Notice of Return \(NOR\) – Invalidate Bank Account Payment Method")
Invalidate payment method when bank return response indicates account will not accept ACH requests.
Examples: ‘Not Accepts ACH’, ‘Invalid Account’, ‘Account Closed’, ‘Account Purged’
Payment Methods can not be updated and should be removed from merchant level wallet.
### Notice of Change (NOC) or Account Updater Activities – Update Handling[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-30-2023/#notice-of-change-noc-or-account-updater-activities--update-handling "Direct link to Notice of Change \(NOC\) or Account Updater Activities – Update Handling")
When a change is made to a Payment Method CCG will inform merchants via Webhook.
Refer to the following link for more information:  
<https://docs.healthsafepay.com/docs/developers/special-use-cases/Add-Duplicate-Payment-Method/>


# Stage Release Notes (11-15-2023)
Convenient Checkout Gateway (CCG) Non-Production (Stage) environment release notes.
## 11-15-2023 (R18)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#11-15-2023-r18 "Direct link to 11-15-2023 \(R18\)")
### Capture & Save ACH Payment Method Details – Portal/Mobile[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#capture--save-ach-payment-method-details--portalmobile "Direct link to Capture & Save ACH Payment Method Details – Portal/Mobile")
Add bank account to Payment Method Widget
Where to find details: [API > Merchant > Create Session for Initiating CCG Checkout Widget](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post)
### Capture & Save ACH Payment Method Details – Agent Assisted[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#capture--save-ach-payment-method-details--agent-assisted "Direct link to Capture & Save ACH Payment Method Details – Agent Assisted")
Add bank account to agent assisted Payment Method Widget
Where to find details: [API > Merchant > Create Session for Initiating CCG Checkout Widget](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post)
Refer to payment method object Agent Object
### ACH added to Add Events Webhook[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#ach-added-to-add-events-webhook "Direct link to ACH added to Add Events Webhook")
Where to find details: [Developers > Webhook > Payment Method Created](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/)
### ACH Account Validation[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#ach-account-validation "Direct link to ACH Account Validation")
Account validation will be run on all banks accounts before adding to Wallet or guest payment
### List Payment Method API – ACH Payment Methods[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#list-payment-method-api--ach-payment-methods "Direct link to List Payment Method API – ACH Payment Methods")
Bank Accounts stored within Wallet will be returned in the list of payment methods API
Where to find details: [API Reference > Find Payment Method for Customer](https://docs.healthsafepay.com/api-reference/#tag/Merchant-Wallet-Management/paths/~1payment-methods~1search/post)
### ACH Payment via API[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#ach-payment-via-api "Direct link to ACH Payment via API")
ACH payment via API with Payment Method Id
Where to find details: [API > Create Payment](https://docs.healthsafepay.com/api-reference/#tag/Merchant-PCI/operation/createPaymentWithToken)
### Update ACH Payment Method Id[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#update-ach-payment-method-id "Direct link to Update ACH Payment Method Id")
Update an existing PMI associated with a bank account.
Where to find details: [API > Merchant – Wallet Management > Update Payment Method by Payment Method Id](https://docs.healthsafepay.com/api-reference/#tag/Merchant-Wallet-Management/paths/~1payment-methods~1%7Bpayment-method-id%7D/patch)
### Delete ACH Payment Method Id[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#delete-ach-payment-method-id "Direct link to Delete ACH Payment Method Id")
Delete an existing PMI associated with a bank account.
Where to find details: [API > Merchant – Wallet Management > Delete Payment Method by Payment Method Id](https://docs.healthsafepay.com/api-reference/#tag/Merchant-Wallet-Management/paths/~1payment-methods~1%7Bpayment-method-id%7D/delete)
### ACH Refunds[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#ach-refunds "Direct link to ACH Refunds")
Perform Full, Partial, or Multiple refunds. Total refund for payment cannot exceed the original payment amount.
Where to find details: [API > Merchant > Create Refund](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createRefund)
### NOC (Notice of Change) Webhook Event for ACH[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#noc-notice-of-change-webhook-event-for-ach "Direct link to NOC \(Notice of Change\) Webhook Event for ACH")
ACH changes received from bank will be sent to client via webhook.
Where to find details: [Developers > Webhook](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/)
NOC details will be added soon.
### NOC where Account # Changes[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Stage/11-15-2023/#noc-where-account--changes "Direct link to NOC where Account # Changes")
CCG will create a new Payment Method Id for new bank account, then delete Payment Method Id associated with bank account that was changed (old bank account). There will be 2 events sent when this occurs: Delete, Add
Where to find details: [Developers > Webhook](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/)
NOC details will be added soon.


# Production Release Notes (12-8-2023)
Convenient Checkout Gateway (CCG) Production environment release notes.
## 12-8-2023 (R18)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#12-8-2023-r18 "Direct link to 12-8-2023 \(R18\)")
### Provide Agent Information Details – Agent Assisted Add/Change/Delete[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#provide-agent-information-details--agent-assisted-addchangedelete "Direct link to Provide Agent Information Details – Agent Assisted Add/Change/Delete")
Agent details now available via Webhook and Session Responses.
Where to find details: [API - Create Payment > View Response Details](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createPayment)
### ACH Mandatory Consent Agreement – CCG Widget and CCG API[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#ach-mandatory-consent-agreement--ccg-widget-and-ccg-api "Direct link to ACH Mandatory Consent Agreement – CCG Widget and CCG API")
Merchant **must** send consent object with ACH payment consent text.
CCG will return object within response and webhook for merchant future reference.
Where to find details:
[Widget – Create session for initializing the convenient checkout widget > Review Request Body Schema section](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post)
[API – Create Payment > Review Request Body Schema](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createPayment)
### Notice of Return (NOR) – Invalidate Bank Account Payment Method[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#notice-of-return-nor--invalidate-bank-account-payment-method "Direct link to Notice of Return \(NOR\) – Invalidate Bank Account Payment Method")
Invalidate payment method when bank return response indicates account will not accept ACH requests.
Examples: ‘Not Accepts ACH’, ‘Invalid Account’, ‘Account Closed’, ‘Account Purged’
Payment Methods can not be updated and should be removed from merchant level wallet.
### Capture & Save ACH Payment Method Details – Portal/Mobile[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#capture--save-ach-payment-method-details--portalmobile "Direct link to Capture & Save ACH Payment Method Details – Portal/Mobile")
Add bank account to Payment Method Widget
Where to find details: [API > Merchant > Create Session for Initiating CCG Checkout Widget](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post)
### Capture & Save ACH Payment Method Details – Agent Assisted[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#capture--save-ach-payment-method-details--agent-assisted "Direct link to Capture & Save ACH Payment Method Details – Agent Assisted")
Add bank account to agent assisted Payment Method Widget
Where to find details: [API > Merchant > Create Session for Initiating CCG Checkout Widget](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post)
Refer to payment method object Agent Object
### ACH added to Add Events Webhook[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#ach-added-to-add-events-webhook "Direct link to ACH added to Add Events Webhook")
Where to find details: [Developers > Webhook > Payment Method Created](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/)
### ACH Account Validation[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#ach-account-validation "Direct link to ACH Account Validation")
Account validation will be run on all banks accounts before adding to Wallet or guest payment
### List Payment Method API – ACH Payment Methods[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#list-payment-method-api--ach-payment-methods "Direct link to List Payment Method API – ACH Payment Methods")
Bank Accounts stored within Wallet will be returned in the list of payment methods API
Where to find details: [API Reference > Find Payment Method for Customer](https://docs.healthsafepay.com/api-reference/#tag/Merchant-Wallet-Management/paths/~1payment-methods~1search/post)
### ACH Payment via API[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#ach-payment-via-api "Direct link to ACH Payment via API")
ACH payment via API with Payment Method Id
Where to find details: [API > Create Payment](https://docs.healthsafepay.com/api-reference/#tag/Merchant-PCI/operation/createPaymentWithToken)
### Update ACH Payment Method Id[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#update-ach-payment-method-id "Direct link to Update ACH Payment Method Id")
Update an existing PMI associated with a bank account.
Where to find details: [API > Merchant – Wallet Management > Update Payment Method by Payment Method Id](https://docs.healthsafepay.com/api-reference/#tag/Merchant-Wallet-Management/paths/~1payment-methods~1%7Bpayment-method-id%7D/patch)
### Delete ACH Payment Method Id[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#delete-ach-payment-method-id "Direct link to Delete ACH Payment Method Id")
Delete an existing PMI associated with a bank account.
Where to find details: [API > Merchant – Wallet Management > Delete Payment Method by Payment Method Id](https://docs.healthsafepay.com/api-reference/#tag/Merchant-Wallet-Management/paths/~1payment-methods~1%7Bpayment-method-id%7D/delete)
### ACH Refunds[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#ach-refunds "Direct link to ACH Refunds")
Perform Full, Partial, or Multiple refunds. Total refund for payment cannot exceed the original payment amount.
Where to find details: [API > Merchant > Create Refund](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createRefund)
### NOC (Notice of Change) Webhook Event for ACH[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#noc-notice-of-change-webhook-event-for-ach "Direct link to NOC \(Notice of Change\) Webhook Event for ACH")
ACH changes received from bank will be sent to client via webhook.
Where to find details: [Developers > Webhook](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/)
NOC details will be added soon.
### NOC where Account # Changes[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/12-8-2023/#noc-where-account--changes "Direct link to NOC where Account # Changes")
CCG will create a new Payment Method Id for new bank account, then delete Payment Method Id associated with bank account that was changed (old bank account). There will be 2 events sent when this occurs: Delete, Add
Where to find details: [Developers > Webhook](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/)
NOC details will be added soon.


# Production Release Notes (4-12-2024)
Convenient Checkout Gateway (CCG) Production environment release notes.
## 4-12-2024 (R25)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#4-12-2024-r25 "Direct link to 4-12-2024 \(R25\)")
### New NPM Version = 2.9.0 (includes 3DS functionality)[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#new-npm-version--290-includes-3ds-functionality "Direct link to New NPM Version = 2.9.0 \(includes 3DS functionality\)")
### New Wallet Widget Functionality – Mode = Wallet (new) – ACH/CC[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#new-wallet-widget-functionality--mode--wallet-new--achcc "Direct link to New Wallet Widget Functionality – Mode = Wallet \(new\) – ACH/CC")
Merchant can manage customer/member wallet independently from making a payment. Member/Customer can: Add PM, Edit PM, Delete PM
### Payment Response –Network Decline and Advice Code to Error Response[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#payment-response-network-decline-and-advice-code-to-error-response "Direct link to Payment Response –Network Decline and Advice Code to Error Response")
All CC session and web response – Network decline code and Advice code will now appear within payment response when decline has occurred. Codes will be found within the Error Object: networkAdviceCode, networkDeclineCode
### ACH/CC – Payment Widget/Payment Mode – Pay w/o Option to Save Payment Method[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#achcc--payment-widgetpayment-mode--pay-wo-option-to-save-payment-method "Direct link to ACH/CC – Payment Widget/Payment Mode – Pay w/o Option to Save Payment Method")
Save Payment Method within Payment Widget is now configurable for authenticated customers. Within Create Session API >Options > ‘saveDisabled’=true will hide save payment checkbox from Widget
### ACH/CC – Add Payment Method – Wallet Widget/Add or Edit Payment Method Mode[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#achcc--add-payment-method--wallet-widgetadd-or-edit-payment-method-mode "Direct link to ACH/CC – Add Payment Method – Wallet Widget/Add or Edit Payment Method Mode")
Additional alerts added to results shown to after customer adds or edits payment method. Alert will inform customer when they have added or edited a payment method successfully or if it has failed.
### ACH – PCI Merchant API Add Payment Method Object – IVR Channel[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#ach--pci-merchant-api-add-payment-method-object--ivr-channel "Direct link to ACH – PCI Merchant API Add Payment Method Object – IVR Channel")
Provides ability to add payment method via API Payment Method API PCI Merchant > Create Payment Method
### ACH/CC – Payment Webhooks – All Channels[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#achcc--payment-webhooks--all-channels "Direct link to ACH/CC – Payment Webhooks – All Channels")
Payment Method has been added to all Payment Webhook Events, when transaction was accepted or approved. Failed payments will be added in a future release.
### CC – 3D Secure (3DS) Support – Add Payment Method & Payment Widgets – On-line Payments Only[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#cc--3d-secure-3ds-support--add-payment-method--payment-widgets--on-line-payments-only "Direct link to CC – 3D Secure \(3DS\) Support – Add Payment Method & Payment Widgets – On-line Payments Only")
CCG supports 3DS that provides an additional layer of authentication by asking the customer to verify their identity with the card issuer. To complete an on-line payment or add card to wallet, the cardholder is asked by the issuer to provide proof of identity by entering a unique password, an SMS code, or a temporary PIN. If customer fails to verify their identity, CCG will show a message to the customer that the add payment method request failed or their payment will decline.
### CC – Payment Widget Support 3DS Auth –Payment Mode – CC[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#cc--payment-widget-support-3ds-auth-payment-mode--cc "Direct link to CC – Payment Widget Support 3DS Auth –Payment Mode – CC")
Available only with self-service (online) and Text2Pay/Email2Pay (agent assist) payments with payment widget.
### CC – Payment Method Widget Support 3DS Auth – Add Mode – CC[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#cc--payment-method-widget-support-3ds-auth--add-mode--cc "Direct link to CC – Payment Method Widget Support 3DS Auth – Add Mode – CC")
Available only with self-service (online) and Text2Pay/Email2Pay (agent assist) add payment method widget.
### SessionId Enhancement[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#sessionid-enhancement "Direct link to SessionId Enhancement")
Session Request Failure – Create Session API When session request fails, an error will be returned. No sessionId will be created or returned.
### Treasury Combined Payout Report[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#treasury-combined-payout-report "Direct link to Treasury Combined Payout Report")
Enhance Header Output – Treasury Report Request Quotation marks added to each header record object
### ADA Compliance[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#ada-compliance "Direct link to ADA Compliance")
Required Improvements Completed
### Data Security Compliance[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#data-security-compliance "Direct link to Data Security Compliance")
Vulnerability Remediations Completed
### 3D Secure Detailed Notes[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#3d-secure-detailed-notes "Direct link to 3D Secure Detailed Notes")
CCG will start supporting 3DS authorisation for cards under the following conditions
  * Involves use of CCG UI widget
  * Involves user interaction
  * Not applicable for: Agent interaction, API interaction


#### Supported UI Versions[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#supported-ui-versions "Direct link to Supported UI Versions")
Integration pattern | 3DS Support  
---|---  
Hosted | ✅  
Embedded | ✅ (only with versions >= 2.9.0)  
**Note:** For Embedded version <2.9.0, adding or making payment with 3DS card would fail
#### Applicable payment method types[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#applicable-payment-method-types "Direct link to Applicable payment method types")
Payment Method Type | Use case | 3DS auth applicable  
---|---|---  
CARD |  `Adding a payment method`, `Making a payment` | ✅  
BANK_ACCOUNT |  `Adding a payment method`, `Making a payment` | ❌  
#### 3DS 'Add Payment Method' with CCG UI Widget[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#3ds-add-payment-method-with-ccg-ui-widget "Direct link to 3DS 'Add Payment Method' with CCG UI Widget")
Actor | Is Manufacturer Card | UI Mode(s) | Child Mode(s) | 3DS card added | 3DS Authorisation  
---|---|---|---|---|---  
User | NA |  `PAYMENT_WITH_WALLET`, `PAYMENT_METHOD_ENTRY`, `WALLET` |  `TEXT_2_ADD`, `EMAIL_2_ADD` | ✅ | Applied  
Agent | NO |  `PAYMENT_WITH_WALLET`, `PAYMENT_METHOD_ENTRY`, `WALLET` | NA | ✅ | Skipped  
Agent | YES |  `PAYMENT_WITH_WALLET`, `PAYMENT_METHOD_ENTRY`, `WALLET` | NA | ❌ | Failed due to technical restrictions  
User | NA |  `PAYMENT`(PayAndSave) | NA | ❌ | Failed due to technical restrictions  
Agent | ANY |  `PAYMENT`(PayAndSave) | NA | ❌ | Failed due to technical restrictions  
#### 3DS 'Add Payment Method' with API[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#3ds-add-payment-method-with-api "Direct link to 3DS 'Add Payment Method' with API")
Actor | Is Manufacturer Card | 3DS card added | 3DS Authorisation  
---|---|---|---  
User | NA | ✅ | Skipped  
Agent |  |  | NA  
**Note:** For 3DS card that was successfully added with (or) without 3DS authorisation, Issuing bank might re-request for 3DS authorisation during payment
#### 3DS 'Payment' with CCG UI Widget[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#3ds-payment-with-ccg-ui-widget "Direct link to 3DS 'Payment' with CCG UI Widget")
Actor | Is Manufacturer Card | UI Mode(s) | Child Mode(s) | 3DS card payment | 3DS Authorisation  
---|---|---|---|---|---  
User | NA |  `PAYMENT_WITH_WALLET`, `PAYMENT`(OneTimePay/PayAndSave) |  `TEXT_2_PAY`, `EMAIL_2_PAY` | ✅ | Applied  
Agent | ANY |  `PAYMENT_WITH_WALLET`, `PAYMENT`(OneTimePay/PayAndSave) | NA | ❌ | Failed due to non-user interaction  
#### 3DS 'Payment' with API[​](https://docs.healthsafepay.com/docs/developers/Release-notes/Production/4-12-2024/#3ds-payment-with-api "Direct link to 3DS 'Payment' with API")
Actor | Is Manufacturer Card | 3DS card payment | 3DS Authorisation  
---|---|---|---  
User | NA | ❌ | Failed due to non-user interaction  
Agent | ANY | ❌ | Failed due to non-user interaction


# Unusual Payment Failures
### 500 Internal Server Error during Get Payment by (PaymentId/Merchant Transaction id):[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Unusual%20payments%20failiure/#500-internal-server-error-during-get-payment-by-paymentidmerchant-transaction-id "Direct link to 500 Internal Server Error during Get Payment by \(PaymentId/Merchant Transaction id\):")
If you receive a 500 Internal Server Error on your first GET request when polling for payment status, this indicates a non-recoverable issue. Please do not continue polling for this payment, as the error will not resolve with further attempts.


# Retry Mechanisms
The retry functionality is implemented to permit up to 5 attempts when a user encounters a failure during payment or payment method entry validation.
### What is Retry Logic?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#what-is-retry-logic "Direct link to What is Retry Logic?")
A retry mechanism is a strategy designed to allow users to retry failed operations, aiming to recover from errors or failures. This mechanism ensures the system continues to operate smoothly by pausing and allowing retry operations for a fixed number of times, such as 5.
In the CCG widget, the retry mechanism is implemented to handle different session modes, specifically for `PAYMENT`, `PAYMENT_METHOD_ENTRY`, and `PAYMENT_WITH_WALLET` modes. The behavior varies based on the mode:
  * _**For`PAYMENT` and `PAYMENT_METHOD_ENTRY` modes**_, after all retry attempts are exhausted, the session becomes invalidated, and a dead-end screen is displayed to the user. This indicates that the user has reached the maximum number of allowed attempts without successfully completing the payment or payment method entry process.
    * `PAYMENT` mode:
![PAYMENT mode](https://docs.healthsafepay.com/img/payment_retry_dead_end_screen.PNG)
    * `PAYMENT_METHOD_ENTRY` mode:
![PAYMENT_METHOD_ENTRY mode](https://docs.healthsafepay.com/img/payment_method_entry_dead_end_screen.PNG)
  * _**In contrast, for the`PAYMENT_WITH_WALLET` mode**_, upon exhausting all retry attempts, the retry count is reset, and the user is redirected back to the wallet screen. A warning message is displayed to inform the user about the need to add payment method details again. Unlike the previous modes, the session in this case is not invalidated, allowing the user to attempt the payment process again.
![PAYMENT_WITH_WALLET mode](https://docs.healthsafepay.com/img/payment_with_wallet_retry_warning.PNG)


This detailed explanation outlines the specific behaviors and outcomes associated with the retry mechanism in the CCG widget across different session modes, ensuring a clear understanding of how the system responds to various user actions and attempts.
### Retry Logic for Making Payment[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#retry-logic-for-making-payment "Direct link to Retry Logic for Making Payment")
This feature allows users to retry payment attempts after initial failures, addressing issues like declined cards. It includes:
  * **Initial Processing:** Validation of payment and payment method details.
  * **Retry Logic:**
    * **Retry Attempts:** Up to **5 attempts** to correct errors.
    * **Error Messages:** Guides users in fixing errors.
    * **Timeouts:** Prevents abuse and delays.
    * **User Experience:** Ensures a smooth process with **dead-end error screen** in the hosted experience and same is shown momentarily for embedded modal experience. However, in the embedded inline experience, a dead-end screen is not displayed.
    * **Security:** Protects sensitive data and prevents fraud.
    * **Final Actions:** Notifies users of failure. Webhook event `PAYMENT_FAILED` is triggered for the failed **last payment attempt** for `CARD` payment method and for **each failed attempt** for `BANK_ACCOUNT` payment method. Below are the sample webhook event responses for each type:
Sample PAYMENT_FAILED Webhook Event Response: **CARD**
```
{  
  "id": "XXXX-XXXX-XXXX-XXXX",  
  "searchId": "XXXX-XXXX-XXXX-XXXX",  
  "payload": {  
    "id": "XXXX-XXXX-XXXX-XXXX",  
    "error": {  
      "code": "card_declined",  
      "description": "Payment method could not be authorized. Please try a different payment method.",  
      "errorDetails": {  
        "code": "card_declined",  
        "message": "Your card was declined.",  
        "declineCode": "generic_decline"  
      }  
    },  
    "amount": 100,  
    "merchantId": "XXXX-XXXX-XXXX-XXXX",  
    "description": "UI widget payment",  
    "paymentMethod": {  
      "card": {  
        "last4": "0002",  
        "zipCode": "76575",  
        "cardBrand": "VISA",  
        "expiryYear": 2029,  
        "nameOnCard": "TEST",  
        "expiryMonth": 10,  
        "manufacturerCard": false  
      },  
      "error": {  
        "code": "card_declined",  
        "description": "Payment method could not be authorized. Please try a different payment method.",  
        "errorDetails": {  
          "code": "card_declined",  
          "message": "Your card was declined.",  
          "declineCode": "generic_decline"  
        }  
      },  
      "default": false,  
      "nickname": "",  
      "paymentMethodType": "CARD",  
      "paymentMethodDetails": {  
        "type": "CARD",  
        "last4": "0002",  
        "zipCode": "76575",  
        "cardBrand": "VISA",  
        "expiryYear": 2029,  
        "nameOnCard": "TEST",  
        "expiryMonth": 10,  
        "manufacturerCard": false  
      }  
    },  
    "paymentDateUtc": "2024-03-22T07:35:54.144051",  
    "merchantTransactionId": "XXXX-XXXX-XXXX-XXXX"  
  },  
  "token": "Bearer XXX",  
  "eventType": "PAYMENT_FAILED",  
  "message": "Payment Event",  
  "source": null,  
  "sourceMerchant": null  
}  

```

Sample PAYMENT_FAILED Webhook Event Response: **BANK_ACCOUNT**
```
{  
  "id": "XXXX-XXXX-XXXX-XXXX",  
  "searchId": "XXXX-XXXX-XXXX-XXXX",  
  "payload": {  
    "id": "XXXX-XXXX-XXXX-XXXX",  
    "error": {  
      "code": "avs_verification_failure",  
      "description": "We were unable to validate the bank details you provided using information from Early Warning (EWS), a consumer reporting agency. Please try another payment method or call the Number on the back of your member card for help. EWS does not direct our decisions and cannot explain why a decision made, but you have the right to contact EWS, obtain free information on your account and dispute such information within 60 days at: <br /><br /> Early Warning Services, LLC <br /> Attn: Consumer Services <br /> Address: 16552 N. 90th Street, Scottsdale, AZ 85260 <br /> Phone Number: (800) 745-4210 <br /><br /> https://www.earlywarning.com/consumer-information"  
    },  
    "amount": 100,  
    "consent": {  
      "collectionDetails": {  
        "web": {  
          "ipAddress": "X.X.X.X",  
          "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0"  
        },  
        "type": "WEB"  
      },  
      "merchantConsentId": "XXXX-XXXX-XXXX-XXXX",  
      "collectionTimestamp": "2024-03-22T09:59:07.716Z",  
      "merchantConsentText": "TEST"  
    },  
    "merchantId": "XXXX-XXXX-XXXX-XXXX",  
    "description": "UI widget payment",  
    "paymentMethod": {  
      "error": {  
        "code": "avs_verification_failure",  
        "description": "We were unable to validate the bank details you provided using information from Early Warning (EWS), a consumer reporting agency. Please try another payment method or call the Number on the back of your member card for help. EWS does not direct our decisions and cannot explain why a decision made, but you have the right to contact EWS, obtain free information on your account and dispute such information within 60 days at: <br /><br /> Early Warning Services, LLC <br /> Attn: Consumer Services <br /> Address: 16552 N. 90th Street, Scottsdale, AZ 85260 <br /> Phone Number: (800) 745-4210 <br /><br /> https://www.earlywarning.com/consumer-information"  
      },  
      "default": false,  
      "nickname": "",  
      "paymentMethodType": "BANK_ACCOUNT",  
      "paymentMethodDetails": {  
        "type": "BANK_ACCOUNT",  
        "last4": "6575",  
        "accountType": "checking",  
        "nameOnAccount": "TEST",  
        "routingNumber": "100000000",  
        "accountHolderType": "individual"  
      }  
    },  
    "paymentDateUtc": "2024-03-22T09:59:09.757785",  
    "merchantTransactionId": "XXXX-XXXX-XXXX-XXXX"  
  },  
  "token": "Bearer XXX",  
  "eventType": "PAYMENT_FAILED",  
  "message": "Payment Event",  
  "source": null,  
  "sourceMerchant": null  
}  

```



### Retry Logic for Adding Payment Method[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#retry-logic-for-adding-payment-method "Direct link to Retry Logic for Adding Payment Method")
Similar to payment processing, this feature allows users to retry entering payment method details after failures, addressing issues like incorrect card details. It includes the same stages as above, ensuring a user-friendly and secure process.
### Settings and Behaviors of Retry Logic[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#settings-and-behaviors-of-retry-logic "Direct link to Settings and Behaviors of Retry Logic")
#### This table outlines various settings and behaviors related to retry logic, including retry rules configuration, and system settings for retry logic.[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#this-table-outlines-various-settings-and-behaviors-related-to-retry-logic-including-retry-rules-configuration-and-system-settings-for-retry-logic "Direct link to This table outlines various settings and behaviors related to retry logic, including retry rules configuration, and system settings for retry logic.")
| Input Validation Errors | Business Rules Validation Errors | Errors from Stripe  
---|---|---|---  
Is it counted as retriable error for cards? | No | NA | Yes  
Is it counted as retriable error for ACH? | No | Yes | No  
Is webhook response sent for ACH on failure attempts (less than max count 5)? | No | Yes | No  
Is webhook response sent for ACH for final retry attempt i.e., equal to max count 5? | No | Yes | No  
Is webhook response sent for CARD on failure attempts (less than max count 5)? | No | No | No  
Is webhook response sent for CARD for final retry attempt i.e., equal to max count 5? | No | No | Yes  
##### NOTE:[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#note "Direct link to NOTE:")
  * What is `retriable error`? Retriable errors are _**errors that can be resolved by the user**_ , such as entering the correct details, trying a different payment method. Most of the time. these errors are not system-related and can be fixed by the user.
  * What is `input validation error`? Input validation errors are _**errors that occur when the user enters incorrect details**_ , such as incorrect card details, incorrect bank account details, etc.
    * Example: If the user enters the wrong card number, the system will throw an input validation error like 'Your card number is invalid.'.
  * What is `business rules validation error`? Business rules validation errors are _**errors that occur when the user enters correct details but the system cannot validate them**_.
    * Example: If the user enters the incorrect routing number for the bank account, the system will throw a business rules validation error like early warning service error.
Early Warning Error for Bank Account
```
    {  
        "title": "PAYMENT_METHOD_ERROR",  
        "status": 406,  
        "detail": "We were unable to validate the bank details you provided using information from Early Warning (EWS), a consumer reporting agency. Please try another payment method or call the Number on the back of your member card for help. EWS does not direct our decisions and cannot explain why a decision made, but you have the right to contact EWS, obtain free information on your account and dispute such information within 60 days at: <br /><br /> Early Warning Services, LLC <br /> Attn: Consumer Services <br /> Address: 16552 N. 90th Street, Scottsdale, AZ 85260 <br /> Phone Number: (800) 745-4210 <br /><br /> https://www.earlywarning.com/consumer-information",  
        "errorDetails": null  
    }  

```

  * What is `Stripe error`? Stripe errors are _**errors that occur when the system cannot process the payment method details**_ , such as card declined, bank account declined.
    * Example: If the user enters the correct card details but the card is declined, the system will throw a stripe error like 'Your card was declined.'.
Stripe Error for Declined Card
```
    {  
        "title": "PAYMENT_METHOD_ERROR",  
        "status": 406,  
        "detail": "Payment method could not be authorized. Please try a different payment method.",  
        "errorDetails": {  
            "code": "card_declined",  
            "message": "Your card was declined.",  
            "declineCode": "generic_decline",  
            "networkAdviceCode": null,  
            "networkDeclineCode": null  
      }  
    }  

```



#### This table outlines the retry rules configuration for different session modes.[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#this-table-outlines-the-retry-rules-configuration-for-different-session-modes "Direct link to This table outlines the retry rules configuration for different session modes.")
* Note: For ACH, the webhook is sent for failure attempts only if the error is a business rules validation error for ACH.  Session Mode | Payment Method | Is webhook Sent for Failure Attempt? | Is Webhook Sent for Final Attempt? | Is Session Invalidated? | Is Dead-end Error Screen Shown After Failed Final Attempt? | Is Wallet Screen Shown After Failed Final Attempt?  
---|---|---|---|---|---|---  
PAYMENT | Card | No | Yes | Yes | Yes | NA  
PAYMENT | ACH | Yes* | Yes | Yes | Yes | NA  
PAYMENT_WITH_WALLET (Add payment method) | Card | No | No | No | No | Yes  
PAYMENT_WITH_WALLET (Make payment) | Card | No | Yes | Yes | Yes | No  
PAYMENT_WITH_WALLET (Add payment method) | ACH | No | No | No | No | Yes  
PAYMENT_WITH_WALLET (Make payment) | ACH | NA | NA | NA | NA | NA  
PAYMENT_METHOD_ENTRY | Card | No | No | Yes | Yes | NA  
PAYMENT_METHOD_ENTRY | ACH | No | No | Yes | Yes | NA  
### Conclusion[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#conclusion "Direct link to Conclusion")
Implementing smart retry logic for both payment and payment method entry enhances user experience and transaction success. It reduces abandoned transactions and builds user trust by providing clear guidance and support.


# Payments
### OneTimePay or PayAndStore: vendorPaymentMethodId[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/payments/#onetimepay-or-payandstore-vendorpaymentmethodid "Direct link to OneTimePay or PayAndStore: vendorPaymentMethodId")
  * OneTimePay or PayAndStore operations require providing `paymentMethod.vendorPaymentMethodId` in the request payload for 'Merchant - PCI' scope based payments
  * A new vendorPaymentMethodId is needed for each payment attempt. Once used, it's marked as consumed, regardless of the transaction outcome.
  * Refer [Create Payment API Spec](https://docs.healthsafepay.com/api-reference/#tag/Merchant-PCI/operation/createPaymentWithToken) for req/res payload




# Payment Method Replaced
### Scenario[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Replace-Payment-Method/#scenario "Direct link to Scenario")
Consider the following the scenario when a payment method is replaced
  1. User Adds a card **A** ending with 1234.
  2. Card **A** is expired and user got a new card **B** ending with 5678.
  3. User Adds the new card **B** ending with 5678.
  4. CCG got the event from Vendor saying card **A** is updated with card **B**


In the above case, the card **A** is considered as duplicate.
**NOTE:** The above is just a example scenario for a CARD, it can happen to any of the payment method types.
### What happens to the Duplicate card **A**?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Replace-Payment-Method/#what-happens-to-the-duplicate-card-a "Direct link to what-happens-to-the-duplicate-card-a")
CCG deletes the card **A** from the wallet and sends [**PAYMENT_METHOD_DELETED**](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/) event to merchants.
### How merchants knows card **A** is replaced with card **B**?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payment%20Methods/Replace-Payment-Method/#how-merchants-knows-card-a-is-replaced-with-card-b "Direct link to how-merchants-knows-card-a-is-replaced-with-card-b")
CCG sends a [**PAYMENT_METHOD_REPLACED**](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/Payment%20Methods/) event to the merchants.
Sample event structure is given below.
```
{  
    "name": "PAYMENT_METHOD_REPLACED",  
    "payload": {  
        "paymentMethod": { // Payment Method information of CARD B   
            "id": "497f6eca-6276-4993-bfeb-53cbbbba6f08",  
            "card": {  
                "last4": "string",  
                "type" : "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
             "paymentMethodDetails": {  
                "last4": "string",  
                "type" : "CARD",  
                "status": "ACTIVE",  
                "cardBrand": "VISA",  
                "expiryYear": 0,  
                "nameOnCard": "string",  
                "expiryMonth": 0,  
                "zipCode": "string",  
                "manufacturerCard": false  
            },  
            "default": true,  
            "paymentMethodType": "CARD",  
            "nickname": "string"  
        },  
        "customer": {  
            "enterpriseId": "enterprise id",  
            "hsid": "hsid",  
            "dateOfBirth": "dob",  
            "metadata": {  
                "patientId": "rx-patient-id"  
            }  
        },  
        "agent": {  
            "firstName": "First Name",  
            "lastName": "Last Name",  
            "userId": "msId",  
            "isAccessVerified": true  
        },  
        "deletedPaymentMethodId": "597f6eca-6276-4993-bfeb-53cbbbba6f12" // CCG Payment Method ID of CARD A   
    }  
}  

```



# delete payment method


# set-up-payment-method


# error_codes


# update payment method


# find payment methods


# Agent assisted payments


# One time pay


# error_codes


# Pay and Save


# Refunds


# Pay with Wallet
###  [1. Create Session](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#1-create-session "Direct link to 1-create-session")
Create session for Initializing the convenient Checkout Widget. Returns a session ID
###  [2. Load Embedded Widget](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#2-load-embedded-widget "Direct link to 2-load-embedded-widget")
Utilize the session ID returned from Create Session API (Step 1) to load the embedded widget and perform the desired payment option. This will return Merchant Transaction ID and Payment ID to track the transaction.
### Get Payment Status[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#get-payment-status "Direct link to Get Payment Status")
A payment status can be retrieved in two ways.  
**[3. Get Payment Status by Merchant Transaction ID](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/getPaymentByMerchantTransactionId)** Get status for payment using the Merchant Transaction ID returned by Widget in step 2
**[4. Get Payment Status by Payment ID](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/getPayment)** Get status for payment using the Payment ID returned by Widget in step 2
###  [Get Customer Payment Methods](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/getPaymentIntent)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#get-customer-payment-methods "Direct link to get-customer-payment-methods")
Gets all the payment method for a given existing customer
###  [Create Payment](https://docs.healthsafepay.com/api-reference/#tag/payment-controller/operation/createPaymentIntent)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#create-payment "Direct link to create-payment")
Creates a payment request. The payment request may be attempted to be confirmed automatically by setting autoConfirm to true. Default is false
###  [Capture Amount by Payment ID](https://docs.healthsafepay.com/api-reference/#tag/payment-controller/operation/createPaymentIntent)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#capture-amount-by-payment-id "Direct link to capture-amount-by-payment-id")
Creates a payment request. The payment request may be attempted to be confirmed automatically by setting autoConfirm to true. Default is false


# poll get sessions


# Session Error Codes
### 1. Partial authorization not allowed for authorizeCard = false[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#1-partial-authorization-not-allowed-for-authorizecard--false "Direct link to 1. Partial authorization not allowed for authorizeCard = false")
##### Sample Request:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#sample-request "Direct link to Sample Request:")
Partial Auth Request 
```
{  
  "payment":{  
      "partialAuth":true,  
      "authorizeCard": false  
  }  
 }  

```

##### Sample Response:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#sample-response "Direct link to Sample Response:")
Partial Auth Failed Response 
```
{  
  "title": "INVALID_REQUEST",  
  "status": 400,  
  "detail": "Partial authorization not allowed for authorizeCard = false",  
  "errorDetails": null  
 }  

```

#### 2. WS2 Verification Failure:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#2-ws2-verification-failure "Direct link to 2. WS2 Verification Failure:")
During the session creation process, a WS2 check is conducted to verify agent information, such as MSID. If this check fails, the session is invalidated, leading to a BAD REQUEST response.
##### Sample Response:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#sample-response-1 "Direct link to Sample Response:")
WS2 Check Failed Response 
```
{  
  "title": "INVALID_REQUEST",  
  "status": 400,  
  "detail": "Card WS2 check has failed.",  
  "errorDetails": null  
 }  

```

#### 3.Payment Method Configuration Not Found:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#3payment-method-configuration-not-found "Direct link to 3.Payment Method Configuration Not Found:")
A session is invalidated during its creation phase if the payment method type is either not configured for the merchant or if it is not correctly specified in the session request.
##### Sample Response:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#sample-response-2 "Direct link to Sample Response:")
Missing Payment Method Type Configuration Response 
```
{  
  "title": "INVALID_REQUEST",  
  "status": 400,  
  "detail": "Payment method type is not configured.",  
  "errorDetails": null  
}  

```

#### 4. Unavailability of Payment Methods for Capture:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#4-unavailability-of-payment-methods-for-capture "Direct link to 4. Unavailability of Payment Methods for Capture:")
A session becomes invalid if the channels available for the configured payment methods are absent. This absence could be due to either a lack of configuration at the merchant level or an invalid session request.
##### Applicable Session Modes:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#applicable-session-modes "Direct link to Applicable Session Modes:")
`PAYMENT_METHOD_ENTRY`, `PAYMENT`
##### Sample Response:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#sample-response-3 "Direct link to Sample Response:")
Missing Payment Method Channels Response 
```
{  
  "title": "INVALID_REQUEST",  
  "status": 400,  
  "detail": "You have no capture methods available.",  
  "errorDetails": null  
}  

```

#### 5. Absence of Consent in Payment Request Leads to Failure:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#5-absence-of-consent-in-payment-request-leads-to-failure "Direct link to 5. Absence of Consent in Payment Request Leads to Failure:")
Payment requests are validated against the consent object, and if the consent is not found within the request, the payment request will be invalidated.
If an invalid Consent text is provided, the session will fail with an invalid request. Below special characters are not allowed in the consent text:
**`[  ]  {  }  +  =  *  ^  %  #  ~  `   <  >  ?  |  \`**
##### Applicable Session Modes:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#applicable-session-modes-1 "Direct link to Applicable Session Modes:")
`PAYMENT`
##### Sample Response:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/sessions/error_codes/#sample-response-4 "Direct link to Sample Response:")
Payment Failed Response When Consent Not Found 
```
{  
  "title": "INVALID_REQUEST",  
  "status": 400,  
  "detail": "Consent is required!",  
  "errorDetails": null  
 }  

```

Session Failed Response When Consent text not valid 
```
{  
    "title": "INVALID_REQUEST",  
    "status": 400,  
    "detail": "Consent is invalid",  
    "errorDetails": null  
}  

```



# Create Payment API
This section provides a detailed overview of the payment API, which is an essential component of the Convenient Checkout API. The payment API is responsible for processing payments and managing the payment lifecycle.
## Payment API Overview[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/payment-api/#payment-api-overview "Direct link to Payment API Overview")
The payment API is a RESTful API that enables merchants to process payments and manage the payment lifecycle. The API provides endpoints for `creating payments`, `confirming payment`, `capturing partial or full amount`, `retrieving payment details`, and `cancelling payments`.
The payment API is designed to be flexible and extensible, allowing merchants to integrate it with their existing systems and workflows. The API supports various payment methods, including Credit cards, HSA cards, ACH, Apple Pay and Google Pay.
## Payment API Integration[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/payment-api/#payment-api-integration "Direct link to Payment API Integration")
The payment API integration involves integrating the payment API into the merchant's website or application to process payments and manage the payment lifecycle. The integration includes creating payments, retrieving payment details, and updating payment status.
The payment API integration follows these steps:
  1. **Create Payment** : The merchant sends a payment request to create a new payment. The request includes the payment amount, customer details, and payment method details.
  2. **Get Payment** : The merchant sends a payment request to retrieve payment details based on the payment ID or merchant transaction ID. The response includes the captured payment amount, payment method details, and payment status.
  3. **Confirm Payment** : The merchant sends a payment request to confirm a payment. The request includes the payment ID and the confirmation amount.
  4. **Cancel Payment** : The merchant sends a payment request to cancel a payment. The request includes the payment ID.
  5. **Refund Payment** : The merchant sends a payment request to refund a payment. The request includes the payment ID and the refund amount.
  6. **Capture Payment** : The merchant sends a payment request to capture an authorized payment. The request includes the payment ID and the capture amount.


The payment API integration enables merchants to process payments securely and efficiently, providing a seamless payment experience for their customers.
## Payment Lifecycle[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/payment-api/#payment-lifecycle "Direct link to Payment Lifecycle")
The payment lifecycle is the process of managing payments from creation to completion.
Following diagram illustrates the payment lifecycle:
![Payment Lifecycle](https://docs.healthsafepay.com/img/payment_lifecycle.png)
The payment lifecycle is managed using the payment API endpoints, enabling merchants to process payments securely and efficiently.
## Payment API Endpoints[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/payment-api/#payment-api-endpoints "Direct link to Payment API Endpoints")
The payment API request and response payloads are defined using the JSON format. The request payload includes the payment amount, customer details, agent information, and payment method details. The response payload includes the payment ID, payment status, and payment details. The detailed documentation of the payment API request and response payloads can be found in the [API Documentation](https://docs.healthsafepay.com/api-reference/). The payment API provides the following endpoints:
  * **Create Payment** : ([Link to Create Payment API](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createPayment)) This endpoint is used to create a new payment. The request payload includes the payment amount, customer details, and payment method details. The response contains the payment ID and payment status.
  * **Get Payment by Payment ID** : ([Link to Get Payment API](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/getPayment)) This endpoint is used to retrieve payment details based on the payment ID. The request payload includes the payment ID, and the response contains the payment details.
  * **Get Payment by Merchant Transaction ID** : ([Link to Get Payment API](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/getPaymentByMerchantTransactionId)) This endpoint is used to retrieve payment details based on the merchant transaction ID. The request payload includes the merchant transaction ID, and the response contains the payment details. _Merchant transaction ID can be retrieved from the response of get session or checkout session API_.
  * **Confirm Payment by Payment ID** : This endpoint is used to confirm a payment. The request payload includes the payment ID and the confirmation amount.
  * **Capture Full or Partial Payment** : ([Link to Capture Payment API](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/capturePayment)) This endpoint is used to capture a full or partial payment amount. The request payload includes the payment ID and the capture amount.
  * **Cancel Payment by Payment ID** : ( [Link to Cancel Payment API](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/cancelPayment)) This endpoint is used to cancel a payment. The request payload includes the payment ID.


The payment API endpoints enable merchants to process payments, retrieve payment details, and manage the payment lifecycle effectively.
## How Merchants can use Payment API?[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/payment-api/#how-merchants-can-use-payment-api "Direct link to How Merchants can use Payment API?")
Merchants can use the payment API to process payments either through the Convenient Checkout API for payment or through the CCG widget.
### Applicable Session modes for payments API[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/payment-api/#applicable-session-modes-for-payments-api "Direct link to Applicable Session modes for payments API")
`PAYMENT`, `PAYMENT_WITH_WALLET`
### Steps to use Payment API[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/payment-api/#steps-to-use-payment-api "Direct link to Steps to use Payment API")
  1. **Create Payment API Request** : The merchant needs to create a payment request by providing the payment amount, customer details, and payment method details. The request payload is sent to the payment API endpoint to create a new payment or update existing one. As per API documentation [Create Payment API](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/createPayment), immediately **ACCEPTED (HTTP code 202)** response is sent back which contains the `payment ID` and payment `status`.
  2. **Get Payment API Request** : The merchant can retrieve payment details based on the payment ID or merchant transaction ID. The request payload is sent to the payment API endpoint to retrieve payment details.
  3. **Get Session/Checkout Session API Request** : The merchant can retrieve the session details based on the session ID. The session response contains the payment details.
  4. **Webhook Notification** : The payment API sends webhook notifications to the merchant's server to notify them about the payment status updates. The merchant can use the webhook notifications to update their systems and workflows accordingly. Webhook notifications are sent for both successful and failed payments. Please refer to the [Webhook Notification](https://docs.healthsafepay.com/docs/developers/Add-on-services/Webhooks/) for more details.


#### Note:[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/payment-api/#note "Direct link to Note:")
The merchant can either rely on the webhook notifications or poll the payment API to get the payment status updates. The payment API provides endpoints to retrieve payment details based on the payment ID or merchant transaction ID.
## Conclusion[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/payment-api/#conclusion "Direct link to Conclusion")
This document provided an overview of the payment API, including its endpoints, and steps to use API. The payment API is a critical component of the Convenient Checkout APIs, enabling merchants to process payments and manage the payment lifecycle effectively. By integrating the payment API into their systems, merchants can offer a seamless and secure payment experience to their customers.


# Embedded Experience Containers
## Overview[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#overview "Direct link to Overview")
This documentation outlines the different types of containers supported by our widget and their respective capabilities. The widget can be configured to use either a primary container only or a combination of primary and secondary containers.
## Container Types[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#container-types "Direct link to Container Types")
### Primary Only Containers[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#primary-only-containers "Direct link to Primary Only Containers")
Primary only containers mean that the entire widget usage is done within that primary container.
  * **Types:** `inline`, `modal`, `drawer`


### Primary and Secondary Containers[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#primary-and-secondary-containers "Direct link to Primary and Secondary Containers")
Primary and secondary containers are used when the primary container is `inline`. This configuration allows the primary container to show the initial view of the session, while the secondary container is used for additional actions that are not part of the primary session capability.
  * **Primary Type:** `inline`
  * **Secondary Types:** `modal`, `drawer`


## Widget Capabilities by Container Type[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#widget-capabilities-by-container-type "Direct link to Widget Capabilities by Container Type")
### Primary only[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#primary-only "Direct link to Primary only")
| Inline | Modal | Drawer  
---|---|---|---  
Payment with wallet | ✅ | ✅ | ✅  
Payment | ✅ | ✅ | ✅  
Wallet management | ✅ | ✅ | ✅  
Add payment method | ✅ | ✅ | ✅  
Payment method selector | ✅ | ❌ | ❌  
Payment method display | ✅ | ❌ | ❌  
### Primary (inline) and Secondary (modal, drawer)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#primary-inline-and-secondary-modal-drawer "Direct link to Primary \(inline\) and Secondary \(modal, drawer\)")
Primary   
(inline) | Secondary   
(modal, drawer)  
---|---  
Payment method selector | Wallet management  
Payment with wallet | Wallet management  
Wallet Management | 
  * Add payment method
  * Edit payment method
  * Remove payment method

  
### Examples[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#examples "Direct link to Examples")
Here are a few examples to illustrate the combinations:
#### Example 1: Primary Only - Inline[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#example-1-primary-only---inline "Direct link to Example 1: Primary Only - Inline")
```
const options: OptumCCGWidgetInitializerParams = {  
  appEnv: "prod",  
  checkoutSessionId: "checkout-session-id",  
  rootElement: document.getElementById("ccgWidgetContainer")!,  
  containerConfig: {  
    type: "inline",  
  },  
};  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```

#### Example 2: Primary and Secondary - Inline with Drawer[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#example-2-primary-and-secondary---inline-with-drawer "Direct link to Example 2: Primary and Secondary - Inline with Drawer")
```
const options: OptumCCGWidgetInitializerParams = {  
  appEnv: "prod",  
  checkoutSessionId: "checkout-session-id",  
  rootElement: document.getElementById("ccgWidgetContainer")!,  
  containerConfig: {  
    type: "inline",  
    secondaryContainer: {  
      type: "drawer",  
    },  
  },  
};  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```

#### Example 3: Primary and Secondary - Inline with Modal[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#example-3-primary-and-secondary---inline-with-modal "Direct link to Example 3: Primary and Secondary - Inline with Modal")
```
const options: OptumCCGWidgetInitializerParams = {  
  appEnv: "prod",  
  checkoutSessionId: "checkout-session-id",  
  rootElement: document.getElementById("ccgWidgetContainer")!,  
  containerConfig: {  
    type: "inline",  
    secondaryContainer: {  
      type: "modal",  
    },  
  },  
};  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```

#### Example 4: Primary Only - How to Enable Auto Scroll for Inline[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#example-4-primary-only---how-to-enable-auto-scroll-for-inline "Direct link to Example 4: Primary Only - How to Enable Auto Scroll for Inline")
```
const options: OptumCCGWidgetInitializerParams = {  
  appEnv: "prod",  
  checkoutSessionId: "checkout-session-id",  
  rootElement: document.getElementById("ccgWidgetContainer")!,  
  containerConfig: {  
    type: "inline",  
    autoScrollEnabled: true,  
  },  
};  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```



# Widget Modes
tip
For security reasons, session has to be generated on the backend and provided to the web app
## Creating a session[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#creating-a-session "Direct link to Creating a session")
  * To integrate the CCG UI widget/API, the first step is to generate a session for the widget by making a call to the [`/POST sessions`](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post) endpoint. This endpoint requires the following information:
    * `customer`: This information is necessary to identify the user and provide the relevant experience (**wallet** or **guest**).
      * Refer [Guest vs Wallet Experience](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Guest-vs-Wallet-Experience/)
    * `payment`: This includes all relevant information related to the payment, such as the amount, merchantTransactionId etc.
    * `paymentMethod`: This includes selected payment method id by merchant that will be used to get respective payment method selected when landing on payment method selector page.
    * `config`: This defines the configuration for the widget, eg: capabilties. This information is necessary to customize the widget to fit the merchant's needs and preferences.
      * Refer [Widget Capabilities](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/) for full list.
      * **The response returned by the session API may vary depending on how the[widget is configured](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#customize-widgets-capabilities).**

/POST session (request)
```
curl --location --request POST '<HCP_DOMAIN>/api/financial/commerce/nonprodcheckout/v1/sessions' \  
--header 'X-Merchant-Id: <x-merchant-id>' \  
--header 'X-Upstream-Env: <x-upstream-env>' \  
--header 'Content-Type: application/json' \  
--header 'Authorization: Bearer <authorization-token>' \  
--data-raw '{  
    "customer": {  
        "firstName": "foo",  
        "lastName": "bar",  
        "email": "foo.bar@email.com",  
        "ssnLastFour": "1234",  
        "dateOfBirth": "1970-31-12",  
        "phoneNumber": {  
            "number": "9876543210",  
            "countryCode": "1"  
        },  
        "zip5": "54321",  
        "hsid": "120c5730-e796-4448-8da9-081fde4e3e79",  
        "metadata": {}  
    },  
    "payment": {  
        "merchantTransactionId": "f32736c8-266a-4da1-af16-293fa02a351a",  
        "amount": 1200,  
        "authorizeCard": false,  
    },  
    "config": {  
        "modes": [  
            "PAYMENT_METHOD_ENTRY"  
        ],  
        "paymentMethodChannel": {  
            "card": [  
                "WEBFORM",  
                "TEXT",  
                "EMAIL",  
                "GOOGLE_PAY",  
                "APPLE_PAY"  
            ],  
            "bankAccount": [  
                "WEBFORM"  
            ]  
        },  
        "privacyPolicyUrl": "https://merchant.com/privacypolicy"  
    }  
}'  

```

/POST session (response)
```
{  
  "url": "/sessions/<CHECKOUT_SESSION_ID>",  
  "data": {  
    "sessionId": "<CHECKOUT_SESSION_ID>",  
    "hostedUrl": "<CCG_DOMAIN>/app?checkoutSessionId=<CHECKOUT_SESSION_ID>&appEnv=<CCG_APP_ENV>"  
  }  
}  

```

### Widget Configuration[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#widget-configuration "Direct link to Widget Configuration")
  * Widget configuration enables customizing the capabilities of the widget; Set `config.modes` property to the desired value when creating the session.
  * The `config.modes` is array type but is designed to accommodate a single value: `PAYMENT_WITH_WALLET`, `PAYMENT_METHOD_ENTRY`, `PAYMENT`, `PAYMENT_METHOD_SELECT`, `PAYMENT_METHOD_DISPLAY`

sample /POST session (req/res)
```
{  
  "customer": {},  
  "payment": {},  
  "config": {  
    "modes": ["<mode>"],  
    "paymentMethodChannel": ["<paymentMethodChannel>"]  
  }  
}  

```

```
{  
  "url": "/sessions/<CHECKOUT_SESSION_ID>",  
  "data": {  
    "sessionId": "<CHECKOUT_SESSION_ID>",  
    "hostedUrl": "<CCG_DOMAIN>/app?checkoutSessionId=<CHECKOUT_SESSION_ID>&appEnv=<CCG_APP_ENV>"  
  }  
}  

```

## Session Lifecycle[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#session-lifecycle "Direct link to Session Lifecycle")
  * A session is used to track the transaction status and is valid for 15 minutes once initiated.
  * The lifecycle of a session typically begins with a call to the `POST /session` endpoint and ends when the transaction is successful, fails, or times out.

Status | Description  
---|---  
ACCEPTED | Accepted, but not ready for processing  
CREATED | Ready for processing  
COMPLETED | Transaction successful  
error | Invalid request, Session creation error, Transaction failure or Time out  
### ACCEPTED[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#accepted "Direct link to ACCEPTED")
  * This is the initial state of the session object that is returned immediately after a successful call to the `POST /session` endpoint. At this stage, the session has been initiated, but it is not yet ready for processing.

/POST session response(ACCEPTED)
```
// HTTP status code: 202  
{  
  "url": "/sessions/<CHECKOUT_SESSION_ID>",  
  "data": {  
    "sessionId": "<CHECKOUT_SESSION_ID>",  
    "hostedUrl": "<CCG_DOMAIN>/app?checkoutSessionId=<CHECKOUT_SESSION_ID>&appEnv=<CCG_APP_ENV>"  
  }  
}  

```

### Polling[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#polling "Direct link to Polling")
  * To retrieve subsequent status updates for the session, you can use the `GET /session` API and poll the endpoint periodically. By polling the `GET /session` API, you can retrieve the latest status updates for the transaction and monitor its progress in real-time.


### CREATED[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#created "Direct link to CREATED")
  * In this state, the `sessionId` is active and can be used to perform the transaction.
  * When using the API, this state signals that the API can be submitted for processing, such as making a payment.

/GET session response(CREATED)
```
// HTTP status code: 200  
{  
  "id": "<CHECKOUT_SESSION_ID>",  
  "status": "CREATED" // ready for processing  
}  

```

### COMPLETED[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#completed "Direct link to COMPLETED")
  * This is the final state of the `session` object that is triggered when the transaction is successfully completed. The nature of the transaction completed may vary depending on the widget configuration that was supplied to create the session.
  * For example, in the case of `PAYMENT_METHOD_ENTRY`, this state may be triggered when the user successfully adds a payment method. In the case of `PAYMENT_WITH_WALLET`, this state is only triggered if the user successfully completes a payment.
  * In this final state, the session response may include information such as the paymentId, paymentMethodId information, which can be used to track the transaction and provide proof of payment to the customer.

/GET session response(COMPLETED)
```
// HTTP status code: 200  
{  
  "id": "<CHECKOUT_SESSION_ID>",  
  "status": "COMPLETED",  
  "paymentMethod": {}  
}  

```

### error[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#error "Direct link to error")
  * This state indicates that there were errors during the transaction, which could be due to transaction failure or timeout.
  * In this state, the response object may include error codes, error messages, and other details that can be used to identify and resolve the issues that caused the transaction to fail.

/GET session response (error)
```
// HTTP status code: 401, 403  
{  
  "message": ""  
}  
  
```json  
// HTTP status code: 500  
{  
  "title": "",  
  "detail": "",  
  "status": ""  
}  

```

## Request/Resonse based on `config.modes`[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#requestresonse-based-on-configmodes "Direct link to requestresonse-based-on-configmodes")
### PAYMENT_WITH_WALLET[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#payment_with_wallet "Direct link to PAYMENT_WITH_WALLET")
/POST session (request)
```
{  
  "customer": {},  
  "payment": {},  
  "config": {  
    "modes": ["PAYMENT_WITH_WALLET"]  
  }  
}  

```

/GET session/:id (response)
```
{  
  "data": {  
    "sessionId": "<CHECKOUT_SESSION_ID>",  
    "status": "COMPLETED",  
    "payment": {  
      "id": "",  
      "amount": 100,  
      "description": "",  
      "merchantTransactionId": "",  
      "merchantId": "",  
      "paymentType": "",  
      "currencyCode": "",  
      "status": "COMPLETED",  
      "paymentMethodId": "",  
      "metadata": {},  
      "error": null,  
      "statementDescriptorSuffix": null,  
      "paymentDetails": null  
    }  
  }  
}  

```

### PAYMENT_METHOD_ENTRY[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#payment_method_entry "Direct link to PAYMENT_METHOD_ENTRY")
/POST session (request)
```
{  
  "customer": {},  
  "config": {  
    "modes": ["PAYMENT_METHOD_ENTRY"],  
    "paymentMethodChannel": {  
      "card": ["WEBFORM", "TEXT", "EMAIL"] // "TEXT", "EMAIL" applies only for agent and not user flow  
    }  
  }  
}  

```

/GET session/:id (response)
```
{  
  "data": {  
    "sessionId": "<CHECKOUT_SESSION_ID>",  
    "paymentMethodResponse": {  
      "id": "",  
      "paymentMethodType": "CARD",  
      "status": "COMPLETED",  
      "card": {  
        "nameOnCard": "",  
        "cardBrand": "",  
        "expiryMonth": 1,  
        "expiryYear": 2020,  
        "last4": "",  
        "zipCode": ""  
      },  
      "paymentMethodDetails": {  
        "type": "CARD",  
        "nameOnCard": "",  
        "cardBrand": "",  
        "expiryMonth": 1,  
        "expiryYear": 2020,  
        "last4": "",  
        "zipCode": ""  
      },  
      "nickname": "",  
      "default": true  
    },  
    "status": "COMPLETED"  
  }  
}  

```

### PAYMENT[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#payment "Direct link to PAYMENT")
/POST session (request)
```
{  
  "customer": {}, // NA for `guest` user  
  "payment": {},  
  "config": {  
    "modes": ["PAYMENT"]  
  }  
}  

```

/GET session/:id (response)
```
{  
  "data": {  
    "sessionId": "<CHECKOUT_SESSION_ID>",  
    "status": "COMPLETED",  
    "payment": {  
      "id": "",  
      "amount": 100,  
      "description": "",  
      "merchantTransactionId": "",  
      "merchantId": "",  
      "paymentType": "",  
      "currencyCode": "",  
      "status": "COMPLETED",  
      "paymentMethodId": null,  
      "metadata": {},  
      "error": null,  
      "statementDescriptorSuffix": null  
    }  
  }  
}  

```

### PAYMENT_METHOD_SELECT[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#payment_method_select "Direct link to PAYMENT_METHOD_SELECT")
/POST session (request)
```
{  
  "customer": {},  
  "paymentMethod": {  
    "id": ""  
  },  
  "config": {  
    "modes": ["PAYMENT_METHOD_SELECT"]  
  }  
}  

```

/GET session/:id (response)
```
{  
 {  
    "data": {  
        "id": "",  
        "checkoutRequest": {  
            "paymentType": null,  
            "authorizeCard": null,  
            "merchantTransactionId": null,  
            "amount": null,  
            "statementDescriptorSuffix": null,  
            "paymentDescription": null,  
            "phoneNumber": null,  
            "email": "",  
            "firstName": "",  
            "config": {  
                "paymentMethodChannel": {  
                    "cardChannels": [  
                        {  
                            "type": "WEBFORM",  
                            "order": 0,  
                            "enabled": true  
                        }  
                    ],  
                    "card": [  
                        "WEBFORM"  
                    ]  
                },  
                "modes": [  
                    "PAYMENT_METHOD_SELECT"  
                ],  
                "paymentMethod": [  
                    {  
                        "type": "CARD",  
                        "channels": [  
                            {  
                                "type": "WEBFORM",  
                                "order": 0,  
                                "enabled": true  
                            }  
                        ]  
                    },  
                    {  
                        "type": "BANK_ACCOUNT",  
                        "channels": [  
                            {  
                                "type": "WEBFORM",  
                                "order": 0,  
                                "enabled": true  
                            }  
                        ]  
                    }  
                ],  
                "privacyPolicyUrl": "",  
                "senderEmailAddress": "",  
                "options": null  
            },  
            "agent": null,  
            "assistedByAgent": null,  
            "metadata": null,  
            "paymentDetails": null,  
            "paymentMethod": {  
                "id": "",  
                "default": false  
            },  
            "consent": null  
        },  
        "merchantId": "",  
        "checkoutSessionStatus": "CREATED",  
        "customerId": "",  
        "vendorMerchantId": "",  
        "paymentId": null,  
        "paymentMethodId": null,  
        "childSessionId": null,  
        "childSession": null,  
        "appearance": null,  
        "error": null,  
        "paymentMethod": null,  
        "payment": null,  
        "warning": null,  
        "features": null,  
        "expiresAtUtc": "",  
        "createdAtUtc": ""  
    },  
    "hcpToken": ""  
}  
}  

```

### PAYMENT_METHOD_DISPLAY[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#payment_method_display "Direct link to PAYMENT_METHOD_DISPLAY")
/POST session (request)
```
{  
  "customer": {}, // Customer identification details are required.  
  "paymentMethod": {  
    "id": "" // This is a required field.  
  },  
  "config": {  
    "modes": ["PAYMENT_METHOD_DISPLAY"]  
  }  
}  

```

/GET session/:id (response)
```
{  
 {  
    "data": {  
        "id": "",  
        "checkoutRequest": {  
            "paymentType": null,  
            "authorizeCard": null,  
            "merchantTransactionId": null,  
            "amount": null,  
            "statementDescriptorSuffix": null,  
            "paymentDescription": null,  
            "phoneNumber": null,  
            "email": "",  
            "firstName": "",  
            "config": {  
                "paymentMethodChannel": {  
                    "cardChannels": [  
                        {  
                            "type": "WEBFORM",  
                            "order": 0,  
                            "enabled": true  
                        }  
                    ],  
                    "card": [  
                        "WEBFORM"  
                    ]  
                },  
                "modes": [  
                    "PAYMENT_METHOD_DISPLAY"  
                ],  
                "paymentMethod": [  
                    {  
                        "type": "CARD",  
                        "channels": [  
                            {  
                                "type": "WEBFORM",  
                                "order": 0,  
                                "enabled": true  
                            }  
                        ]  
                    }  
                ],  
                "privacyPolicyUrl": "",  
                "senderEmailAddress": "",  
                "options": null  
            },  
            "agent": null,  
            "assistedByAgent": null,  
            "metadata": null,  
            "paymentDetails": null,  
            "paymentMethod": {  
                "id": "",  
                "default": false  
            },  
            "consent": null  
        },  
        "merchantId": "",  
        "checkoutSessionStatus": "CREATED",  
        "customerId": "",  
        "vendorMerchantId": "",  
        "paymentId": null,  
        "paymentMethod": {  
          "id": "<REQUESTED_PAYMENT_METHOD_ID>",  
          "paymentMethodType": "CARD",  
          "card": {  
            "type": "CARD",  
            "nameOnCard": "",  
            "cardBrand": "",  
            "expiryMonth": 3,  
            "expiryYear": 2043,  
            "last4": "",  
            "zipCode": "",  
            "status": "ACTIVE",  
            "manufacturerCard": false  
          },  
          "nickname": "",  
          "paymentMethodDetails": {  
            "type": "CARD",  
            "nameOnCard": "",  
            "cardBrand": "",  
            "expiryMonth": 3,  
            "expiryYear": 2043,  
            "last4": "",  
            "zipCode": "",  
            "status": "ACTIVE",  
            "manufacturerCard": false  
          },  
          "default": true  
        },  
        "childSessionId": null,  
        "childSession": null,  
        "appearance": null,  
        "error": null,  
        "paymentMethod": null,  
        "payment": null,  
        "warning": null,  
        "features": null,  
        "expiresAtUtc": "",  
        "createdAtUtc": ""  
    },  
    "hcpToken": ""  
}  
}  

```

## Environment values[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#environment-values "Direct link to Environment values")
  * **CHECKOUT_SESSION_ID** - uuid to uniquely identify a session


### Prod[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#prod "Direct link to Prod")
  * **HCP_DOMAIN** : `https://api.uhg.com`
  * **CCG_DOMAIN** : `https://wallet.healthsafepay.com`
  * **CCG_APP_ENV** : `prod`


### Stage[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Widget-Modes/#stage "Direct link to Stage")
  * **HCP_DOMAIN** : `https://api-stg.uhg.com`
  * **CCG_DOMAIN** : `https://stg-wallet.healthsafepay.com`
  * **CCG_APP_ENV** : `stage`




# Payment Method Selector
## Overview[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/#overview "Direct link to Overview")
The Payment Method Selector allows end users to display a list of payment methods and get notified of the selected payment method. Notifications can be received via callback in an embedded environment or via polling in a hosted environment. Users can also pre-select a payment method during session creation, and manage their wallet directly from the widget.
## Supported Experiences[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/#supported-experiences "Direct link to Supported Experiences")
  * [Hosted experience](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Hosted-Experience/)
  * [Embedded experience](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/)


## Usage[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/#usage "Direct link to Usage")
### Create a Session[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/#create-a-session "Direct link to Create a Session")
  * To [create a session](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post), send a request object specifying the customer details, configuration modes, and optionally, the payment method ID to be pre-selected.


### Example Request[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/#example-request "Direct link to Example Request")
```
{  
  "customer": {  
    // Customer details here  
  },  
  "config": {  
    "modes": ["PAYMENT_METHOD_SELECT"]  
  },  
  //optional  
  "paymentMethod": {  
    "id": "payment-method-id"  
  }  
}  

```

**Note: Use`hostedURL` from the session request response to launch the hosted experience.**
## Session Configuration Options[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/#session-configuration-options "Direct link to Session Configuration Options")
  * `paymentMethod.id`: The ID of the payment method to be pre-selected.


## Things to Keep in Mind[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/#things-to-keep-in-mind "Direct link to Things to Keep in Mind")
### Embedded Environment[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/#embedded-environment "Direct link to Embedded Environment")
  * Merchants are notified via [onEvent](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/#onevent-data) callback when a payment method is selected.
  * Users can manage their wallet through a CTA button below the list. When clicked, the merchant is notified that there is no selection. After wallet changes, the last added or updated card is selected, and the merchant is notified via callback.


### Hosted Environment[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/widget-capabilities/payment-method-selector/#hosted-environment "Direct link to Hosted Environment")
  * Merchants must poll session details to get the selected payment method ID, which is attached once the user confirms their selection.
  * The payment method selector page includes two additional buttons: `Confirm payment method` and `Cancel`.
  * If `Confirm payment method` button is clicked without a selection, an error message is displayed.
  * Once a selection is made and `Confirm payment method` is clicked, the selected payment method is added to the session, and the session is marked complete.




# Combined Payout report
Combined Payout report merges all Merchant Payout reports into a single file. This file is delivered to treasury for reconciliation and contains all the Merchants that CCG services has under the UHC Entity such as Rx, UHC, Solutran, etc.
This report is generated on a daily basis, being triggering for a date two days prior. For example, if the report is triggered on June 11th, 2024, the timestamp range will be set from June 9th, 2024 00:00:00 UTC to June 10th, 2024 00:00:00 UTC. Please note that this report will be delivered 24 hours after the Merchant Payout report.
The file will be delivered on a daily basis between 11:00 and 16:00 UTC via ECG.
It includes:
  * [CCG specific metadata](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#ccg-specific-metadata)
  * [Transaction data](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Report%20metadata/#transaction-data)


### Report name format:[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Combined%20Report/#report-name-format "Direct link to Report name format:")
`<report-name>_<yyyymmdd>.csv` where  
Report-name is type of report. In this case: CCG_Treasury_CombinedPayout  
Example: CCG_Treasury_CombinedPayout_20231202.csv
### Report Example[​](https://docs.healthsafepay.com/docs/developers/Add-on-services/Reports/Combined%20Report/#report-example "Direct link to Report Example")
[Stripe_Treasury_CombinedPayout_20230824.csv](https://github.com/optum-financial/ConvenientCheckout/files/12641616/Stripe_Treasury_CombinedPayout_20230824.csv)


# Add Payment method
  * CCG allows you to add below payment method to your wallet
    * `CARD`
    * `BANK ACCOUNT`
  * A Customer can add a valid card to thier wallet and mark that card as default payment method
  * Adding a payment method can be done through [Convienient Checkout UI](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/) or [Convienient Checkout API](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/)
  * Channels supported to add a payment method
    * TEXT
    * EMAIL
    * ON SCREEN ENTRY
    * TELEPHONIC ENTRY




# Remove Payment method
  * CCG allows you to remove below payment method from your wallet
    * `CARD`
    * `BANK ACCOUNT`
  * Updating a payment method can be done through [Convienient Checkout UI](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/) or [Convienient Checkout API](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/)




# Update Payment method
  * CCG allows you to update below payment method to your wallet
    * `CARD`
    * `BANK ACCOUNT`
  * A Customer can flag/de-flag a payment method as default payment method
  * A Customer or Agent can update only the valid card, For Example, user cannot update a [Invalidated Payment Method](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/BankAccount/Invalidated%20Payment%20Method/)
  * Updating a payment method can be done through [Convienient Checkout UI](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/) or [Convienient Checkout API](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/)




# Payment Method Channels
A payment method channel refers to the medium or platform through which a payment transaction is initiated and processed. It can include various methods such as wallets, online payment gateways, and other electronic payment systems that facilitate the transfer of funds between a payer and a payee. Payment channels provide the infrastructure for secure and efficient payment processing, allowing individuals and businesses to make and receive payments electronically.
### Allowed Payment Method Channels[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/#allowed-payment-method-channels "Direct link to Allowed Payment Method Channels")
  * [On-Screen Entry](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/on-screen-entry/)
  * [TEXT](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/text-channel/)
  * [EMAIL](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/email-channel/)
  * Telephonic Entry


### PCI Compliance[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/#pci-compliance "Direct link to PCI Compliance")
PCI compliance refers to the adherence to the Payment Card Industry Data Security Standard (PCI DSS), which is a set of security standards designed to ensure that all companies that accept, process, store, or transmit credit card information maintain a secure environment. Compliance with PCI DSS helps to protect cardholder data from security breaches and fraud.


# EMAIL Channel
Supported modes
> EMAIL_TO_ADD - Adding a payment method  
>  EMAIL_TO_PAY - Making a payment
## EMAIL TO ADD FLOW[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/email-channel/#email-to-add-flow "Direct link to EMAIL TO ADD FLOW")
Agent Initiates Session and launches widget
Agent selects EMAIL channel
Agent sends a Email with Add Payment Method link to customer phoneNumber
Customer recieves add payment method link
Customer completes payment method adding successfully
## EMAIL TO PAY FLOW[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/email-channel/#email-to-pay-flow "Direct link to EMAIL TO PAY FLOW")
Agent Initiates Session and launches widget
Agent selects EMAIL channel
Agent sends a Email with make a payment link to customer phoneNumber
Customer recieves make a payment link
Customer completes payment method adding successfully


# TEXT Channel
Supported modes
> TEXT_TO_ADD - Adding a payment method  
>  TEXT_TO_PAY - Making a payment
## TEXT TO ADD FLOW[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/text-channel/#text-to-add-flow "Direct link to TEXT TO ADD FLOW")
Agent Initiates Session and launches widget
Agent selects TEXT channel
Agent sends a Text with Add Payment Method link to customer phoneNumber
Customer recieves add payment method link
Customer completes payment method adding successfully
## TEXT TO PAY FLOW[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/text-channel/#text-to-pay-flow "Direct link to TEXT TO PAY FLOW")
Agent Initiates Session and launches widget
Agent selects TEXT channel
Agent sends a Text with make a payment link to customer phoneNumber
Customer recieves make a payment link
Customer completes payment method adding successfully


# On-Screen Entry
On-screen entry is a process by which customers input their payment information directly on the screen during an online transaction. This typically occurs during the checkout process when a customer is ready to make a purchase on an e-commerce website or mobile app that uses a payment gateway to process payments.
Customers are presented with a payment form on the screen where they enter their payment details, such as credit card number, expiration date, CVV code, billing address, and any other required information. This information is securely transmitted to the payment gateway for processing and authorization.
Payment Method Type | Agent | Customer  
---|---|---  
CARD | Allowed for agents belongs to [WS2](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment%20Method%20Channels/ws2/) | Allowed  
Bank Account | Allowed | Allowed  
Google Pay | Not Applicable | Allowed  
Apple Pay | Not Applicable | Allowed


# Invalidated Payment Method


# default card
## Default Card[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/Card/default%20card/#default-card "Direct link to Default Card")
The default card in a digital wallet is the primary payment method that is automatically selected for transactions when you make a purchase. When you have multiple payment methods stored in your digital wallet, setting a default card allows for quicker and more convenient checkout experiences.
Having a default card means that when you initiate a payment, the digital wallet will automatically use the default card for the transaction unless you manually select a different payment method at the time of purchase. This streamlines the payment process, especially for frequent transactions, as you won't have to choose a payment method each time you make a purchase.
It's important to regularly review and update your default card settings in your digital wallet to ensure that the correct payment method is selected for your transactions and to prevent accidental charges on an unintended card.


# PRE AUTH Transactions
## what is pre-authorization?[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Pre-Auth%20Transactions/#what-is-pre-authorization "Direct link to what is pre-authorization?")
Pre-authorization is the first step in the payment process, where the merchant requests approval from the card issuer to ensure that the customer has sufficient funds or credit available for the transaction. This involves temporarily placing a hold on the customer's account for the pre-authorized amount without immediate fund transfer to the merchant. The pre-authorization hold serves as a temporary reservation of funds and remains active for a specified period, after which it will expire if the transaction is not completed.
**Payments that have been pre-authorized must be processed within 7 days; otherwise, the held amount will be released.**
## Business Scenarios[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Pre-Auth%20Transactions/#business-scenarios "Direct link to Business Scenarios")
Common business scenarios for pre-authorization transactions include:
  * Hotel reservations: Pre-authorizing a guest's credit card for the room rate and potential additional charges before check-in.
  * Car rentals: Pre-authorizing a customer's credit card for the estimated rental cost and any potential damages.
  * Online purchases: Pre-authorizing a customer's card for the purchase amount before shipping the goods.
  * Subscription services: Pre-authorizing recurring payments for subscription services to ensure continuity of service.
  * Travel bookings: Pre-authorizing payments for flights, hotels, and other travel-related services to secure reservations.
  * Retail stores: Pre-authorizing payments for high-value items or during peak shopping seasons to manage inventory and prevent fraud.


## Handling pre-authorization[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payments/Pre-Auth%20Transactions/#handling-pre-authorization "Direct link to Handling pre-authorization")


# Retry Mechanisms
The retry functionality is implemented to permit up to 5 attempts when a user encounters a failure during payment or payment method entry validation.
### What is Retry Logic?[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#what-is-retry-logic "Direct link to What is Retry Logic?")
A retry mechanism is a strategy designed to allow users to retry failed operations, aiming to recover from errors or failures. This mechanism ensures the system continues to operate smoothly by pausing and allowing retry operations for a fixed number of times, such as 5.
In the CCG widget, the retry mechanism is implemented to handle different session modes, specifically for `PAYMENT`, `PAYMENT_METHOD_ENTRY`, and `PAYMENT_WITH_WALLET` modes. The behavior varies based on the mode:
  * _**For`PAYMENT` and `PAYMENT_METHOD_ENTRY` modes**_, after all retry attempts are exhausted, the session becomes invalidated, and a dead-end screen is displayed to the user. This indicates that the user has reached the maximum number of allowed attempts without successfully completing the payment or payment method entry process.
    * `PAYMENT` mode:
![PAYMENT mode](https://docs.healthsafepay.com/img/payment_retry_dead_end_screen.PNG)
    * `PAYMENT_METHOD_ENTRY` mode:
![PAYMENT_METHOD_ENTRY mode](https://docs.healthsafepay.com/img/payment_method_entry_dead_end_screen.PNG)
  * _**In contrast, for the`PAYMENT_WITH_WALLET` mode**_, upon exhausting all retry attempts, the retry count is reset, and the user is redirected back to the wallet screen. A warning message is displayed to inform the user about the need to add payment method details again. Unlike the previous modes, the session in this case is not invalidated, allowing the user to attempt the payment process again.
![PAYMENT_WITH_WALLET mode](https://docs.healthsafepay.com/img/payment_with_wallet_retry_warning.PNG)


This detailed explanation outlines the specific behaviors and outcomes associated with the retry mechanism in the CCG widget across different session modes, ensuring a clear understanding of how the system responds to various user actions and attempts.
### Retry Logic for Making Payment[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#retry-logic-for-making-payment "Direct link to Retry Logic for Making Payment")
This feature allows users to retry payment attempts after initial failures, addressing issues like declined cards. It includes:
  * **Initial Processing:** Validation of payment and payment method details.
  * **Retry Logic:**
    * **Retry Attempts:** Up to **5 attempts** to correct errors.
    * **Error Messages:** Guides users in fixing errors.
    * **Timeouts:** Prevents abuse and delays.
    * **User Experience:** Ensures a smooth process with **dead-end error screen** in the hosted experience and same is shown momentarily for embedded modal experience. However, in the embedded inline experience, a dead-end screen is not displayed.
    * **Security:** Protects sensitive data and prevents fraud.
    * **Final Actions:** Notifies users of failure. Webhook event `PAYMENT_FAILED` is triggered for the failed **last payment attempt** for `CARD` payment method and for **each failed attempt** for `BANK_ACCOUNT` payment method. Below are the sample webhook event responses for each type:
Sample PAYMENT_FAILED Webhook Event Response: **CARD**
```
{  
  "id": "XXXX-XXXX-XXXX-XXXX",  
  "searchId": "XXXX-XXXX-XXXX-XXXX",  
  "payload": {  
    "id": "XXXX-XXXX-XXXX-XXXX",  
    "error": {  
      "code": "card_declined",  
      "description": "Payment method could not be authorized. Please try a different payment method.",  
      "errorDetails": {  
        "code": "card_declined",  
        "message": "Your card was declined.",  
        "declineCode": "generic_decline"  
      }  
    },  
    "amount": 100,  
    "merchantId": "XXXX-XXXX-XXXX-XXXX",  
    "description": "UI widget payment",  
    "paymentMethod": {  
      "card": {  
        "last4": "0002",  
        "zipCode": "76575",  
        "cardBrand": "VISA",  
        "expiryYear": 2029,  
        "nameOnCard": "TEST",  
        "expiryMonth": 10,  
        "manufacturerCard": false  
      },  
      "error": {  
        "code": "card_declined",  
        "description": "Payment method could not be authorized. Please try a different payment method.",  
        "errorDetails": {  
          "code": "card_declined",  
          "message": "Your card was declined.",  
          "declineCode": "generic_decline"  
        }  
      },  
      "default": false,  
      "nickname": "",  
      "paymentMethodType": "CARD",  
      "paymentMethodDetails": {  
        "type": "CARD",  
        "last4": "0002",  
        "zipCode": "76575",  
        "cardBrand": "VISA",  
        "expiryYear": 2029,  
        "nameOnCard": "TEST",  
        "expiryMonth": 10,  
        "manufacturerCard": false  
      }  
    },  
    "paymentDateUtc": "2024-03-22T07:35:54.144051",  
    "merchantTransactionId": "XXXX-XXXX-XXXX-XXXX"  
  },  
  "token": "Bearer XXX",  
  "eventType": "PAYMENT_FAILED",  
  "message": "Payment Event",  
  "source": null,  
  "sourceMerchant": null  
}  

```

Sample PAYMENT_FAILED Webhook Event Response: **BANK_ACCOUNT**
```
{  
  "id": "XXXX-XXXX-XXXX-XXXX",  
  "searchId": "XXXX-XXXX-XXXX-XXXX",  
  "payload": {  
    "id": "XXXX-XXXX-XXXX-XXXX",  
    "error": {  
      "code": "avs_verification_failure",  
      "description": "We were unable to validate the bank details you provided using information from Early Warning (EWS), a consumer reporting agency. Please try another payment method or call the Number on the back of your member card for help. EWS does not direct our decisions and cannot explain why a decision made, but you have the right to contact EWS, obtain free information on your account and dispute such information within 60 days at: <br /><br /> Early Warning Services, LLC <br /> Attn: Consumer Services <br /> Address: 16552 N. 90th Street, Scottsdale, AZ 85260 <br /> Phone Number: (800) 745-4210 <br /><br /> https://www.earlywarning.com/consumer-information"  
    },  
    "amount": 100,  
    "consent": {  
      "collectionDetails": {  
        "web": {  
          "ipAddress": "X.X.X.X",  
          "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0"  
        },  
        "type": "WEB"  
      },  
      "merchantConsentId": "XXXX-XXXX-XXXX-XXXX",  
      "collectionTimestamp": "2024-03-22T09:59:07.716Z",  
      "merchantConsentText": "TEST"  
    },  
    "merchantId": "XXXX-XXXX-XXXX-XXXX",  
    "description": "UI widget payment",  
    "paymentMethod": {  
      "error": {  
        "code": "avs_verification_failure",  
        "description": "We were unable to validate the bank details you provided using information from Early Warning (EWS), a consumer reporting agency. Please try another payment method or call the Number on the back of your member card for help. EWS does not direct our decisions and cannot explain why a decision made, but you have the right to contact EWS, obtain free information on your account and dispute such information within 60 days at: <br /><br /> Early Warning Services, LLC <br /> Attn: Consumer Services <br /> Address: 16552 N. 90th Street, Scottsdale, AZ 85260 <br /> Phone Number: (800) 745-4210 <br /><br /> https://www.earlywarning.com/consumer-information"  
      },  
      "default": false,  
      "nickname": "",  
      "paymentMethodType": "BANK_ACCOUNT",  
      "paymentMethodDetails": {  
        "type": "BANK_ACCOUNT",  
        "last4": "6575",  
        "accountType": "checking",  
        "nameOnAccount": "TEST",  
        "routingNumber": "100000000",  
        "accountHolderType": "individual"  
      }  
    },  
    "paymentDateUtc": "2024-03-22T09:59:09.757785",  
    "merchantTransactionId": "XXXX-XXXX-XXXX-XXXX"  
  },  
  "token": "Bearer XXX",  
  "eventType": "PAYMENT_FAILED",  
  "message": "Payment Event",  
  "source": null,  
  "sourceMerchant": null  
}  

```



### Retry Logic for Adding Payment Method[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#retry-logic-for-adding-payment-method "Direct link to Retry Logic for Adding Payment Method")
Similar to payment processing, this feature allows users to retry entering payment method details after failures, addressing issues like incorrect card details. It includes the same stages as above, ensuring a user-friendly and secure process.
### Settings and Behaviors of Retry Logic[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#settings-and-behaviors-of-retry-logic "Direct link to Settings and Behaviors of Retry Logic")
#### This table outlines various settings and behaviors related to retry logic, including retry rules configuration, and system settings for retry logic.[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#this-table-outlines-various-settings-and-behaviors-related-to-retry-logic-including-retry-rules-configuration-and-system-settings-for-retry-logic "Direct link to This table outlines various settings and behaviors related to retry logic, including retry rules configuration, and system settings for retry logic.")
| Input Validation Errors | Business Rules Validation Errors | Errors from Stripe  
---|---|---|---  
Is it counted as retriable error for cards? | No | NA | Yes  
Is it counted as retriable error for ACH? | No | Yes | No  
Is webhook response sent for ACH on failure attempts (less than max count 5)? | No | Yes | No  
Is webhook response sent for ACH for final retry attempt i.e., equal to max count 5? | No | Yes | No  
Is webhook response sent for CARD on failure attempts (less than max count 5)? | No | No | No  
Is webhook response sent for CARD for final retry attempt i.e., equal to max count 5? | No | No | Yes  
##### NOTE:[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#note "Direct link to NOTE:")
  * What is `retriable error`? Retriable errors are _**errors that can be resolved by the user**_ , such as entering the correct details, trying a different payment method. Most of the time. these errors are not system-related and can be fixed by the user.
  * What is `input validation error`? Input validation errors are _**errors that occur when the user enters incorrect details**_ , such as incorrect card details, incorrect bank account details, etc.
    * Example: If the user enters the wrong card number, the system will throw an input validation error like 'Your card number is invalid.'.
  * What is `business rules validation error`? Business rules validation errors are _**errors that occur when the user enters correct details but the system cannot validate them**_.
    * Example: If the user enters the incorrect routing number for the bank account, the system will throw a business rules validation error like early warning service error.
Early Warning Error for Bank Account
```
    {  
        "title": "PAYMENT_METHOD_ERROR",  
        "status": 406,  
        "detail": "We were unable to validate the bank details you provided using information from Early Warning (EWS), a consumer reporting agency. Please try another payment method or call the Number on the back of your member card for help. EWS does not direct our decisions and cannot explain why a decision made, but you have the right to contact EWS, obtain free information on your account and dispute such information within 60 days at: <br /><br /> Early Warning Services, LLC <br /> Attn: Consumer Services <br /> Address: 16552 N. 90th Street, Scottsdale, AZ 85260 <br /> Phone Number: (800) 745-4210 <br /><br /> https://www.earlywarning.com/consumer-information",  
        "errorDetails": null  
    }  

```

  * What is `Stripe error`? Stripe errors are _**errors that occur when the system cannot process the payment method details**_ , such as card declined, bank account declined.
    * Example: If the user enters the correct card details but the card is declined, the system will throw a stripe error like 'Your card was declined.'.
Stripe Error for Declined Card
```
    {  
        "title": "PAYMENT_METHOD_ERROR",  
        "status": 406,  
        "detail": "Payment method could not be authorized. Please try a different payment method.",  
        "errorDetails": {  
            "code": "card_declined",  
            "message": "Your card was declined.",  
            "declineCode": "generic_decline",  
            "networkAdviceCode": null,  
            "networkDeclineCode": null  
      }  
    }  

```



#### This table outlines the retry rules configuration for different session modes.[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#this-table-outlines-the-retry-rules-configuration-for-different-session-modes "Direct link to This table outlines the retry rules configuration for different session modes.")
* Note: For ACH, the webhook is sent for failure attempts only if the error is a business rules validation error for ACH.  Session Mode | Payment Method | Is webhook Sent for Failure Attempt? | Is Webhook Sent for Final Attempt? | Is Session Invalidated? | Is Dead-end Error Screen Shown After Failed Final Attempt? | Is Wallet Screen Shown After Failed Final Attempt?  
---|---|---|---|---|---|---  
PAYMENT | Card | No | Yes | Yes | Yes | NA  
PAYMENT | ACH | Yes* | Yes | Yes | Yes | NA  
PAYMENT_WITH_WALLET (Add payment method) | Card | No | No | No | No | Yes  
PAYMENT_WITH_WALLET (Make payment) | Card | No | Yes | Yes | Yes | No  
PAYMENT_WITH_WALLET (Add payment method) | ACH | No | No | No | No | Yes  
PAYMENT_WITH_WALLET (Make payment) | ACH | NA | NA | NA | NA | NA  
PAYMENT_METHOD_ENTRY | Card | No | No | Yes | Yes | NA  
PAYMENT_METHOD_ENTRY | ACH | No | No | Yes | Yes | NA  
### Conclusion[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/Retry-Logic-for-Payment-And-Payment-Method-Entry/#conclusion "Direct link to Conclusion")
Implementing smart retry logic for both payment and payment method entry enhances user experience and transaction success. It reduces abandoned transactions and builds user trust by providing clear guidance and support.


# Payments
### OneTimePay or PayAndStore: vendorPaymentMethodId[​](https://docs.healthsafepay.com/docs/developers/Special%20Use%20Cases/Payments/payments/#onetimepay-or-payandstore-vendorpaymentmethodid "Direct link to OneTimePay or PayAndStore: vendorPaymentMethodId")
  * OneTimePay or PayAndStore operations require providing `paymentMethod.vendorPaymentMethodId` in the request payload for 'Merchant - PCI' scope based payments
  * A new vendorPaymentMethodId is needed for each payment attempt. Once used, it's marked as consumed, regardless of the transaction outcome.
  * Refer [Create Payment API Spec](https://docs.healthsafepay.com/api-reference/#tag/Merchant-PCI/operation/createPaymentWithToken) for req/res payload




# delete payment method


# find payment methods


# update payment method


# One time pay


# Agent assisted payments


# Pay and Save


# Pay with Wallet
###  [1. Create Session](https://docs.healthsafepay.com/api-reference/#tag/Merchant/paths/~1sessions/post)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#1-create-session "Direct link to 1-create-session")
Create session for Initializing the convenient Checkout Widget. Returns a session ID
###  [2. Load Embedded Widget](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Integration/Integration-Options/Embedded-Experience/)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#2-load-embedded-widget "Direct link to 2-load-embedded-widget")
Utilize the session ID returned from Create Session API (Step 1) to load the embedded widget and perform the desired payment option. This will return Merchant Transaction ID and Payment ID to track the transaction.
### Get Payment Status[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#get-payment-status "Direct link to Get Payment Status")
A payment status can be retrieved in two ways.  
**[3. Get Payment Status by Merchant Transaction ID](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/getPaymentByMerchantTransactionId)** Get status for payment using the Merchant Transaction ID returned by Widget in step 2
**[4. Get Payment Status by Payment ID](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/getPayment)** Get status for payment using the Payment ID returned by Widget in step 2
###  [Get Customer Payment Methods](https://docs.healthsafepay.com/api-reference/#tag/Merchant/operation/getPaymentIntent)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#get-customer-payment-methods "Direct link to get-customer-payment-methods")
Gets all the payment method for a given existing customer
###  [Create Payment](https://docs.healthsafepay.com/api-reference/#tag/payment-controller/operation/createPaymentIntent)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#create-payment "Direct link to create-payment")
Creates a payment request. The payment request may be attempted to be confirmed automatically by setting autoConfirm to true. Default is false
###  [Capture Amount by Payment ID](https://docs.healthsafepay.com/api-reference/#tag/payment-controller/operation/createPaymentIntent)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-api/Payments/make%20a%20payment%20via%20UI/#capture-amount-by-payment-id "Direct link to capture-amount-by-payment-id")
Creates a payment request. The payment request may be attempted to be confirmed automatically by setting autoConfirm to true. Default is false


# poll get sessions


# Embedded Experience Containers
## Overview[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#overview "Direct link to Overview")
This documentation outlines the different types of containers supported by our widget and their respective capabilities. The widget can be configured to use either a primary container only or a combination of primary and secondary containers.
## Container Types[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#container-types "Direct link to Container Types")
### Primary Only Containers[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#primary-only-containers "Direct link to Primary Only Containers")
Primary only containers mean that the entire widget usage is done within that primary container.
  * **Types:** `inline`, `modal`, `drawer`


### Primary and Secondary Containers[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#primary-and-secondary-containers "Direct link to Primary and Secondary Containers")
Primary and secondary containers are used when the primary container is `inline`. This configuration allows the primary container to show the initial view of the session, while the secondary container is used for additional actions that are not part of the primary session capability.
  * **Primary Type:** `inline`
  * **Secondary Types:** `modal`, `drawer`


## Widget Capabilities by Container Type[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#widget-capabilities-by-container-type "Direct link to Widget Capabilities by Container Type")
### Primary only[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#primary-only "Direct link to Primary only")
| Inline | Modal | Drawer  
---|---|---|---  
Payment with wallet | ✅ | ✅ | ✅  
Payment | ✅ | ✅ | ✅  
Wallet management | ✅ | ✅ | ✅  
Add payment method | ✅ | ✅ | ✅  
Payment method selector | ✅ | ❌ | ❌  
Payment method display | ✅ | ❌ | ❌  
### Primary (inline) and Secondary (modal, drawer)[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#primary-inline-and-secondary-modal-drawer "Direct link to Primary \(inline\) and Secondary \(modal, drawer\)")
Primary   
(inline) | Secondary   
(modal, drawer)  
---|---  
Payment method selector | Wallet management  
Payment with wallet | Wallet management  
Wallet Management | 
  * Add payment method
  * Edit payment method
  * Remove payment method

  
### Examples[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#examples "Direct link to Examples")
Here are a few examples to illustrate the combinations:
#### Example 1: Primary Only - Inline[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#example-1-primary-only---inline "Direct link to Example 1: Primary Only - Inline")
```
const options: OptumCCGWidgetInitializerParams = {  
  appEnv: "prod",  
  checkoutSessionId: "checkout-session-id",  
  rootElement: document.getElementById("ccgWidgetContainer")!,  
  containerConfig: {  
    type: "inline",  
  },  
};  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```

#### Example 2: Primary and Secondary - Inline with Drawer[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#example-2-primary-and-secondary---inline-with-drawer "Direct link to Example 2: Primary and Secondary - Inline with Drawer")
```
const options: OptumCCGWidgetInitializerParams = {  
  appEnv: "prod",  
  checkoutSessionId: "checkout-session-id",  
  rootElement: document.getElementById("ccgWidgetContainer")!,  
  containerConfig: {  
    type: "inline",  
    secondaryContainer: {  
      type: "drawer",  
    },  
  },  
};  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```

#### Example 3: Primary and Secondary - Inline with Modal[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#example-3-primary-and-secondary---inline-with-modal "Direct link to Example 3: Primary and Secondary - Inline with Modal")
```
const options: OptumCCGWidgetInitializerParams = {  
  appEnv: "prod",  
  checkoutSessionId: "checkout-session-id",  
  rootElement: document.getElementById("ccgWidgetContainer")!,  
  containerConfig: {  
    type: "inline",  
    secondaryContainer: {  
      type: "modal",  
    },  
  },  
};  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```

#### Example 4: Primary Only - How to Enable Auto Scroll for Inline[​](https://docs.healthsafepay.com/docs/developers/convenient-checkout-ui/Widget-Experience/Embedded%20Experience/#example-4-primary-only---how-to-enable-auto-scroll-for-inline "Direct link to Example 4: Primary Only - How to Enable Auto Scroll for Inline")
```
const options: OptumCCGWidgetInitializerParams = {  
  appEnv: "prod",  
  checkoutSessionId: "checkout-session-id",  
  rootElement: document.getElementById("ccgWidgetContainer")!,  
  containerConfig: {  
    type: "inline",  
    autoScrollEnabled: true,  
  },  
};  
const ccgWidget = OptumCCGWidgetInitializer(options);  

```






# Invalidated Payment Method


# default card
## Default Card[​](https://docs.healthsafepay.com/docs/developers/Core-Capabilities/Payment-Methods/Payment-Methods-types/Card/default%20card/#default-card "Direct link to Default Card")
The default card in a digital wallet is the primary payment method that is automatically selected for transactions when you make a purchase. When you have multiple payment methods stored in your digital wallet, setting a default card allows for quicker and more convenient checkout experiences.
Having a default card means that when you initiate a payment, the digital wallet will automatically use the default card for the transaction unless you manually select a different payment method at the time of purchase. This streamlines the payment process, especially for frequent transactions, as you won't have to choose a payment method each time you make a purchase.
It's important to regularly review and update your default card settings in your digital wallet to ensure that the correct payment method is selected for your transactions and to prevent accidental charges on an unintended card.


